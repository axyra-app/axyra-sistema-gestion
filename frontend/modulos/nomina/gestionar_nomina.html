<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AXYRA - Gesti√≥n de N√≥mina</title>
    <link rel="stylesheet" href="../../static/axyra-styles.css" />
    <link rel="stylesheet" href="../../static/modal-fixes.css" />
    <link rel="stylesheet" href="nomina-styles.css" />
    <link rel="icon" href="../../nomina.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- AXYRA Firebase Scripts -->
    <script src="../../static/firebase-config.js"></script>
    
    <!-- Sistema de Roles y Permisos AXYRA -->
    <script src="../../static/roles-config.js"></script>
    
    <!-- Sistema de Notificaciones Push AXYRA -->
    <script src="../../static/notifications-system.js"></script>

    <!-- Sistema Unificado de Autenticaci√≥n AXYRA -->
    <script src="../../static/unified-auth-system.js"></script>
    
    <!-- Sistema Unificado de Reportes Avanzados AXYRA -->
    <script src="../../static/advanced-reports-unified.js"></script>
    
    <!-- Sistema Unificado de Backup AXYRA -->
    <script src="../../static/backup-system-unified.js"></script>
    
    <!-- Sistema Unificado de Auditor√≠a AXYRA -->
    <script src="../../static/audit-system-unified.js"></script>
    
    <script src="../../static/debug-auth.js"></script>
    <script src="../../static/gmail-notifications.js"></script>
    
    <!-- Header Compartido AXYRA -->
    <script src="../../static/include-header.js"></script>
    
    <!-- Verificaci√≥n del Header Compartido -->
    <script src="../../static/header-verification.js"></script>

    <style>
      /* Estilos espec√≠ficos para el m√≥dulo de n√≥mina */
      .detalle-nomina-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .detalle-section {
        background: #f8fafc;
        border-radius: 8px;
        padding: 20px;
        border: 1px solid #e2e8f0;
      }

      .detalle-section h4 {
        color: #1e3a8a;
        margin: 0 0 15px 0;
        font-size: 1.1rem;
        font-weight: 600;
        border-bottom: 2px solid #cbd5e1;
        padding-bottom: 8px;
      }

      .detalle-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #e2e8f0;
      }

      .detalle-row:last-child {
        border-bottom: none;
      }

      .detalle-row.total {
        font-weight: 600;
        color: #1e3a8a;
        border-top: 2px solid #cbd5e1;
        padding-top: 12px;
        margin-top: 8px;
      }

      .detalle-label {
        color: #64748b;
        font-weight: 500;
      }

      .detalle-value {
        color: #1e293b;
        font-weight: 600;
      }

      .reportes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .reporte-card {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
      }

      .reporte-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 30px rgba(0,0,0,0.15);
      }

      .reporte-icon {
        font-size: 2.5rem;
        color: #667eea;
        margin-bottom: 15px;
      }

      .reporte-content h4 {
        color: #1e3a8a;
        margin: 0 0 10px 0;
        font-size: 1.1rem;
        font-weight: 600;
      }

      .reporte-content p {
        color: #64748b;
        margin: 0;
        font-size: 0.9rem;
        line-height: 1.4;
      }

      .resumen-nomina {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
      }

      .resumen-nomina h4 {
        color: #1e3a8a;
        margin: 0 0 15px 0;
        font-size: 1.1rem;
        font-weight: 600;
      }

      .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 15px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .form-group label {
        color: #374151;
        font-weight: 500;
        margin-bottom: 5px;
        font-size: 0.9rem;
      }

      .form-input, .form-select {
        padding: 10px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 0.9rem;
        transition: border-color 0.3s ease;
      }

      .form-input:focus, .form-select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      }

      .btn-primary {
        background: #667eea;
        color: white;
      }

      .btn-primary:hover {
        background: #5a67d8;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #5a6268;
      }

      .btn-success {
        background: #10b981;
        color: white;
      }

      .btn-success:hover {
        background: #059669;
      }

      .btn-danger {
        background: #ef4444;
        color: white;
      }

      .btn-danger:hover {
        background: #dc2626;
      }

      .btn-warning {
        background: #f59e0b;
        color: white;
      }

      .btn-warning:hover {
        background: #d97706;
      }

      .btn-info {
        background: #3b82f6;
        color: white;
      }

      .btn-info:hover {
        background: #2563eb;
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        z-index: 9999;
        align-items: center;
        justify-content: center;
      }

      .modal-overlay.active {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        max-width: 90%;
        max-height: 90%;
        overflow-y: auto;
        position: relative;
        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        margin: auto;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }

      .modal-close {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #6b7280;
        z-index: 10;
      }

      .modal-close:hover {
        color: #374151;
      }

      .modal-header {
        padding: 25px 25px 20px;
        border-bottom: 1px solid #e5e7eb;
      }

      .modal-header h3 {
        margin: 0 0 5px 0;
        color: #1f2937;
        font-size: 1.5rem;
        font-weight: 600;
      }

      .modal-header p {
        margin: 0;
        color: #6b7280;
        font-size: 0.9rem;
      }

      .modal-body {
        padding: 20px 25px;
      }

      .modal-footer {
        padding: 20px 25px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        border-radius: 8px;
        padding: 15px 20px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        border-left: 4px solid;
        z-index: 10000;
        max-width: 400px;
        animation: slideIn 0.3s ease;
      }

      .notification.success {
        border-left-color: #10b981;
      }

      .notification.error {
        border-left-color: #ef4444;
      }

      .notification.warning {
        border-left-color: #f59e0b;
      }

      .notification.info {
        border-left-color: #3b82f6;
      }

      .notification-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .notification-message {
        color: #374151;
        font-size: 0.9rem;
        margin-right: 15px;
      }

      .notification-close {
        background: none;
        border: none;
        color: #9ca3af;
        cursor: pointer;
        font-size: 1.1rem;
        padding: 0;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .notification-close:hover {
        color: #6b7280;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .detalle-nomina-grid {
          grid-template-columns: 1fr;
        }
        
        .reportes-grid {
          grid-template-columns: 1fr;
        }
        
        .form-row {
          grid-template-columns: 1fr;
        }
        
        .modal-content {
          max-width: 95%;
          margin: 10px;
        }
        
        .modal-header, .modal-body, .modal-footer {
          padding: 15px;
        }
      }

      /* Estilos para botones peque√±os */
      .btn-sm {
        padding: 6px 12px;
        font-size: 0.8rem;
        border-radius: 4px;
      }

      /* Estilos para badges */
      .badge {
        display: inline-block;
        padding: 4px 8px;
        font-size: 0.75rem;
        font-weight: 500;
        border-radius: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .badge-success {
        background-color: #d1fae5;
        color: #065f46;
        border: 1px solid #a7f3d0;
      }

      .badge-warning {
        background-color: #fef3c7;
        color: #92400e;
        border: 1px solid #fde68a;
      }

      .badge-error {
        background-color: #fee2e2;
        color: #991b1b;
        border: 1px solid #fecaca;
      }

      .badge-info {
        background-color: #dbeafe;
        color: #1e40af;
        border: 1px solid #bfdbfe;
      }

      /* Estilos para formularios en modales */
      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #374151;
        font-size: 0.9rem;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: #f9fafb;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
        background: white;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .form-group input:hover,
      .form-group select:hover,
      .form-group textarea:hover {
        border-color: #d1d5db;
        background: white;
      }

      /* Estilos para botones de acci√≥n */
      .action-buttons {
        display: flex;
        gap: 5px;
        justify-content: center;
        align-items: center;
      }

      .action-buttons .btn {
        min-width: 32px;
        height: 32px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Estilos para Dashboard de Analytics Avanzado */
      .axyra-analytics-dashboard {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border-radius: 20px;
        padding: 30px;
        margin: 30px 0;
        border: 1px solid #e2e8f0;
      }

      .axyra-analytics-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .axyra-analytics-header h3 {
        color: #1e3a8a;
        font-size: 1.8rem;
        margin: 0 0 10px 0;
        font-weight: 700;
      }

      .axyra-analytics-header p {
        color: #64748b;
        font-size: 1.1rem;
        margin: 0;
      }

      .axyra-analytics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 25px;
      }

      .axyra-analytics-card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
      }

      .axyra-analytics-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.15);
      }

      .axyra-analytics-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f1f5f9;
      }

      .axyra-analytics-card-header h4 {
        color: #1e3a8a;
        margin: 0;
        font-size: 1.2rem;
        font-weight: 600;
      }

      .axyra-analytics-card-header p {
        color: #64748b;
        margin: 5px 0 0 0;
        font-size: 0.9rem;
      }

      .axyra-analytics-controls select {
        padding: 8px 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        background: #f8fafc;
        color: #374151;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .axyra-analytics-controls select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .axyra-analytics-chart {
        height: 250px;
        position: relative;
      }

      .axyra-analytics-metrics {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
      }

      .axyra-kpi-item {
        text-align: center;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        color: white;
      }

      .axyra-kpi-value {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .axyra-kpi-label {
        font-size: 0.9rem;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Responsive para analytics */
      @media (max-width: 768px) {
        .axyra-analytics-grid {
          grid-template-columns: 1fr;
        }
        
        .axyra-analytics-metrics {
          grid-template-columns: 1fr;
        }
      }

      /* Estilos para m√©tricas */
      .axyra-metrics-dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .metric-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 16px;
        padding: 25px;
        text-align: center;
        transition: all 0.3s ease;
        color: white;
        position: relative;
        overflow: hidden;
      }

      .metric-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .metric-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
      }

      .metric-card:hover::before {
        opacity: 1;
      }

      .metric-card:nth-child(1) {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .metric-card:nth-child(2) {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .metric-card:nth-child(3) {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .metric-card:nth-child(4) {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      }

      .metric-card:nth-child(5) {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      }

      .metric-icon {
        font-size: 2.5rem;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 15px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .metric-value {
        font-size: 2rem;
        font-weight: 800;
        color: white;
        margin-bottom: 8px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .metric-label {
        color: rgba(255, 255, 255, 0.9);
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Estilos para filtros */
      .axyra-filters {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        align-items: center;
      }

      .axyra-search-box {
        position: relative;
        flex: 1;
        min-width: 250px;
      }

      .axyra-search-box input {
        width: 100%;
        padding: 10px 40px 10px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 0.9rem;
      }

      .axyra-search-box i {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
      }

      .axyra-form-select {
        padding: 10px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 0.9rem;
        min-width: 150px;
      }

      /* Estilos para tabla */
      .axyra-table-container {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid #e2e8f0;
        margin-bottom: 20px;
      }

      .axyra-table {
        width: 100%;
        border-collapse: collapse;
      }

      .axyra-table th {
        background: #f8fafc;
        color: #1e3a8a;
        padding: 15px 12px;
        text-align: left;
        font-weight: 600;
        border-bottom: 2px solid #e2e8f0;
        font-size: 0.9rem;
      }

      .axyra-table td {
        padding: 12px;
        border-bottom: 1px solid #f1f5f9;
        font-size: 0.9rem;
      }

      .axyra-table tr:hover {
        background: #f8fafc;
      }

      /* Estilos para paginaci√≥n */
      .axyra-pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin-top: 20px;
      }

      .axyra-pagination button {
        padding: 8px 16px;
        border: 1px solid #d1d5db;
        background: white;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .axyra-pagination button:hover:not(:disabled) {
        background: #f8fafc;
        border-color: #667eea;
      }

      .axyra-pagination button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      #paginaInfo {
        color: #64748b;
        font-weight: 500;
      }

      /* Estilos para notificaciones */
      .axyra-notificacion {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        max-width: 400px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.12);
        border: 1px solid #e2e8f0;
        animation: slideInRight 0.3s ease-out;
        overflow: hidden;
      }

      .axyra-notificacion-contenido {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 20px;
      }

      .axyra-notificacion-mensaje {
        color: #1e293b;
        font-weight: 500;
        margin-right: 12px;
      }

      .axyra-notificacion-cerrar {
        background: none;
        border: none;
        color: #94a3b8;
        font-size: 20px;
        cursor: pointer;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s ease;
      }

      .axyra-notificacion-cerrar:hover {
        background: #f1f5f9;
        color: #64748b;
      }

      /* Tipos de notificaci√≥n */
      .axyra-notificacion-success {
        border-left: 4px solid #10b981;
        background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
      }

      .axyra-notificacion-error {
        border-left: 4px solid #ef4444;
        background: linear-gradient(135deg, #fef2f2 0%, #fef2f2 100%);
      }

      .axyra-notificacion-warning {
        border-left: 4px solid #f59e0b;
        background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
      }

      .axyra-notificacion-info {
        border-left: 4px solid #3b82f6;
        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      }

      /* Animaciones */
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOutRight {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      /* Mejoras en el dashboard de m√©tricas */
      .axyra-metrics-dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }

      .metric-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 16px;
        text-align: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .metric-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .metric-card:hover::before {
        opacity: 1;
      }

      .metric-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
      }

      .metric-icon {
        font-size: 2.5rem;
        margin-bottom: 15px;
        opacity: 0.9;
      }

      .metric-value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 8px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .metric-label {
        font-size: 0.9rem;
        opacity: 0.9;
        font-weight: 500;
      }

      /* Mejoras en los botones de acci√≥n */
      .axyra-actions-bar {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin: 30px 0;
        padding: 25px;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-radius: 16px;
        border: 1px solid #e2e8f0;
      }

      .axyra-btn {
        padding: 12px 24px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
        color: white;
        min-width: 140px;
        justify-content: center;
      }

      .axyra-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      }

      .axyra-btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .axyra-btn-secondary {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      }

      .axyra-btn-success {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      }

      .axyra-btn-warning {
        background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
      }

      .axyra-btn-info {
        background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%);
      }

      /* Mejoras en las tablas */
      .axyra-table {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        border: 1px solid #e2e8f0;
      }

      .axyra-table th {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        color: #1e293b;
        font-weight: 600;
        padding: 16px 20px;
        text-align: left;
        border-bottom: 2px solid #cbd5e1;
      }

      .axyra-table td {
        padding: 16px 20px;
        border-bottom: 1px solid #f1f5f9;
        color: #475569;
      }

      .axyra-table tr:hover {
        background: #f8fafc;
      }

      /* Mejoras en los filtros */
      .axyra-filters {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        margin: 30px 0;
        padding: 25px;
        background: white;
        border-radius: 16px;
        border: 1px solid #e2e8f0;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      }

      .axyra-search-box {
        position: relative;
        flex: 1;
        min-width: 250px;
      }

      .axyra-search-box input {
        width: 100%;
        padding: 12px 20px 12px 45px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        background: #f8fafc;
      }

      .axyra-search-box input:focus {
        outline: none;
        border-color: #667eea;
        background: white;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .axyra-search-box i {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: #94a3b8;
        font-size: 1.1rem;
      }

      .axyra-form-select {
        padding: 12px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 0.95rem;
        background: #f8fafc;
        color: #475569;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 180px;
      }

      .axyra-form-select:focus {
        outline: none;
        border-color: #667eea;
        background: white;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      /* Responsive design */
      @media (max-width: 768px) {
        .axyra-actions-bar {
          flex-direction: column;
        }
        
        .axyra-btn {
          width: 100%;
        }
        
        .axyra-metrics-dashboard {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
        
        .axyra-filters {
          flex-direction: column;
        }
        
        .axyra-search-box {
          min-width: 100%;
        }
      }

      /* Estilos para notificaciones */
      .axyra-notificacion {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        max-width: 400px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.12);
        border: 1px solid #e2e8f0;
        animation: slideInRight 0.3s ease-out;
        overflow: hidden;
      }

      .axyra-notificacion-contenido {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 20px;
      }

      .axyra-notificacion-mensaje {
        color: #1e293b;
        font-weight: 500;
        margin-right: 12px;
      }

      .axyra-notificacion-cerrar {
        background: none;
        border: none;
        color: #94a3b8;
        font-size: 20px;
        cursor: pointer;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s ease;
      }

      .axyra-notificacion-cerrar:hover {
        background: #f1f5f9;
        color: #64748b;
      }

      /* Tipos de notificaci√≥n */
      .axyra-notificacion-success {
        border-left: 4px solid #10b981;
        background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
      }

      .axyra-notificacion-error {
        border-left: 4px solid #ef4444;
        background: linear-gradient(135deg, #fef2f2 0%, #fef2f2 100%);
      }

      .axyra-notificacion-warning {
        border-left: 4px solid #f59e0b;
        background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
      }

      .axyra-notificacion-info {
        border-left: 4px solid #3b82f6;
        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      }

      /* Animaciones */
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* Mejoras en las tarjetas de m√©tricas */
      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 24px;
        margin-bottom: 32px;
      }

      .metric-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 20px;
        padding: 32px 24px;
        text-align: center;
        color: white;
        box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .metric-card:nth-child(1) {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .metric-card:nth-child(2) {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .metric-card:nth-child(3) {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .metric-card:nth-child(4) {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      }

      .metric-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4);
      }

      .metric-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
        pointer-events: none;
      }

      .metric-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.9;
      }

      .metric-value {
        font-size: 36px;
        font-weight: 700;
        margin-bottom: 8px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .metric-label {
        font-size: 16px;
        font-weight: 500;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Mejoras en botones de acci√≥n */
      .action-buttons {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        margin-bottom: 32px;
      }

      .action-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 16px 32px;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
      }

      .action-btn.secondary {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        box-shadow: 0 4px 20px rgba(240, 147, 251, 0.3);
      }

      .action-btn.secondary:hover {
        box-shadow: 0 8px 30px rgba(240, 147, 251, 0.4);
      }

      .action-btn.success {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        box-shadow: 0 4px 20px rgba(67, 233, 123, 0.3);
      }

      .action-btn.success:hover {
        box-shadow: 0 8px 30px rgba(67, 233, 123, 0.4);
      }

      /* Mejoras en la tabla */
      .table-container {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 8px 40px rgba(0,0,0,0.1);
        border: 1px solid #e2e8f0;
      }

      .table-header {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        padding: 24px;
        border-bottom: 2px solid #cbd5e1;
      }

      .table-title {
        font-size: 24px;
        font-weight: 700;
        color: #1e293b;
        margin: 0;
      }

      .table-subtitle {
        color: #64748b;
        margin: 8px 0 0 0;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .metrics-grid {
          grid-template-columns: 1fr;
          gap: 16px;
        }

        .metric-card {
          padding: 24px 16px;
        }

        .metric-value {
          font-size: 28px;
        }

        .action-buttons {
          flex-direction: column;
        }

        .action-btn {
          width: 100%;
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header Compartido AXYRA - Se insertar√° autom√°ticamente -->

    <!-- Contenido Principal -->
    <main class="axyra-section">
      <div class="axyra-container">
        <div class="axyra-page-header">
          <h1 class="axyra-page-title">Gesti√≥n de N√≥mina</h1>
          <p class="axyra-page-subtitle">Genera y gestiona las n√≥minas de tus empleados</p>
        </div>

        <!-- Botones de Acci√≥n -->
        <div class="axyra-actions-bar">
          <button class="axyra-btn axyra-btn-primary" onclick="mostrarModal('modalGenerarNomina')">
            <i class="fas fa-plus"></i> Generar N√≥mina
          </button>
          <button class="axyra-btn axyra-btn-secondary" onclick="exportarNomina()">
            <i class="fas fa-download"></i> Exportar a Excel
          </button>
          <button class="axyra-btn axyra-btn-success" onclick="generarComprobantePDF()">
            <i class="fas fa-file-pdf"></i> Generar PDF
          </button>
          <button class="axyra-btn axyra-btn-warning" onclick="generarReportesNomina()">
            <i class="fas fa-chart-bar"></i> Reportes
          </button>
          <button class="axyra-btn axyra-btn-info" onclick="configuracionAvanzadaNomina()">
            <i class="fas fa-cog"></i> Configuraci√≥n
          </button>
        </div>

        <!-- Dashboard de M√©tricas -->
        <div class="axyra-metrics-dashboard">
          <div class="metric-card">
            <div class="metric-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="totalEmpleados">0</div>
              <div class="metric-label">Total Empleados</div>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-icon">
              <i class="fas fa-file-invoice-dollar"></i>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="totalNominas">0</div>
              <div class="metric-label">N√≥minas Generadas</div>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-icon">
              <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="costoTotalEmpresa">$0</div>
              <div class="metric-label">Costo Total Empresa</div>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="totalHorasTrabajadas">0 hrs</div>
              <div class="metric-label">Total Horas Trabajadas</div>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-icon">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="promedioSalario">$0</div>
              <div class="metric-label">Promedio Salario</div>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-icon">
              <i class="fas fa-calendar-check"></i>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="nominasEsteMes">0</div>
              <div class="metric-label">N√≥minas Este Mes</div>
            </div>
          </div>
        </div>

        <!-- Dashboard de Analytics Avanzado -->
        <div class="axyra-analytics-dashboard">
          <div class="axyra-analytics-header">
            <h3>üìä Analytics Avanzado de N√≥mina</h3>
            <p>An√°lisis detallado de costos laborales y tendencias</p>
          </div>
          
          <div class="axyra-analytics-grid">
            <!-- Gr√°fico de Costos por Mes -->
            <div class="axyra-analytics-card">
              <div class="axyra-analytics-card-header">
                <h4>üí∞ Costos Laborales por Mes</h4>
                <div class="axyra-analytics-controls">
                  <select id="chartYear" onchange="actualizarGraficos()">
                    <option value="2024">2024</option>
                    <option value="2025" selected>2025</option>
                  </select>
                </div>
              </div>
              <div class="axyra-analytics-chart">
                <canvas id="costosMensualesChart"></canvas>
              </div>
            </div>

            <!-- Gr√°fico de Distribuci√≥n de Salarios -->
            <div class="axyra-analytics-card">
              <div class="axyra-analytics-card-header">
                <h4>üìà Distribuci√≥n de Salarios</h4>
                <p>An√°lisis de rangos salariales</p>
              </div>
              <div class="axyra-analytics-chart">
                <canvas id="distribucionSalariosChart"></canvas>
              </div>
            </div>

            <!-- Gr√°fico de Horas por Empleado -->
            <div class="axyra-analytics-card">
              <div class="axyra-analytics-card-header">
                <h4>‚è∞ Horas Trabajadas por Empleado</h4>
                <p>Productividad y eficiencia</p>
              </div>
              <div class="axyra-analytics-chart">
                <canvas id="horasEmpleadoChart"></canvas>
              </div>
            </div>

            <!-- M√©tricas de Eficiencia -->
            <div class="axyra-analytics-card">
              <div class="axyra-analytics-card-header">
                <h4>üéØ KPIs de Eficiencia</h4>
                <p>Indicadores clave de rendimiento</p>
              </div>
              <div class="axyra-analytics-metrics">
                <div class="axyra-kpi-item">
                  <div class="axyra-kpi-value" id="costoPorHora">$0</div>
                  <div class="axyra-kpi-label">Costo por Hora</div>
                </div>
                <div class="axyra-kpi-item">
                  <div class="axyra-kpi-value" id="productividadPromedio">0%</div>
                  <div class="axyra-kpi-label">Productividad</div>
                </div>
                <div class="axyra-kpi-item">
                  <div class="axyra-kpi-value" id="rotacionPersonal">0%</div>
                  <div class="axyra-kpi-label">Rotaci√≥n</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Filtros y B√∫squeda -->
        <div class="axyra-filters">
          <div class="axyra-search-box">
            <input type="text" id="searchInput" class="axyra-form-input" placeholder="Buscar por empleado..." />
            <i class="fas fa-search"></i>
          </div>
          <select id="filterEmpleado" class="axyra-form-select">
            <option value="">Todos los empleados</option>
          </select>
          <select id="filterMes" class="axyra-form-select">
            <option value="">Todos los meses</option>
            <option value="1">Enero</option>
            <option value="2">Febrero</option>
            <option value="3">Marzo</option>
            <option value="4">Abril</option>
            <option value="5">Mayo</option>
            <option value="6">Junio</option>
            <option value="7">Julio</option>
            <option value="8">Agosto</option>
            <option value="9">Septiembre</option>
            <option value="10">Octubre</option>
            <option value="11">Noviembre</option>
            <option value="12">Diciembre</option>
          </select>
          <select id="filterAnio" class="axyra-form-select">
            <option value="">Todos los a√±os</option>
          </select>
        </div>

        <!-- Tabla de N√≥minas -->
        <div class="axyra-table-container">
          <table class="axyra-table" id="nominasTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Empleado</th>
                <th>Per√≠odo</th>
                <th>Horas Normales</th>
                <th>Horas Extras</th>
                <th>Horas Nocturnas</th>
                <th>Horas Dominicales</th>
                <th>Salario Base</th>
                <th>Bonificaciones</th>
                <th>Deducciones</th>
                <th>Salario Neto</th>
                <th>Costo Empresa</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="nominasTableBody">
              <!-- Las n√≥minas se cargar√°n aqu√≠ din√°micamente -->
            </tbody>
          </table>
        </div>

        <!-- Paginaci√≥n -->
        <div class="axyra-pagination">
          <button class="axyra-btn axyra-btn-ghost" onclick="cambiarPagina(-1)">
            <i class="fas fa-chevron-left"></i> Anterior
          </button>
          <span id="paginaInfo">P√°gina 1 de 1</span>
          <button class="axyra-btn axyra-btn-ghost" onclick="cambiarPagina(1)">
            Siguiente <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </main>

    <!-- Modal Generar N√≥mina -->
    <div id="modalGenerarNomina" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close" onclick="cerrarModal('modalGenerarNomina')">
          <i class="fas fa-times"></i>
        </button>
        <div class="modal-header">
          <h3>Generar N√≥mina</h3>
          <p>Selecciona los par√°metros para generar la n√≥mina</p>
        </div>
        <div class="modal-body">
          <form id="formNomina" onsubmit="generarNomina(event)">
            <div class="form-row">
              <div class="form-group">
                <label for="empleadoNomina">Empleado *</label>
                <select id="empleadoNomina" class="form-input" required>
                  <option value="">Seleccionar empleado</option>
                </select>
              </div>
              <div class="form-group">
                <label for="mesNomina">Mes *</label>
                <select id="mesNomina" class="form-input" required>
                  <option value="">Seleccionar mes</option>
                  <option value="1">Enero</option>
                  <option value="2">Febrero</option>
                  <option value="3">Marzo</option>
                  <option value="4">Abril</option>
                  <option value="5">Mayo</option>
                  <option value="6">Junio</option>
                  <option value="7">Julio</option>
                  <option value="8">Agosto</option>
                  <option value="9">Septiembre</option>
                  <option value="10">Octubre</option>
                  <option value="11">Noviembre</option>
                  <option value="12">Diciembre</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="anioNomina">A√±o *</label>
                <select id="anioNomina" class="form-input" required>
                  <option value="">Seleccionar a√±o</option>
                </select>
              </div>
              <div class="form-group">
                <label for="tipoNomina">Tipo de N√≥mina</label>
                <select id="tipoNomina" class="form-input">
                  <option value="mensual">Mensual</option>
                  <option value="quincenal">Quincenal</option>
                  <option value="semanal">Semanal</option>
                </select>
              </div>
            </div>

            <div id="resumenNomina" class="resumen-nomina" style="display: none">
              <h4>Resumen de la N√≥mina</h4>
              <div id="detallesNomina"></div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="cerrarModal('modalGenerarNomina')">Cancelar</button>
          <button class="btn btn-primary" onclick="generarNomina()">Generar N√≥mina</button>
        </div>
      </div>
    </div>

    <!-- Modal Configuraci√≥n de N√≥mina -->
    <div id="modalConfiguracionNomina" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close" onclick="cerrarModal('modalConfiguracionNomina')">
          <i class="fas fa-times"></i>
        </button>
        <div class="modal-header">
          <h3>Configuraci√≥n de N√≥mina</h3>
          <p>Configura los par√°metros del sistema de n√≥mina</p>
        </div>
        <div class="modal-body">
          <form id="formConfiguracionNomina">
            <div class="form-group">
              <label for="salarioMinimo">Salario M√≠nimo Legal Vigente</label>
              <input type="number" id="salarioMinimo" class="form-input" min="0" step="1000" />
            </div>

            <div class="form-group">
              <label for="porcentajeCesantias">Porcentaje Cesant√≠as (%)</label>
              <input type="number" id="porcentajeCesantias" class="form-input" min="0" max="100" step="0.1" />
            </div>

            <div class="form-group">
              <label for="porcentajePrima">Porcentaje Prima de Servicios (%)</label>
              <input type="number" id="porcentajePrima" class="form-input" min="0" max="100" step="0.1" />
            </div>

            <div class="form-group">
              <label for="porcentajeInteresesCesantias">Porcentaje Intereses sobre Cesant√≠as (%)</label>
              <input type="number" id="porcentajeInteresesCesantias" class="form-input" min="0" max="100" step="0.1" />
            </div>

            <div class="form-group">
              <label for="porcentajeSalud">Porcentaje Salud (%)</label>
              <input type="number" id="porcentajeSalud" class="form-input" min="0" max="100" step="0.1" />
            </div>

            <div class="form-group">
              <label for="porcentajePension">Porcentaje Pensi√≥n (%)</label>
              <input type="number" id="porcentajePension" class="form-input" min="0" max="100" step="0.1" />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="cerrarModal('modalConfiguracionNomina')">Cancelar</button>
          <button class="btn btn-primary" onclick="guardarConfiguracionNomina()">Guardar Configuraci√≥n</button>
        </div>
      </div>
    </div>

    <!-- Modal Reportes Avanzados -->
    <div id="modalReportesAvanzados" class="modal-overlay" style="display: none">
      <div class="modal-content" style="max-width: 800px">
        <button class="modal-close" onclick="cerrarModal('modalReportesAvanzados')">
          <i class="fas fa-times"></i>
        </button>
        <div class="modal-header">
          <h3>Reportes Avanzados de N√≥mina</h3>
          <p>Genera reportes detallados y an√°lisis de costos laborales</p>
        </div>
        <div class="modal-body">
          <div class="reportes-grid">
            <div class="reporte-card" onclick="generarReporte('costosLaborales')">
              <div class="reporte-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="reporte-content">
                <h4>Reporte de Costos Laborales</h4>
                <p>An√°lisis detallado de costos por empleado y per√≠odo</p>
              </div>
            </div>

            <div class="reporte-card" onclick="generarReporte('prestacionesSociales')">
              <div class="reporte-icon">
                <i class="fas fa-hand-holding-usd"></i>
              </div>
              <div class="reporte-content">
                <h4>Prestaciones Sociales</h4>
                <p>Resumen de cesant√≠as, prima de servicios e intereses</p>
              </div>
            </div>

            <div class="reporte-card" onclick="generarReporte('horasTrabajadas')">
              <div class="reporte-icon">
                <i class="fas fa-clock"></i>
              </div>
              <div class="reporte-content">
                <h4>An√°lisis de Horas</h4>
                <p>Estad√≠sticas de horas normales, extras y especiales</p>
              </div>
            </div>

            <div class="reporte-card" onclick="generarReporte('comparativoSalarios')">
              <div class="reporte-icon">
                <i class="fas fa-balance-scale"></i>
              </div>
              <div class="reporte-content">
                <h4>Comparativo de Salarios</h4>
                <p>Comparaci√≥n de salarios por departamento y cargo</p>
              </div>
            </div>

            <div class="reporte-card" onclick="generarReporte('tendenciasSalariales')">
              <div class="reporte-icon">
                <i class="fas fa-trending-up"></i>
              </div>
              <div class="reporte-content">
                <h4>Tendencias Salariales</h4>
                <p>Evoluci√≥n de salarios a lo largo del tiempo</p>
              </div>
            </div>

            <div class="reporte-card" onclick="generarReporte('resumenMensual')">
              <div class="reporte-icon">
                <i class="fas fa-calendar-alt"></i>
              </div>
              <div class="reporte-content">
                <h4>Resumen Mensual</h4>
                <p>Resumen completo de n√≥mina del mes</p>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="cerrarModal('modalReportesAvanzados')">Cerrar</button>
        </div>
      </div>
    </div>

    <!-- Modal de Confirmaci√≥n -->
    <div id="modalConfirmacion" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalConfirmacionTitulo">Confirmar Acci√≥n</h3>
          <p id="modalConfirmacionMensaje">¬øEst√°s seguro de que quieres realizar esta acci√≥n?</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="cerrarModal('modalConfirmacion')">Cancelar</button>
          <button class="btn btn-danger" id="btnConfirmarAccion">Confirmar</button>
        </div>
      </div>
    </div>

    <!-- Modal Detalle de N√≥mina -->
    <div id="modalDetalleNomina" class="modal-overlay" style="display: none">
      <div class="modal-content" style="max-width: 800px">
        <button class="modal-close" onclick="cerrarModal('modalDetalleNomina')">
          <i class="fas fa-times"></i>
        </button>
        <div class="modal-header">
          <h3 id="detalleNominaTitulo">Detalle de N√≥mina</h3>
          <p>Informaci√≥n completa de la n√≥mina generada</p>
        </div>
        <div class="modal-body">
          <div class="detalle-nomina-grid">
            <div class="detalle-section">
              <h4>Informaci√≥n General</h4>
              <div class="detalle-row">
                <span class="detalle-label">Empleado:</span>
                <span class="detalle-value" id="detalleNominaEmpleado"></span>
              </div>
              <div class="detalle-row">
                <span class="detalle-label">Per√≠odo:</span>
                <span class="detalle-value" id="detalleNominaPeriodo"></span>
              </div>
              <div class="detalle-row">
                <span class="detalle-label">Tipo:</span>
                <span class="detalle-value" id="detalleNominaTipo"></span>
              </div>
            </div>

            <div class="detalle-section">
              <h4>Horas Trabajadas</h4>
              <div class="detalle-row">
                <span class="detalle-label">Normales:</span>
                <span class="detalle-value" id="detalleHorasNormales"></span>
              </div>
              <div class="detalle-row">
                <span class="detalle-label">Extras:</span>
                <span class="detalle-value" id="detalleHorasExtras"></span>
              </div>
              <div class="detalle-row">
                <span class="detalle-label">Nocturnas:</span>
                <span class="detalle-value" id="detalleHorasNocturnas"></span>
              </div>
              <div class="detalle-row">
                <span class="detalle-label">Dominicales:</span>
                <span class="detalle-value" id="detalleHorasDominicales"></span>
              </div>
            </div>

            <div class="detalle-section">
              <h4>Liquidaci√≥n</h4>
              <div class="detalle-row">
                <span class="detalle-label">Salario Base:</span>
                <span class="detalle-value" id="detalleSalarioBase"></span>
              </div>
              <div class="detalle-row">
                <span class="detalle-label">Subtotal:</span>
                <span class="detalle-value" id="detalleSubtotalSalario"></span>
              </div>
              <div class="detalle-row">
                <span class="detalle-label">Bonificaciones:</span>
                <span class="detalle-value" id="detalleBonificaciones"></span>
              </div>
              <div class="detalle-row">
                <span class="detalle-label">Deducciones:</span>
                <span class="detalle-value" id="detalleDeducciones"></span>
              </div>
              <div class="detalle-row total">
                <span class="detalle-label">Salario Neto:</span>
                <span class="detalle-value" id="detalleSalarioNeto"></span>
              </div>
            </div>

            <div class="detalle-section">
              <h4>Prestaciones Sociales</h4>
              <div class="detalle-row">
                <span class="detalle-label">Cesant√≠as:</span>
                <span class="detalle-value" id="detalleCesantias"></span>
              </div>
              <div class="detalle-row">
                <span class="detalle-label">Prima Servicios:</span>
                <span class="detalle-value" id="detallePrimaServicios"></span>
              </div>
              <div class="detalle-row">
                <span class="detalle-label">Intereses:</span>
                <span class="detalle-value" id="detalleInteresesCesantias"></span>
              </div>
            </div>

            <div class="detalle-section">
              <h4>Costos del Empleador</h4>
              <div class="detalle-row">
                <span class="detalle-label">Salud:</span>
                <span class="detalle-value" id="detalleSaludEmpleador"></span>
              </div>
              <div class="detalle-row">
                <span class="detalle-label">Pensi√≥n:</span>
                <span class="detalle-value" id="detallePensionEmpleador"></span>
              </div>
              <div class="detalle-row">
                <span class="detalle-label">Riesgos Laborales:</span>
                <span class="detalle-value" id="detalleRiesgosLaborales"></span>
              </div>
              <div class="detalle-row total">
                <span class="detalle-label">Costo Total:</span>
                <span class="detalle-value" id="detalleCostoTotalEmpresa"></span>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="cerrarModal('modalDetalleNomina')">Cerrar</button>
          <button class="btn btn-primary" onclick="generarComprobantePDFIndividual()">
            <i class="fas fa-file-pdf"></i> Generar PDF
          </button>
        </div>
      </div>
    </div>

    <!-- Sistema de Notificaciones -->
    <div id="notificationContainer"></div>

    <script>
      // Variables globales
      let nominas = [];
      let empleados = [];
      let horas = [];
      let paginaActual = 1;
      const nominasPorPagina = 10;
      let currentUser = null;

      // Inicializaci√≥n cuando se carga la p√°gina
      document.addEventListener('DOMContentLoaded', function () {
        inicializarNomina();
        configurarEventos();
        
        // Inicializar gr√°ficos de analytics despu√©s de un breve delay
        setTimeout(() => {
          inicializarGraficosAnalytics();
        }, 500);
      });

      // Funci√≥n para obtener nombre del mes
      function obtenerNombreMes(mes) {
        const meses = [
          'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
          'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
        ];
        return meses[mes - 1] || 'Mes inv√°lido';
      }

      // Funci√≥n para formatear moneda
      function formatearMoneda(valor) {
        if (typeof valor !== 'number' || isNaN(valor)) {
          return '$0';
        }
        return new Intl.NumberFormat('es-CO', {
          style: 'currency',
          currency: 'COP',
          minimumFractionDigits: 0,
          maximumFractionDigits: 0
        }).format(valor);
      }

      // Funci√≥n para cargar datos desde Firebase
      async function cargarDatosFirebase() {
        try {
          console.log('üîÑ Cargando datos desde Firebase...');
          
          // Verificar si Firebase est√° disponible
          if (typeof firebase === 'undefined' || !firebase.firestore) {
            console.warn('‚ö†Ô∏è Firebase no disponible, usando localStorage como fallback');
            await cargarDatosLocalStorage();
            return;
          }

          const db = firebase.firestore();
          const userId = currentUser?.id || currentUser?.username || currentUser?.email;

          if (!userId) {
            console.warn('‚ö†Ô∏è No se puede identificar usuario, usando localStorage');
            await cargarDatosLocalStorage();
            return;
          }

          // Cargar empleados desde Firebase
          try {
            const empleadosSnapshot = await db.collection('empleados')
              .where('userId', '==', userId)
              .get();
            
            empleados = empleadosSnapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            console.log(`‚úÖ ${empleados.length} empleados cargados desde Firebase`);
          } catch (error) {
            console.warn('‚ö†Ô∏è Error cargando empleados desde Firebase:', error);
            empleados = [];
          }

          // Cargar horas desde Firebase
          try {
            const horasSnapshot = await db.collection('horas')
              .where('userId', '==', userId)
              .get();
            
            horas = horasSnapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            console.log(`‚úÖ ${horas.length} horas cargadas desde Firebase`);
          } catch (error) {
            console.warn('‚ö†Ô∏è Error cargando horas desde Firebase:', error);
            horas = [];
          }

          // Cargar n√≥minas desde Firebase
          try {
            const nominasSnapshot = await db.collection('nominas')
              .where('userId', '==', userId)
              .get();
            
            nominas = nominasSnapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            console.log(`‚úÖ ${nominas.length} n√≥minas cargadas desde Firebase`);
          } catch (error) {
            console.warn('‚ö†Ô∏è Error cargando n√≥minas desde Firebase:', error);
            nominas = [];
          }

          // Guardar en localStorage como backup
          localStorage.setItem('axyra_empleados', JSON.stringify(empleados));
          localStorage.setItem('axyra_horas', JSON.stringify(horas));
          localStorage.setItem('axyra_nominas', JSON.stringify(nominas));

        } catch (error) {
          console.error('‚ùå Error cargando datos desde Firebase:', error);
          // Fallback a localStorage
          await cargarDatosLocalStorage();
        }
      }

      // Funci√≥n para cargar datos desde localStorage (fallback)
      async function cargarDatosLocalStorage() {
        try {
          console.log('üîÑ Cargando datos desde localStorage...');
          
          // Cargar empleados
          const empleadosData = localStorage.getItem('axyra_empleados');
          if (empleadosData) {
            empleados = JSON.parse(empleadosData);
            // Filtrar por usuario actual
            empleados = empleados.filter((e) => {
              if (!e.userId) return true; // Datos globales
              return e.userId === currentUser?.username;
            });
          }

          // Cargar horas
          const horasData = localStorage.getItem('axyra_horas');
          if (horasData) {
            horas = JSON.parse(horasData);
            // Filtrar por usuario actual
            horas = horas.filter((h) => {
              if (!h.userId) return true; // Datos globales
              return h.userId === currentUser?.username;
            });
          }

          // Cargar n√≥minas
          const nominasData = localStorage.getItem('axyra_nominas');
          if (nominasData) {
            nominas = JSON.parse(nominasData);
            // Filtrar por usuario actual
            nominas = nominas.filter((n) => {
              if (!n.userId) return true; // Datos globales
              return n.userId === currentUser?.username;
            });
          }

          console.log(
            `‚úÖ Datos cargados desde localStorage: ${empleados.length} empleados, ${horas.length} horas, ${nominas.length} n√≥minas`
          );
          
        } catch (error) {
          console.error('‚ùå Error cargando datos desde localStorage:', error);
        }
      }

      // Funci√≥n de inicializaci√≥n mejorada
      async function inicializarNomina() {
        try {
          console.log('üöÄ Inicializando m√≥dulo de n√≥mina...');
          
          // Verificar autenticaci√≥n
          await verificarAutenticacion();

          // Intentar cargar desde Firebase primero
          await cargarDatosFirebase();

          // Llenar selects
          llenarSelects();

          // Renderizar tabla
          renderizarTablaNominas();

          // Configurar listener para cambios en empleados
          configurarListenerCambiosEmpleados();

          console.log('‚úÖ M√≥dulo de n√≥mina inicializado correctamente');
        } catch (error) {
          console.error('‚ùå Error inicializando n√≥mina:', error);
          mostrarNotificacion('Error inicializando m√≥dulo de n√≥mina', 'error');
        }
      }

      // Verificar autenticaci√≥n
      async function verificarAutenticacion() {
        try {
          // Usar el sistema de autenticaci√≥n si est√° disponible
          if (window.axyraAuth && window.axyraAuth.isAuthenticated) {
            currentUser = window.axyraAuth.currentUser;
            console.log('‚úÖ Usuario autenticado con sistema AXYRA:', currentUser?.username);
            return;
          }

          // Fallback: verificar localStorage
          const userData = localStorage.getItem('axyra_isolated_user');
          if (!userData) {
            window.location.href = '../../login.html';
            return;
          }

          currentUser = JSON.parse(userData);
          console.log('‚úÖ Usuario autenticado con localStorage:', currentUser.username);
        } catch (error) {
          console.error('‚ùå Error verificando autenticaci√≥n:', error);
          window.location.href = '../../login.html';
        }
      }

      // Cargar datos desde localStorage
      async function cargarDatos() {
        try {
          // Cargar empleados
          const empleadosData = localStorage.getItem('axyra_empleados');
          if (empleadosData) {
            empleados = JSON.parse(empleadosData);
            // Filtrar por usuario actual
            empleados = empleados.filter((e) => {
              if (!e.userId) return true; // Datos globales
              return e.userId === currentUser?.username;
            });
          }

          // Cargar horas
          const horasData = localStorage.getItem('axyra_horas');
          if (horasData) {
            horas = JSON.parse(horasData);
            // Filtrar por usuario actual
            horas = horas.filter((h) => {
              if (!h.userId) return true; // Datos globales
              return h.userId === currentUser?.username;
            });
          }

          // Cargar n√≥minas
          const nominasData = localStorage.getItem('axyra_nominas');
          if (nominasData) {
            nominas = JSON.parse(nominasData);
            // Filtrar por usuario actual
            nominas = nominas.filter((n) => {
              if (!n.userId) return true; // Datos globales
              return n.userId === currentUser?.username;
            });
          }

          console.log(
            `‚úÖ Datos cargados: ${empleados.length} empleados, ${horas.length} horas, ${nominas.length} n√≥minas`
          );
          
          // Verificar si hay datos y mostrar notificaci√≥n si no
          if (empleados.length === 0) {
            console.warn('‚ö†Ô∏è No hay empleados registrados para el usuario actual');
          }
          if (horas.length === 0) {
            console.warn('‚ö†Ô∏è No hay horas registradas para el usuario actual');
          }
          if (nominas.length === 0) {
            console.warn('‚ö†Ô∏è No hay n√≥minas generadas para el usuario actual');
          }
        } catch (error) {
          console.error('‚ùå Error cargando datos:', error);
        }
      }

      // Llenar selects
      function llenarSelects() {
        // Select de empleados
        const selectsEmpleados = ['empleadoNomina', 'filterEmpleado'];
        selectsEmpleados.forEach((selectId) => {
          const select = document.getElementById(selectId);
          if (select) {
            select.innerHTML = '<option value="">Seleccionar empleado</option>';
            empleados.forEach((empleado) => {
              const option = document.createElement('option');
              option.value = empleado.id;
              option.textContent = `${empleado.nombre} (${empleado.cargo || 'Sin cargo'})`;
              select.appendChild(option);
            });
          }
        });

        // Select de a√±os
        const anioActual = new Date().getFullYear();
        const selectAnio = document.getElementById('anioNomina');
        if (selectAnio) {
          selectAnio.innerHTML = '<option value="">Seleccionar a√±o</option>';
          for (let anio = anioActual - 2; anio <= anioActual + 1; anio++) {
            const option = document.createElement('option');
            option.value = anio;
            option.textContent = anio;
            if (anio === anioActual) option.selected = true;
            selectAnio.appendChild(option);
          }
        }

        // Select de a√±os para filtro
        const filterAnio = document.getElementById('filterAnio');
        if (filterAnio) {
          filterAnio.innerHTML = '<option value="">Todos los a√±os</option>';
          for (let anio = anioActual - 2; anio <= anioActual + 1; anio++) {
            const option = document.createElement('option');
            option.value = anio;
            option.textContent = anio;
            filterAnio.appendChild(option);
          }
        }
      }

      // Configurar eventos
      function configurarEventos() {
        try {
          // Evento de b√∫squeda
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', () => {
              paginaActual = 1; // Resetear a primera p√°gina
              renderizarTablaNominas();
            });
        }

          // Eventos de filtros
        const filterEmpleado = document.getElementById('filterEmpleado');
        if (filterEmpleado) {
            filterEmpleado.addEventListener('change', () => {
              paginaActual = 1;
              renderizarTablaNominas();
            });
        }

        const filterMes = document.getElementById('filterMes');
        if (filterMes) {
            filterMes.addEventListener('change', () => {
              paginaActual = 1;
              renderizarTablaNominas();
            });
        }

        const filterAnio = document.getElementById('filterAnio');
        if (filterAnio) {
            filterAnio.addEventListener('change', () => {
              paginaActual = 1;
              renderizarTablaNominas();
            });
          }

          // Configurar eventos de modales
          configurarEventosModales();

          console.log('‚úÖ Eventos configurados correctamente');
        } catch (error) {
          console.error('‚ùå Error configurando eventos:', error);
        }
      }

      // Funci√≥n para formatear moneda
      function formatearMoneda(valor) {
        if (typeof valor !== 'number' || isNaN(valor)) {
          return '$0';
        }
        return new Intl.NumberFormat('es-CO', {
          style: 'currency',
          currency: 'COP',
          minimumFractionDigits: 0,
          maximumFractionDigits: 0
        }).format(valor);
      }

      // Funci√≥n para renderizar tabla de n√≥minas
      function renderizarTablaNominas() {
        try {
        const tbody = document.getElementById('nominasTableBody');
        if (!tbody) return;

          tbody.innerHTML = '';

          if (nominas.length === 0) {
          tbody.innerHTML = `
            <tr>
                <td colspan="14" style="text-align: center; padding: 40px; color: #6b7280;">
                  <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px; display: block; color: #d1d5db;"></i>
                  <p>No hay n√≥minas generadas</p>
                  <p style="font-size: 0.9rem; margin-top: 5px;">Genera tu primera n√≥mina usando el bot√≥n "Generar N√≥mina"</p>
              </td>
            </tr>
          `;
          return;
        }

          // Aplicar filtros si existen
          let nominasFiltradas = nominas;
          const searchTerm = document.getElementById('searchInput')?.value?.toLowerCase();
          const filterEmpleado = document.getElementById('filterEmpleado')?.value;
          const filterMes = document.getElementById('filterMes')?.value;
          const filterAnio = document.getElementById('filterAnio')?.value;

          if (searchTerm || filterEmpleado || filterMes || filterAnio) {
            nominasFiltradas = nominas.filter((nomina) => {
          const empleado = empleados.find((e) => e.id === nomina.empleado_id);
              if (!empleado) return false;

              // Filtro de b√∫squeda
              if (searchTerm && !empleado.nombre.toLowerCase().includes(searchTerm)) {
                return false;
              }

              // Filtro de empleado
              if (filterEmpleado && nomina.empleado_id != filterEmpleado) {
                return false;
              }

              // Filtro de mes
              if (filterMes && nomina.mes != filterMes) {
                return false;
              }

              // Filtro de a√±o
              if (filterAnio && nomina.anio != filterAnio) {
                return false;
              }

              return true;
            });
          }

          // Aplicar paginaci√≥n
          const inicio = (paginaActual - 1) * nominasPorPagina;
          const fin = inicio + nominasPorPagina;
          const nominasPaginadas = nominasFiltradas.slice(inicio, fin);

          // Renderizar filas
          nominasPaginadas.forEach((nomina) => {
            const empleado = empleados.find((e) => e.id === nomina.empleado_id);
            if (!empleado) return;

            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${nomina.id}</td>
              <td>${empleado.nombre}</td>
              <td>${obtenerNombreMes(nomina.mes)} ${nomina.anio}</td>
              <td>${(nomina.horas_trabajadas || 0).toLocaleString('es-CO')}</td>
              <td>${(nomina.horas_extras || 0).toLocaleString('es-CO')}</td>
              <td>${(nomina.horas_nocturnas || 0).toLocaleString('es-CO')}</td>
              <td>${(nomina.horas_dominicales || 0).toLocaleString('es-CO')}</td>
              <td>${formatearMoneda(nomina.salario_base)}</td>
              <td>${formatearMoneda(nomina.bonificaciones || 0)}</td>
              <td>${formatearMoneda(nomina.deducciones || 0)}</td>
              <td>${formatearMoneda(nomina.salario_neto)}</td>
              <td>${formatearMoneda(nomina.costo_total_empresa)}</td>
              <td>
                <span class="badge badge-success">${nomina.estado || 'Generada'}</span>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn btn-sm btn-info" onclick="verNomina(${nomina.id})" title="Ver detalles">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-sm btn-success" onclick="generarComprobantePDFIndividual()" title="Generar PDF">
                    <i class="fas fa-file-pdf"></i>
                  </button>
                  <button class="btn btn-sm btn-danger" onclick="eliminarNomina(${nomina.id})" title="Eliminar">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            `;
            tbody.appendChild(row);
          });

          // Actualizar informaci√≥n de paginaci√≥n
          actualizarPaginacion(nominasFiltradas.length);

          // Actualizar m√©tricas
          actualizarMetricas();
        } catch (error) {
          console.error('‚ùå Error renderizando tabla de n√≥minas:', error);
        }
      }

      // Funci√≥n para actualizar paginaci√≥n
      function actualizarPaginacion(totalNominas) {
        const totalPaginas = Math.ceil(totalNominas / nominasPorPagina);
        const paginaInfo = document.getElementById('paginaInfo');
        
        if (paginaInfo) {
          paginaInfo.textContent = `P√°gina ${paginaActual} de ${totalPaginas}`;
        }

        // Habilitar/deshabilitar botones de paginaci√≥n
        const btnAnterior = document.querySelector('button[onclick="cambiarPagina(-1)"]');
        const btnSiguiente = document.querySelector('button[onclick="cambiarPagina(1)"]');
        
        if (btnAnterior) {
          btnAnterior.disabled = paginaActual <= 1;
        }
        
        if (btnSiguiente) {
          btnSiguiente.disabled = paginaActual >= totalPaginas;
        }
      }

      // Funci√≥n para cambiar p√°gina
      window.cambiarPagina = function(direccion) {
        const totalPaginas = Math.ceil(nominas.length / nominasPorPagina);
        const nuevaPagina = paginaActual + direccion;
        
        if (nuevaPagina >= 1 && nuevaPagina <= totalPaginas) {
          paginaActual = nuevaPagina;
        renderizarTablaNominas();
        }
      }

      // Funci√≥n para actualizar m√©tricas
      function actualizarMetricas() {
        try {
          // Total empleados
          const totalEmpleadosElement = document.getElementById('totalEmpleados');
          if (totalEmpleadosElement) {
            totalEmpleadosElement.textContent = empleados.length;
          }

          // Total n√≥minas
          const totalNominasElement = document.getElementById('totalNominas');
          if (totalNominasElement) {
            totalNominasElement.textContent = nominas.length;
          }

          // Costo total empresa
          const costoTotalEmpresaElement = document.getElementById('costoTotalEmpresa');
          if (costoTotalEmpresaElement) {
            const costoTotal = nominas.reduce((sum, n) => sum + (n.costo_total_empresa || 0), 0);
            costoTotalEmpresaElement.textContent = formatearMoneda(costoTotal);
          }

          // Total horas trabajadas
          const totalHorasTrabajadasElement = document.getElementById('totalHorasTrabajadas');
          if (totalHorasTrabajadasElement) {
            const totalHoras = nominas.reduce((sum, n) => sum + (n.horas_trabajadas || 0), 0);
            totalHorasTrabajadasElement.textContent = `${totalHoras.toLocaleString('es-CO')} hrs`;
          }

          // Promedio salario
          const promedioSalarioElement = document.getElementById('promedioSalario');
          if (promedioSalarioElement) {
            const promedio = nominas.length > 0 ? 
              nominas.reduce((sum, n) => sum + (n.salario_neto || 0), 0) / nominas.length : 0;
            promedioSalarioElement.textContent = formatearMoneda(promedio);
          }

          // N√≥minas este mes
          const nominasEsteMesElement = document.getElementById('nominasEsteMes');
          if (nominasEsteMesElement) {
            const mesActual = new Date().getMonth() + 1;
            const anioActual = new Date().getFullYear();
            const nominasMes = nominas.filter(n => n.mes === mesActual && n.anio === anioActual);
            nominasEsteMesElement.textContent = nominasMes.length;
          }
        } catch (error) {
          console.error('‚ùå Error actualizando m√©tricas:', error);
        }
      }

      // Mostrar modal (funci√≥n global)
      window.mostrarModal = function(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.add('active');

          // Limpiar formulario si es el modal de n√≥mina
          if (modalId === 'modalGenerarNomina') {
            limpiarFormularioNomina();
          }

          // Cargar configuraci√≥n si es el modal de configuraci√≥n
          if (modalId === 'modalConfiguracionNomina') {
            cargarConfiguracionGuardada();
          }

          // Verificar que el modal est√© por encima del header
          if (modal.style.zIndex !== '9999') {
            modal.style.zIndex = '9999';
          }
        }
      }

      // Cerrar modal (funci√≥n global)
      window.cerrarModal = function(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.style.display = 'none';
          modal.classList.remove('active');
        }
      }

      // Funci√≥n para cerrar modal al hacer clic fuera
      window.cerrarModalClickOutside = function(event) {
        if (event.target.classList.contains('modal-overlay')) {
          const modalId = event.target.id;
          cerrarModal(modalId);
        }
      }

      // Funci√≥n para configurar event listeners de modales
      window.configurarEventosModales = function() {
        const modals = document.querySelectorAll('.modal-overlay');
        modals.forEach(modal => {
          modal.addEventListener('click', cerrarModalClickOutside);
        });
        console.log('‚úÖ Event listeners de modales configurados');
      }

      // Limpiar formulario de n√≥mina
      function limpiarFormularioNomina() {
        const form = document.getElementById('formNomina');
        if (form) {
          form.reset();
        }

        // Ocultar resumen
        const resumen = document.getElementById('resumenNomina');
        if (resumen) {
          resumen.style.display = 'none';
        }
      }

      // Calcular resumen de la n√≥mina
      function calcularResumenNomina() {
        const empleadoId = document.getElementById('empleadoNomina')?.value;
        const mes = document.getElementById('mesNomina')?.value;
        const anio = document.getElementById('anioNomina')?.value;

        if (!empleadoId || !mes || !anio) {
          document.getElementById('resumenNomina').style.display = 'none';
          return;
        }

        const empleado = empleados.find((e) => e.id == empleadoId);
        if (!empleado) return;

        // Filtrar horas del empleado para el mes y a√±o especificados
        const horasEmpleado = horas.filter((h) => {
          if (h.empleado_id != empleadoId) return false;

          const fechaHora = new Date(h.fecha);
          return fechaHora.getMonth() + 1 == mes && fechaHora.getFullYear() == anio;
        });

        if (horasEmpleado.length === 0) {
          document.getElementById('detallesNomina').innerHTML =
            '<p class="error">No hay horas registradas para este empleado en el per√≠odo seleccionado</p>';
          document.getElementById('resumenNomina').style.display = 'block';
          return;
        }

        // Calcular totales de horas
        const totalHoras = horasEmpleado.reduce((sum, h) => sum + (h.horas_trabajadas || 0), 0);
        const horasExtras = horasEmpleado.reduce((sum, h) => sum + (h.horas_extras || 0), 0);
        const horasNocturnas = horasEmpleado.reduce((sum, h) => sum + (h.horas_nocturnas || 0), 0);
        const horasDominicales = horasEmpleado.reduce((sum, h) => sum + (h.horas_dominicales || 0), 0);

        // Salario base y c√°lculos
        const salarioBase = empleado.salario || 0;
        const salarioPorHora = empleado.tipo_contrato === 'Por Horas' ? salarioBase / 160 : salarioBase / 160;
        const salarioMensual = empleado.tipo_contrato === 'Por Horas' ? totalHoras * salarioPorHora : salarioBase;

        // C√°lculo de horas extras (25% adicional)
        const valorHorasExtras = horasExtras * salarioPorHora * 1.25;

        // C√°lculo de horas nocturnas (35% adicional)
        const valorHorasNocturnas = horasNocturnas * salarioPorHora * 1.35;

        // C√°lculo de horas dominicales (75% adicional)
        const valorHorasDominicales = horasDominicales * salarioPorHora * 1.75;

        // Subtotal de salario
        const subtotalSalario = salarioMensual + valorHorasExtras + valorHorasNocturnas + valorHorasDominicales;

        // Bonificaciones (10% del salario base)
        const bonificaciones = salarioMensual * 0.1;

        // C√°lculo de prestaciones sociales
        const cesantias = subtotalSalario * 0.0833; // 8.33% mensual
        const primaServicios = subtotalSalario * 0.0833; // 8.33% mensual
        const interesesCesantias = cesantias * 0.12; // 12% anual, 1% mensual

        // C√°lculo de aportes del empleado
        const saludEmpleado = subtotalSalario * 0.04; // 4% salud
        const pensionEmpleado = subtotalSalario * 0.04; // 4% pensi√≥n

        // C√°lculo de aportes del empleador
        const saludEmpleador = subtotalSalario * 0.085; // 8.5% salud
        const pensionEmpleador = subtotalSalario * 0.12; // 12% pensi√≥n
        const riesgosLaborales = subtotalSalario * 0.00522; // 0.522% ARL (promedio)

        // Total deducciones del empleado
        const deduccionesEmpleado = saludEmpleado + pensionEmpleado;

        // Total costos del empleador
        const costosEmpleador =
          cesantias + primaServicios + interesesCesantias + saludEmpleador + pensionEmpleador + riesgosLaborales;

        // Salario neto (lo que recibe el empleado)
        const salarioNeto = subtotalSalario + bonificaciones - deduccionesEmpleado;

        // Costo total para la empresa
        const costoTotalEmpresa = subtotalSalario + bonificaciones + costosEmpleador;

        document.getElementById('detallesNomina').innerHTML = `
          <div class="detalle-item">
            <strong>Empleado:</strong> ${empleado.nombre}
          </div>
          <div class="detalle-item">
            <strong>Per√≠odo:</strong> ${obtenerNombreMes(mes)} ${anio}
          </div>
          <div class="detalle-item">
            <strong>Total horas normales:</strong> ${totalHoras.toFixed(2)} hrs
          </div>
          <div class="detalle-item">
            <strong>Horas extras:</strong> ${horasExtras.toFixed(2)} hrs (${formatearMoneda(valorHorasExtras)})
          </div>
          <div class="detalle-item">
            <strong>Horas nocturnas:</strong> ${horasNocturnas.toFixed(2)} hrs (${formatearMoneda(valorHorasNocturnas)})
          </div>
          <div class="detalle-item">
            <strong>Horas dominicales:</strong> ${horasDominicales.toFixed(2)} hrs (${formatearMoneda(
          valorHorasDominicales
        )})
          </div>
          <div class="detalle-item">
            <strong>Salario base:</strong> ${formatearMoneda(salarioMensual)}
          </div>
          <div class="detalle-item">
            <strong>Subtotal salario:</strong> ${formatearMoneda(subtotalSalario)}
          </div>
          <div class="detalle-item">
            <strong>Bonificaciones:</strong> ${formatearMoneda(bonificaciones)}
          </div>
          <div class="detalle-item">
            <strong>Deducciones empleado:</strong> ${formatearMoneda(deduccionesEmpleado)}
          </div>
          <div class="detalle-item total">
            <strong>Salario neto empleado:</strong> ${formatearMoneda(salarioNeto)}
          </div>
          <hr style="margin: 10px 0; border: 1px solid #e2e8f0;">
          <div class="detalle-item">
            <strong>Cesant√≠as:</strong> ${formatearMoneda(cesantias)}
          </div>
          <div class="detalle-item">
            <strong>Prima de servicios:</strong> ${formatearMoneda(primaServicios)}
          </div>
          <div class="detalle-item">
            <strong>Intereses cesant√≠as:</strong> ${formatearMoneda(interesesCesantias)}
          </div>
          <div class="detalle-item">
            <strong>Aportes empleador:</strong> ${formatearMoneda(saludEmpleador + pensionEmpleador + riesgosLaborales)}
          </div>
          <div class="detalle-item total-empleador">
            <strong>Costo total empresa:</strong> ${formatearMoneda(costoTotalEmpresa)}
          </div>
        `;

        document.getElementById('resumenNomina').style.display = 'block';
      }

      // Generar n√≥mina (funci√≥n global)
      window.generarNomina = function(event) {
        if (event) {
          event.preventDefault();
        }

        try {
          // Validar campos requeridos
          const empleadoId = document.getElementById('empleadoNomina')?.value;
          const mes = document.getElementById('mesNomina')?.value;
          const anio = document.getElementById('anioNomina')?.value;

          if (!empleadoId || !mes || !anio) {
            mostrarNotificacion('Por favor completa todos los campos requeridos', 'error');
            return;
          }

          const empleado = empleados.find((e) => e.id == empleadoId);
          if (!empleado) {
            mostrarNotificacion('Empleado no encontrado', 'error');
            return;
          }

          // Filtrar horas del empleado para el mes y a√±o especificados
          const horasEmpleado = horas.filter((h) => {
            if (h.empleado_id != empleadoId) return false;

            const fechaHora = new Date(h.fecha);
            return fechaHora.getMonth() + 1 == mes && fechaHora.getFullYear() == anio;
          });

          if (horasEmpleado.length === 0) {
            mostrarNotificacion('No hay horas registradas para este empleado en el per√≠odo seleccionado', 'error');
            return;
          }

          // Calcular totales de horas
          const totalHoras = horasEmpleado.reduce((sum, h) => sum + (h.horas_trabajadas || 0), 0);
          const horasExtras = horasEmpleado.reduce((sum, h) => sum + (h.horas_extras || 0), 0);
          const horasNocturnas = horasEmpleado.reduce((sum, h) => sum + (h.horas_nocturnas || 0), 0);
          const horasDominicales = horasEmpleado.reduce((sum, h) => sum + (h.horas_dominicales || 0), 0);

          // Salario base y c√°lculos
          const salarioBase = empleado.salario || 0;
          const salarioPorHora = empleado.tipo_contrato === 'Por Horas' ? salarioBase / 160 : salarioBase / 160;
          const salarioMensual = empleado.tipo_contrato === 'Por Horas' ? totalHoras * salarioPorHora : salarioBase;

          // C√°lculo de horas extras (25% adicional)
          const valorHorasExtras = horasExtras * salarioPorHora * 1.25;

          // C√°lculo de horas nocturnas (35% adicional)
          const valorHorasNocturnas = horasNocturnas * salarioPorHora * 1.35;

          // C√°lculo de horas dominicales (75% adicional)
          const valorHorasDominicales = horasDominicales * salarioPorHora * 1.75;

          // Subtotal de salario
          const subtotalSalario = salarioMensual + valorHorasExtras + valorHorasNocturnas + valorHorasDominicales;

          // Bonificaciones (10% del salario base)
          const bonificaciones = salarioMensual * 0.1;

          // C√°lculo de prestaciones sociales
          const cesantias = subtotalSalario * 0.0833; // 8.33% mensual
          const primaServicios = subtotalSalario * 0.0833; // 8.33% mensual
          const interesesCesantias = cesantias * 0.12; // 12% anual, 1% mensual

          // C√°lculo de aportes del empleado
          const saludEmpleado = subtotalSalario * 0.04; // 4% salud
          const pensionEmpleado = subtotalSalario * 0.04; // 4% pensi√≥n

          // C√°lculo de aportes del empleador
          const saludEmpleador = subtotalSalario * 0.085; // 8.5% salud
          const pensionEmpleador = subtotalSalario * 0.12; // 12% pensi√≥n
          const riesgosLaborales = subtotalSalario * 0.00522; // 0.522% ARL (promedio)

          // Total deducciones del empleado
          const deduccionesEmpleado = saludEmpleado + pensionEmpleado;

          // Total costos del empleador
          const costosEmpleador =
            cesantias + primaServicios + interesesCesantias + saludEmpleador + pensionEmpleador + riesgosLaborales;

          // Salario neto (lo que recibe el empleado)
          const salarioNeto = subtotalSalario + bonificaciones - deduccionesEmpleado;

          // Costo total para la empresa
          const costoTotalEmpresa = subtotalSalario + bonificaciones + costosEmpleador;

          // Crear objeto n√≥mina
          const nomina = {
            id: Date.now(),
            empleado_id: parseInt(empleadoId),
            mes: parseInt(mes),
            anio: parseInt(anio),
            tipo_nomina: document.getElementById('tipoNomina')?.value || 'mensual',
            horas_trabajadas: totalHoras,
            horas_extras: horasExtras,
            horas_nocturnas: horasNocturnas,
            horas_dominicales: horasDominicales,
            salario_base: salarioMensual,
            salario_por_hora: salarioPorHora,
            valor_horas_extras: valorHorasExtras,
            valor_horas_nocturnas: valorHorasNocturnas,
            valor_horas_dominicales: valorHorasDominicales,
            subtotal_salario: subtotalSalario,
            bonificaciones: bonificaciones,
            cesantias: cesantias,
            prima_servicios: primaServicios,
            intereses_cesantias: interesesCesantias,
            salud_empleado: saludEmpleado,
            pension_empleado: pensionEmpleado,
            deducciones: deduccionesEmpleado,
            salario_neto: salarioNeto,
            salud_empleador: saludEmpleador,
            pension_empleador: pensionEmpleador,
            riesgos_laborales: riesgosLaborales,
            costos_empleador: costosEmpleador,
            costo_total_empresa: costoTotalEmpresa,
            estado: 'Generada',
            fecha_generacion: new Date().toISOString(),
            userId: currentUser?.username || currentUser?.email || 'axyra',
          };

          // Agregar a la lista de n√≥minas
          nominas.push(nomina);

          // Guardar en localStorage
          localStorage.setItem('axyra_nominas', JSON.stringify(nominas));

          // Cerrar modal y actualizar tabla
          cerrarModal('modalGenerarNomina');
          renderizarTablaNominas();

          // Mostrar notificaci√≥n de √©xito
          mostrarNotificacion(
            `N√≥mina generada correctamente para ${empleado.nombre}. Salario neto: ${formatearMoneda(salarioNeto)}`,
            'success'
          );

          console.log('‚úÖ N√≥mina generada:', nomina);
        } catch (error) {
          console.error('‚ùå Error generando n√≥mina:', error);
          mostrarNotificacion('Error generando n√≥mina: ' + error.message, 'error');
        }
      }

      // Ver n√≥mina (funci√≥n global)
      window.verNomina = function(id) {
        const nomina = nominas.find((n) => n.id === id);
        if (!nomina) {
          mostrarNotificacion('N√≥mina no encontrada', 'error');
          return;
        }

        const empleado = empleados.find((e) => e.id === nomina.empleado_id);

        // Mostrar informaci√≥n de la n√≥mina en una notificaci√≥n
        const info = `
          <strong>N√≥mina #${nomina.id}</strong><br>
          <strong>Empleado:</strong> ${empleado ? empleado.nombre : 'No encontrado'}<br>
          <strong>Per√≠odo:</strong> ${obtenerNombreMes(nomina.mes)} ${nomina.anio}<br>
          <strong>Tipo:</strong> ${nomina.tipo_nomina || 'Mensual'}<br>
          <hr style="margin: 5px 0; border: 1px solid #e2e8f0;">
          <strong>HORAS TRABAJADAS:</strong><br>
          ‚Ä¢ Normales: ${nomina.horas_trabajadas || 0} hrs<br>
          ‚Ä¢ Extras: ${nomina.horas_extras || 0} hrs (${formatearMoneda(nomina.valor_horas_extras || 0)})<br>
          ‚Ä¢ Nocturnas: ${nomina.horas_nocturnas || 0} hrs (${formatearMoneda(nomina.valor_horas_nocturnas || 0)})<br>
          ‚Ä¢ Dominicales: ${nomina.horas_dominicales || 0} hrs (${formatearMoneda(
          nomina.valor_horas_dominicales || 0
        )})<br>
          <hr style="margin: 5px 0; border: 1px solid #e2e8f0;">
          <strong>LIQUIDACI√ìN:</strong><br>
          ‚Ä¢ Salario base: ${formatearMoneda(nomina.salario_base)}<br>
          ‚Ä¢ Subtotal salario: ${formatearMoneda(nomina.subtotal_salario || nomina.salario_base)}<br>
          ‚Ä¢ Bonificaciones: ${formatearMoneda(nomina.bonificaciones)}<br>
          ‚Ä¢ Deducciones empleado: ${formatearMoneda(nomina.deducciones)}<br>
          <strong>‚Ä¢ Salario neto: ${formatearMoneda(nomina.salario_neto)}</strong><br>
          <hr style="margin: 5px 0; border: 1px solid #e2e8f0;">
          <strong>PRESTACIONES SOCIALES:</strong><br>
          ‚Ä¢ Cesant√≠as: ${formatearMoneda(nomina.cesantias)}<br>
          ‚Ä¢ Prima servicios: ${formatearMoneda(nomina.prima_servicios)}<br>
          ‚Ä¢ Intereses cesant√≠as: ${formatearMoneda(nomina.intereses_cesantias)}<br>
          <hr style="margin: 5px 0; border: 1px solid #e2e8f0;">
          <strong>APORTES EMPLEADOR:</strong><br>
          ‚Ä¢ Salud: ${formatearMoneda(nomina.salud_empleador)}<br>
          ‚Ä¢ Pensi√≥n: ${formatearMoneda(nomina.pension_empleador)}<br>
          ‚Ä¢ Riesgos laborales: ${formatearMoneda(nomina.riesgos_laborales)}<br>
          <strong>‚Ä¢ Costo total empresa: ${formatearMoneda(nomina.costo_total_empresa)}</strong><br>
          <hr style="margin: 5px 0; border: 1px solid #e2e8f0;">
          <strong>Fecha generaci√≥n:</strong> ${new Date(nomina.fecha_generacion).toLocaleDateString('es-ES')}
        `;

        // Mostrar modal con informaci√≥n detallada
        mostrarModalDetalleNomina(nomina, empleado);
      }

      // Mostrar modal de detalle de n√≥mina
      function mostrarModalDetalleNomina(nomina, empleado) {
        const modal = document.getElementById('modalDetalleNomina');
        if (modal) {
          // Llenar contenido del modal
          document.getElementById('detalleNominaTitulo').textContent = `N√≥mina #${nomina.id}`;
          document.getElementById('detalleNominaEmpleado').textContent = empleado ? empleado.nombre : 'No encontrado';
          document.getElementById('detalleNominaPeriodo').textContent = `${obtenerNombreMes(nomina.mes)} ${nomina.anio}`;
          document.getElementById('detalleNominaTipo').textContent = nomina.tipo_nomina || 'Mensual';
          
          // Llenar detalles de horas
          document.getElementById('detalleHorasNormales').textContent = `${nomina.horas_trabajadas || 0} hrs`;
          document.getElementById('detalleHorasExtras').textContent = `${nomina.horas_extras || 0} hrs`;
          document.getElementById('detalleHorasNocturnas').textContent = `${nomina.horas_nocturnas || 0} hrs`;
          document.getElementById('detalleHorasDominicales').textContent = `${nomina.horas_dominicales || 0} hrs`;
          
          // Llenar valores monetarios
          document.getElementById('detalleSalarioBase').textContent = formatearMoneda(nomina.salario_base);
          document.getElementById('detalleSubtotalSalario').textContent = formatearMoneda(nomina.subtotal_salario || nomina.salario_base);
          document.getElementById('detalleBonificaciones').textContent = formatearMoneda(nomina.bonificaciones);
          document.getElementById('detalleDeducciones').textContent = formatearMoneda(nomina.deducciones);
          document.getElementById('detalleSalarioNeto').textContent = formatearMoneda(nomina.salario_neto);
          
          // Llenar prestaciones sociales
          document.getElementById('detalleCesantias').textContent = formatearMoneda(nomina.cesantias);
          document.getElementById('detallePrimaServicios').textContent = formatearMoneda(nomina.prima_servicios);
          document.getElementById('detalleInteresesCesantias').textContent = formatearMoneda(nomina.intereses_cesantias);
          
          // Llenar costos del empleador
          document.getElementById('detalleSaludEmpleador').textContent = formatearMoneda(nomina.salud_empleador);
          document.getElementById('detallePensionEmpleador').textContent = formatearMoneda(nomina.pension_empleador);
          document.getElementById('detalleRiesgosLaborales').textContent = formatearMoneda(nomina.riesgos_laborales);
          document.getElementById('detalleCostoTotalEmpresa').textContent = formatearMoneda(nomina.costo_total_empresa);

        // Mostrar modal
          mostrarModal('modalDetalleNomina');
        }
      }

      // Eliminar n√≥mina (funci√≥n global)
      window.eliminarNomina = function(id) {
        try {
          const nomina = nominas.find((n) => n.id === id);
          if (!nomina) {
            mostrarNotificacion('N√≥mina no encontrada', 'error');
            return;
          }

          const empleado = empleados.find((e) => e.id === nomina.empleado_id);
          const nombreEmpleado = empleado ? empleado.nombre : 'Empleado no encontrado';

          // Mostrar modal de confirmaci√≥n
          mostrarModalConfirmacion(
            'Eliminar N√≥mina',
            `¬øEst√°s seguro de que quieres eliminar la n√≥mina #${id} de ${nombreEmpleado}? Esta acci√≥n no se puede deshacer.`,
            () => {
              // Eliminar de la lista
          nominas = nominas.filter((n) => n.id !== id);

          // Guardar en localStorage
          localStorage.setItem('axyra_nominas', JSON.stringify(nominas));

              // Actualizar tabla
          renderizarTablaNominas();

              // Cerrar modal
              cerrarModal('modalConfirmacion');

              // Mostrar notificaci√≥n
              mostrarNotificacion(`N√≥mina #${id} eliminada correctamente`, 'success');
            }
          );
        } catch (error) {
          console.error('‚ùå Error eliminando n√≥mina:', error);
          mostrarNotificacion('Error eliminando n√≥mina: ' + error.message, 'error');
        }
      }

      // Mostrar modal de confirmaci√≥n (funci√≥n global)
      window.mostrarModalConfirmacion = function(titulo, mensaje, accion) {
        document.getElementById('modalConfirmacionTitulo').textContent = titulo;
        document.getElementById('modalConfirmacionMensaje').textContent = mensaje;
        
        const btnConfirmar = document.getElementById('btnConfirmarAccion');
        btnConfirmar.onclick = accion;
        
        mostrarModal('modalConfirmacion');
      }

      // Guardar configuraci√≥n de n√≥mina (funci√≥n global)
      window.guardarConfiguracionNomina = function() {
        try {
          const configuracion = {
            salarioMinimo: parseFloat(document.getElementById('salarioMinimo')?.value) || 0,
            porcentajeCesantias: parseFloat(document.getElementById('porcentajeCesantias')?.value) || 8.33,
            porcentajePrima: parseFloat(document.getElementById('porcentajePrima')?.value) || 8.33,
            porcentajeInteresesCesantias: parseFloat(document.getElementById('porcentajeInteresesCesantias')?.value) || 12,
            porcentajeSalud: parseFloat(document.getElementById('porcentajeSalud')?.value) || 4,
            porcentajePension: parseFloat(document.getElementById('porcentajePension')?.value) || 4,
            fechaActualizacion: new Date().toISOString(),
            userId: currentUser?.username || currentUser?.email || 'axyra'
          };

          // Guardar en localStorage
          localStorage.setItem('axyra_configuracion_nomina', JSON.stringify(configuracion));

          // Cerrar modal
          cerrarModal('modalConfiguracionNomina');

          // Mostrar notificaci√≥n
          mostrarNotificacion('Configuraci√≥n guardada correctamente', 'success');

          console.log('‚úÖ Configuraci√≥n guardada:', configuracion);
        } catch (error) {
          console.error('‚ùå Error guardando configuraci√≥n:', error);
          mostrarNotificacion('Error guardando configuraci√≥n: ' + error.message, 'error');
        }
      }

      // Generar reportes avanzados (funci√≥n global)
      window.generarReporte = function(tipoReporte) {
        try {
          let contenido = '';
          let titulo = '';

          switch (tipoReporte) {
            case 'costosLaborales':
              contenido = generarReporteCostosLaborales();
              titulo = 'Reporte de Costos Laborales';
              break;
            case 'prestacionesSociales':
              contenido = generarReportePrestacionesSociales();
              titulo = 'Reporte de Prestaciones Sociales';
              break;
            case 'horasTrabajadas':
              contenido = generarReporteHorasTrabajadas();
              titulo = 'An√°lisis de Horas Trabajadas';
              break;
            case 'comparativoSalarios':
              contenido = generarReporteComparativoSalarios();
              titulo = 'Comparativo de Salarios';
              break;
            case 'tendenciasSalariales':
              contenido = generarReporteTendenciasSalariales();
              titulo = 'Tendencias Salariales';
              break;
            case 'resumenMensual':
              contenido = generarReporteResumenMensual();
              titulo = 'Resumen Mensual de N√≥mina';
              break;
            default:
              mostrarNotificacion('Tipo de reporte no v√°lido', 'error');
              return;
          }

          // Mostrar reporte en nueva ventana
          mostrarReporte(titulo, contenido);
        } catch (error) {
          console.error('‚ùå Error generando reporte:', error);
          mostrarNotificacion('Error generando reporte: ' + error.message, 'error');
        }
      }

      // Exportar n√≥mina (funci√≥n global)
      window.exportarNomina = function() {
        try {
          if (nominas.length === 0) {
            mostrarNotificacion('No hay n√≥minas generadas para exportar', 'warning');
            return;
          }

          console.log('üìä Iniciando exportaci√≥n de n√≥minas...');
          console.log('üìã Total de n√≥minas a exportar:', nominas.length);

          // Verificar si XLSX est√° disponible
          if (typeof XLSX === 'undefined') {
            mostrarNotificacion('Error: Librer√≠a XLSX no est√° disponible', 'error');
            return;
          }

          // Crear datos para exportar
            const data = [
              ['REPORTE DE N√ìMINAS - Villa Venecia'],
              ['EMPRESA: Villa Venecia'],
              ['NIT: NIT Pendiente'],
              [`FECHA DE EXPORTACI√ìN: ${new Date().toLocaleDateString('es-CO', { timeZone: 'America/Bogota' })}`],
              [],
              ['ID', 'Empleado', 'C√©dula', 'Per√≠odo', 'Horas Normales', 'Horas Extras', 'Horas Nocturnas', 'Horas Dominicales', 'Salario Base', 'Bonificaciones', 'Deducciones', 'Salario Neto', 'Costo Empresa', 'Estado', 'Fecha Generaci√≥n']
            ];

          // Agregar datos de cada n√≥mina
          nominas.forEach((n, index) => {
              const empleado = empleados.find((e) => e.id === n.empleado_id);
            console.log(`üìù Procesando n√≥mina ${index + 1}:`, n.id, empleado?.nombre);
            
              data.push([
                n.id || 'N/A',
                empleado ? empleado.nombre : 'Empleado no encontrado',
                empleado ? empleado.cedula || 'N/A' : 'N/A',
                `${obtenerNombreMes(n.mes)} ${n.anio}`,
                (n.horas_trabajadas || 0).toLocaleString('es-CO'),
                (n.horas_extras || 0).toLocaleString('es-CO'),
                (n.horas_nocturnas || 0).toLocaleString('es-CO'),
                (n.horas_dominicales || 0).toLocaleString('es-CO'),
                formatearMoneda(n.salario_base),
                formatearMoneda(n.bonificaciones || 0),
                formatearMoneda(n.deducciones || 0),
                formatearMoneda(n.salario_neto),
                formatearMoneda(n.costo_total_empresa),
                n.estado || 'Generada',
                new Date(n.fecha_generacion).toLocaleDateString('es-CO', { timeZone: 'America/Bogota' })
              ]);
            });

            // Agregar totales
            data.push([]);
          const totales = [
            'TOTALES', '', '', '', 
              nominas.reduce((sum, n) => sum + (n.horas_trabajadas || 0), 0).toLocaleString('es-CO'),
              nominas.reduce((sum, n) => sum + (n.horas_extras || 0), 0).toLocaleString('es-CO'),
              nominas.reduce((sum, n) => sum + (n.horas_nocturnas || 0), 0).toLocaleString('es-CO'),
              nominas.reduce((sum, n) => sum + (n.horas_dominicales || 0), 0).toLocaleString('es-CO'),
              formatearMoneda(nominas.reduce((sum, n) => sum + (n.salario_base || 0), 0)),
              formatearMoneda(nominas.reduce((sum, n) => sum + (n.bonificaciones || 0), 0)),
              formatearMoneda(nominas.reduce((sum, n) => sum + (n.deducciones || 0), 0)),
              formatearMoneda(nominas.reduce((sum, n) => sum + (n.salario_neto || 0), 0)),
              formatearMoneda(nominas.reduce((sum, n) => sum + (n.costo_total_empresa || 0), 0)),
              '', ''
          ];
          data.push(totales);

          console.log('üìä Datos preparados para exportaci√≥n');

          // Crear hoja de trabajo
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'N√≥minas');

            // Ajustar ancho de columnas
            ws['!cols'] = [
              { width: 8 }, { width: 25 }, { width: 15 }, { width: 15 },
              { width: 15 }, { width: 15 }, { width: 15 }, { width: 15 },
              { width: 18 }, { width: 18 }, { width: 18 }, { width: 18 },
              { width: 18 }, { width: 12 }, { width: 20 }
            ];

          // Generar nombre de archivo
            const now = new Date();
            const colombiaTime = new Date(now.toLocaleString('en-US', { timeZone: 'America/Bogota' }));
            const fileName = `REPORTE_NOMINAS_Villa_Venecia_${colombiaTime.toISOString().split('T')[0]}_${colombiaTime.getHours().toString().padStart(2, '0')}-${colombiaTime.getMinutes().toString().padStart(2, '0')}.xlsx`;
            
          console.log('üíæ Descargando archivo:', fileName);

          // Descargar archivo
            XLSX.writeFile(wb, fileName);
          
          console.log('‚úÖ Exportaci√≥n completada exitosamente');
            mostrarNotificacion('N√≥minas exportadas correctamente con formato profesional', 'success');
          
        } catch (error) {
          console.error('‚ùå Error exportando n√≥minas:', error);
          mostrarNotificacion('Error exportando n√≥minas: ' + error.message, 'error');
        }
      }

      // Generar comprobante PDF (funci√≥n global)
      window.generarComprobantePDF = function() {
        try {
          // Verificar si hay n√≥minas seleccionadas
          const nominasSeleccionadas = nominas.filter((n) => n.estado === 'Generada');

          if (nominasSeleccionadas.length === 0) {
            mostrarNotificacion('No hay n√≥minas generadas para crear comprobantes PDF', 'warning');
            return;
          }

          // Crear contenido del PDF
          const contenidoPDF = crearContenidoPDF(nominasSeleccionadas);

          // Generar PDF usando jsPDF
          if (typeof window.jspdf !== 'undefined') {
            generarPDFConJsPDF(contenidoPDF);
          } else {
            // Fallback: mostrar contenido en nueva ventana para imprimir
            mostrarContenidoParaImprimir(contenidoPDF);
          }

          mostrarNotificacion('Comprobantes PDF generados correctamente', 'success');
        } catch (error) {
          console.error('‚ùå Error generando PDF:', error);
          mostrarNotificacion('Error generando PDF: ' + error.message, 'error');
        }
      }

      // Crear contenido del PDF
      function crearContenidoPDF(nominas) {
        let contenido = '';

        nominas.forEach((nomina, index) => {
          const empleado = empleados.find((e) => e.id === nomina.empleado_id);
          if (!empleado) return;

          contenido += `
            <div style="page-break-after: always; padding: 20px; font-family: Arial, sans-serif;">
              <div style="text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px;">
                <h1 style="color: #667eea; margin: 0;">COMPROBANTE DE PAGO DE N√ìMINA</h1>
                <h2 style="color: #764ba2; margin: 10px 0;">AXYRA - Sistema de Gesti√≥n</h2>
                <p style="margin: 5px 0;">Per√≠odo: ${obtenerNombreMes(nomina.mes)} ${nomina.anio}</p>
                <p style="margin: 5px 0;">Fecha de generaci√≥n: ${new Date(nomina.fecha_generacion).toLocaleDateString(
                  'es-ES'
                )}</p>
              </div>
              
              <div style="margin-bottom: 30px;">
                <h3 style="color: #333; border-bottom: 1px solid #ddd; padding-bottom: 10px;">INFORMACI√ìN DEL EMPLEADO</h3>
                <table style="width: 100%; border-collapse: collapse;">
                  <tr>
                    <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold; width: 30%;">Nombre:</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">${empleado.nombre}</td>
                  </tr>
                  <tr>
                    <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">C√©dula:</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">${empleado.cedula || 'N/A'}</td>
                  </tr>
                  <tr>
                    <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Cargo:</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">${empleado.cargo || 'N/A'}</td>
                  </tr>
                  <tr>
                    <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Tipo Contrato:</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">${empleado.tipo_contrato || 'N/A'}</td>
                  </tr>
                </table>
              </div>
              
              <div style="margin-bottom: 30px;">
                <h3 style="color: #333; border-bottom: 1px solid #ddd; padding-bottom: 10px;">HORAS TRABAJADAS</h3>
                <table style="width: 100%; border-collapse: collapse;">
                  <tr style="background-color: #f8f9fa;">
                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Tipo de Hora</th>
                    <th style="padding: 12px; border: 1px solid #ddd; text-align: center;">Cantidad</th>
                    <th style="padding: 12px; border: 1px solid #ddd; text-align: right;">Valor</th>
                  </tr>
                  <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">Horas Normales</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${
                      nomina.horas_trabajadas || 0
                    } hrs</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                      nomina.salario_base
                    )}</td>
                  </tr>
                  <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">Horas Extras</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${
                      nomina.horas_extras || 0
                    } hrs</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                      nomina.valor_horas_extras || 0
                    )}</td>
                  </tr>
                  <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">Horas Nocturnas</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${
                      nomina.horas_nocturnas || 0
                    } hrs</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                      nomina.valor_horas_nocturnas || 0
                    )}</td>
                  </tr>
                  <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">Horas Dominicales</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${
                      nomina.horas_dominicales || 0
                    } hrs</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                      nomina.valor_horas_dominicales || 0
                    )}</td>
                  </tr>
                </table>
              </div>
              
              <div style="margin-bottom: 30px;">
                <h3 style="color: #333; border-bottom: 1px solid #ddd; padding-bottom: 10px;">LIQUIDACI√ìN DE N√ìMINA</h3>
                <table style="width: 100%; border-collapse: collapse;">
                  <tr style="background-color: #f8f9fa;">
                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Concepto</th>
                    <th style="padding: 12px; border: 1px solid #ddd; text-align: right;">Valor</th>
                  </tr>
                  <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">Subtotal Salario</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                      nomina.subtotal_salario || nomina.salario_base
                    )}</td>
                  </tr>
                  <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">Bonificaciones</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                      nomina.bonificaciones
                    )}</td>
                  </tr>
                  <tr style="background-color: #f1f3f4;">
                    <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold;">Total Devengado</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right; font-weight: bold;">${formatearMoneda(
                      (nomina.subtotal_salario || nomina.salario_base) + nomina.bonificaciones
                    )}</td>
                  </tr>
                  <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">Salud (4%)</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">-${formatearMoneda(
                      nomina.salud_empleado
                    )}</td>
                  </tr>
                  <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">Pensi√≥n (4%)</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">-${formatearMoneda(
                      nomina.pension_empleado
                    )}</td>
                  </tr>
                  <tr style="background-color: #f1f3f4;">
                    <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold;">Total Deducciones</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right; font-weight: bold;">-${formatearMoneda(
                      nomina.deducciones
                    )}</td>
                  </tr>
                  <tr style="background-color: #e8f5e8; border: 2px solid #4caf50;">
                    <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold; font-size: 16px;">SALARIO NETO A PAGAR</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right; font-weight: bold; font-size: 16px; color: #2e7d32;">${formatearMoneda(
                      nomina.salario_neto
                    )}</td>
                  </tr>
                </table>
              </div>
              
              <div style="margin-bottom: 30px;">
                <h3 style="color: #333; border-bottom: 1px solid #ddd; padding-bottom: 10px;">PRESTACIONES SOCIALES</h3>
                <table style="width: 100%; border-collapse: collapse;">
                  <tr>
                    <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold; width: 50%;">Cesant√≠as (8.33%)</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                      nomina.cesantias
                    )}</td>
                  </tr>
                  <tr>
                    <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Prima de Servicios (8.33%)</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                      nomina.prima_servicios
                    )}</td>
                  </tr>
                  <tr>
                    <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Intereses sobre Cesant√≠as (12%)</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                      nomina.intereses_cesantias
                    )}</td>
                  </tr>
                </table>
              </div>
              
              <div style="text-align: center; margin-top: 50px; padding-top: 30px; border-top: 2px solid #333;">
                <p style="margin: 5px 0; font-size: 14px;">Este documento es generado autom√°ticamente por el sistema AXYRA</p>
                <p style="margin: 5px 0; font-size: 12px; color: #666;">ID de N√≥mina: ${nomina.id} | Fecha: ${new Date(
            nomina.fecha_generacion
          ).toLocaleDateString('es-ES')}</p>
              </div>
            </div>
          `;

          if (index < nominas.length - 1) {
            contenido += '<div style="page-break-after: always;"></div>';
          }
        });

        return contenido;
      }

      // Generar PDF con jsPDF
      function generarPDFConJsPDF(contenido) {
        // Esta funci√≥n se implementar√≠a si jsPDF estuviera disponible
        console.log('Generando PDF con jsPDF...');
        mostrarContenidoParaImprimir(contenido);
      }

      // Mostrar contenido para imprimir
      function mostrarContenidoParaImprimir(contenido) {
        const ventanaImpresion = window.open('', '_blank');
        ventanaImpresion.document.write(`
          <!DOCTYPE html>
          <html>
            <head>
              <title>Comprobantes de N√≥mina - AXYRA</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
                @media print {
                  body { padding: 0; }
                  .no-print { display: none; }
                }
              </style>
            </head>
            <body>
              <div class="no-print" style="text-align: center; margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                <h2>Comprobantes de N√≥mina - AXYRA</h2>
                <p>Presiona Ctrl+P para imprimir o guardar como PDF</p>
                <button onclick="window.print()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">
                  Imprimir / Guardar PDF
                </button>
                <button onclick="window.close()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; margin-left: 10px;">
                  Cerrar
                </button>
              </div>
              ${contenido}
            </body>
          </html>
        `);
        ventanaImpresion.document.close();
      }

      // Funciones auxiliares
      function formatearMoneda(amount) {
        if (!amount || amount === 0) return '$0';
        return new Intl.NumberFormat('es-CO', {
          style: 'currency',
          currency: 'COP',
          minimumFractionDigits: 0,
        }).format(amount);
      }

      // Formatear n√∫mero con separadores de miles
      function formatearNumero(numero) {
        if (!numero || numero === 0) return '0';
        return numero.toLocaleString('es-CO', {
          minimumFractionDigits: 0,
          maximumFractionDigits: 0
        });
      }

      function obtenerNombreMes(mes) {
        const meses = [
          'Enero',
          'Febrero',
          'Marzo',
          'Abril',
          'Mayo',
          'Junio',
          'Julio',
          'Agosto',
          'Septiembre',
          'Octubre',
          'Noviembre',
          'Diciembre',
        ];
        return meses[mes - 1] || 'Mes inv√°lido';
      }

      // Funci√≥n de logout (funci√≥n global)
      window.logout = function() {
        try {
          // Limpiar datos de sesi√≥n
            localStorage.removeItem('axyra_isolated_user');
            localStorage.removeItem('axyra_firebase_user');
          
          // Redirigir al login
            window.location.href = '../../login.html';
        } catch (error) {
          console.error('‚ùå Error en logout:', error);
          window.location.href = '../../login.html';
        }
      }

      // Sistema de notificaciones
      function mostrarNotificacion(mensaje, tipo = 'info', duracion = 5000) {
        const container = document.getElementById('notificationContainer');
        if (!container) return;

        const notification = document.createElement('div');
        notification.className = `notification ${tipo}`;
        notification.innerHTML = `
          <div class="notification-content">
            <span class="notification-message">${mensaje}</span>
            <button class="notification-close" onclick="this.parentElement.parentElement.remove()">
              <i class="fas fa-times"></i>
            </button>
          </div>
        `;

        container.appendChild(notification);

        // Auto-remover despu√©s del tiempo especificado
        setTimeout(() => {
          if (notification.parentElement) {
            notification.remove();
          }
        }, duracion);
      }

      // Cerrar modales al hacer click fuera
      window.onclick = function (event) {
        const modals = document.querySelectorAll('.modal-overlay');
        modals.forEach((modal) => {
          if (event.target === modal) {
            modal.style.display = 'none';
          }
        });
      };

      // Generar reportes (funci√≥n global)
      window.generarReportes = function() {
        mostrarModal('modalReportesAvanzados');
      }

      // Configuraci√≥n de n√≥mina (funci√≥n global)
      window.configuracionNomina = function() {
        mostrarModal('modalConfiguracionNomina');
      }

      // Generar reporte de costos laborales
      function generarReporteCostosLaborales() {
        let contenido = `
          <h2 style="color: #667eea; text-align: center; margin-bottom: 30px;">REPORTE DE COSTOS LABORALES</h2>
          <p style="text-align: center; color: #666; margin-bottom: 30px;">Per√≠odo: ${new Date().toLocaleDateString(
            'es-ES'
          )}</p>
          
          <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
            <thead>
              <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <th style="padding: 12px; border: 1px solid #ddd;">Empleado</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Salario Base</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Prestaciones</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Aportes Empleador</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Costo Total</th>
              </tr>
            </thead>
            <tbody>
        `;

        let totalCostos = 0;
        nominas.forEach((nomina) => {
          const empleado = empleados.find((e) => e.id === nomina.empleado_id);
          if (!empleado) return;

          const prestaciones =
            (nomina.cesantias || 0) + (nomina.prima_servicios || 0) + (nomina.intereses_cesantias || 0);
          const aportesEmpleador =
            (nomina.salud_empleador || 0) + (nomina.pension_empleador || 0) + (nomina.riesgos_laborales || 0);
          const costoTotal = (nomina.salario_base || 0) + prestaciones + aportesEmpleador;
          totalCostos += costoTotal;

          contenido += `
            <tr>
              <td style="padding: 12px; border: 1px solid #ddd;">${empleado.nombre}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                nomina.salario_base
              )}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                prestaciones
              )}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                aportesEmpleador
              )}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right; font-weight: bold;">${formatearMoneda(
                costoTotal
              )}</td>
            </tr>
          `;
        });

        contenido += `
            <tr style="background: #f8f9fa; font-weight: bold;">
              <td style="padding: 12px; border: 1px solid #ddd;">TOTAL</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                nominas.reduce((sum, n) => sum + (n.salario_base || 0), 0)
              )}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                nominas.reduce(
                  (sum, n) => sum + (n.cesantias || 0) + (n.prima_servicios || 0) + (n.intereses_cesantias || 0),
                  0
                )
              )}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                nominas.reduce(
                  (sum, n) => sum + (n.salud_empleador || 0) + (n.pension_empleador || 0) + (n.riesgos_laborales || 0),
                  0
                )
              )}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right; color: #dc2626; font-size: 16px;">${formatearMoneda(
                totalCostos
              )}</td>
            </tr>
          </tbody>
        </table>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 30px;">
          <h3 style="color: #333; margin-top: 0;">Resumen Ejecutivo</h3>
          <p><strong>Total empleados:</strong> ${empleados.length}</p>
          <p><strong>Total n√≥minas generadas:</strong> ${nominas.length}</p>
          <p><strong>Costo total para la empresa:</strong> ${formatearMoneda(totalCostos)}</p>
          <p><strong>Costo promedio por empleado:</strong> ${formatearMoneda(
            empleados.length > 0 ? totalCostos / empleados.length : 0
          )}</p>
        </div>
        `;

        return contenido;
      }

      // Generar reporte de prestaciones sociales
      function generarReportePrestacionesSociales() {
        let contenido = `
          <h2 style="color: #667eea; text-align: center; margin-bottom: 30px;">REPORTE DE PRESTACIONES SOCIALES</h2>
          <p style="text-align: center; color: #666; margin-bottom: 30px;">Per√≠odo: ${new Date().toLocaleDateString(
            'es-ES'
          )}</p>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; border-left: 4px solid #4caf50;">
              <h3 style="color: #2e7d32; margin-top: 0;">Cesant√≠as</h3>
              <p style="font-size: 24px; font-weight: bold; color: #2e7d32; margin: 10px 0;">
                ${formatearMoneda(nominas.reduce((sum, n) => sum + (n.cesantias || 0), 0))}
              </p>
              <p style="margin: 0; color: #666;">8.33% del salario mensual</p>
            </div>
            
            <div style="background: #fff3e0; padding: 20px; border-radius: 8px; border-left: 4px solid #ff9800;">
              <h3 style="color: #e65100; margin-top: 0;">Prima de Servicios</h3>
              <p style="font-size: 24px; font-weight: bold; color: #e65100; margin: 10px 0;">
                ${formatearMoneda(nominas.reduce((sum, n) => sum + (n.prima_servicios || 0), 0))}
              </p>
              <p style="margin: 0; color: #666;">8.33% del salario mensual</p>
            </div>
            
            <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; border-left: 4px solid #2196f3;">
              <h3 style="color: #1565c0; margin-top: 0;">Intereses Cesant√≠as</h3>
              <p style="font-size: 24px; font-weight: bold; color: #1565c0; margin: 10px 0;">
                ${formatearMoneda(nominas.reduce((sum, n) => sum + (n.intereses_cesantias || 0), 0))}
              </p>
              <p style="margin: 0; color: #666;">12% anual sobre cesant√≠as</p>
            </div>
          </div>
          
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <th style="padding: 12px; border: 1px solid #ddd;">Empleado</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Cesant√≠as</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Prima Servicios</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Intereses</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Total</th>
              </tr>
            </thead>
            <tbody>
        `;

        nominas.forEach((nomina) => {
          const empleado = empleados.find((e) => e.id === nomina.empleado_id);
          if (!empleado) return;

          const total = (nomina.cesantias || 0) + (nomina.prima_servicios || 0) + (nomina.intereses_cesantias || 0);

          contenido += `
            <tr>
              <td style="padding: 12px; border: 1px solid #ddd;">${empleado.nombre}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                nomina.cesantias
              )}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                nomina.prima_servicios
              )}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                nomina.intereses_cesantias
              )}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right; font-weight: bold;">${formatearMoneda(
                total
              )}</td>
            </tr>
          `;
        });

        contenido += `
            </tbody>
          </table>
        `;

        return contenido;
      }

      // Generar reporte de horas trabajadas
      function generarReporteHorasTrabajadas() {
        let contenido = `
          <h2 style="color: #667eea; text-align: center; margin-bottom: 30px;">AN√ÅLISIS DE HORAS TRABAJADAS</h2>
          <p style="text-align: center; color: #666; margin-bottom: 30px;">Per√≠odo: ${new Date().toLocaleDateString(
            'es-ES'
          )}</p>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; border-left: 4px solid #4caf50;">
              <h3 style="color: #2e7d32; margin-top: 0;">Horas Normales</h3>
              <p style="font-size: 24px; font-weight: bold; color: #2e7d32; margin: 10px 0;">
                ${nominas.reduce((sum, n) => sum + (n.horas_trabajadas || 0), 0).toFixed(2)} hrs
              </p>
            </div>
            
            <div style="background: #fff3e0; padding: 20px; border-radius: 8px; border-left: 4px solid #ff9800;">
              <h3 style="color: #e65100; margin-top: 0;">Horas Extras</h3>
              <p style="font-size: 24px; font-weight: bold; color: #e65100; margin: 10px 0;">
                ${nominas.reduce((sum, n) => sum + (n.horas_extras || 0), 0).toFixed(2)} hrs
              </p>
            </div>
            
            <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; border-left: 4px solid #2196f3;">
              <h3 style="color: #1565c0; margin-top: 0;">Horas Nocturnas</h3>
              <p style="font-size: 24px; font-weight: bold; color: #1565c0; margin: 10px 0;">
                ${nominas.reduce((sum, n) => sum + (n.horas_nocturnas || 0), 0).toFixed(2)} hrs
              </p>
            </div>
            
            <div style="background: #fce4ec; padding: 20px; border-radius: 8px; border-left: 4px solid #e91e63;">
              <h3 style="color: #ad1457; margin-top: 0;">Horas Dominicales</h3>
              <p style="font-size: 24px; font-weight: bold; color: #ad1457; margin: 10px 0;">
                ${nominas.reduce((sum, n) => sum + (n.horas_dominicales || 0), 0).toFixed(2)} hrs
              </p>
            </div>
          </div>
          
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <th style="padding: 12px; border: 1px solid #ddd;">Empleado</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Normales</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Extras</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Nocturnas</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Dominicales</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Total</th>
              </tr>
            </thead>
            <tbody>
        `;

        nominas.forEach((nomina) => {
          const empleado = empleados.find((e) => e.id === nomina.empleado_id);
          if (!empleado) return;

          const total =
            (nomina.horas_trabajadas || 0) +
            (nomina.horas_extras || 0) +
            (nomina.horas_nocturnas || 0) +
            (nomina.horas_dominicales || 0);

          contenido += `
            <tr>
              <td style="padding: 12px; border: 1px solid #ddd;">${empleado.nombre}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${
                nomina.horas_trabajadas || 0
              }</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${nomina.horas_extras || 0}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${nomina.horas_nocturnas || 0}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${
                nomina.horas_dominicales || 0
              }</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: center; font-weight: bold;">${total.toFixed(
                2
              )}</td>
            </tr>
          `;
        });

        contenido += `
            </tbody>
          </table>
        `;

        return contenido;
      }

      // Generar reporte comparativo de salarios
      function generarReporteComparativoSalarios() {
        let contenido = `
          <h2 style="color: #667eea; text-align: center; margin-bottom: 30px;">COMPARATIVO DE SALARIOS</h2>
          <p style="text-align: center; color: #666; margin-bottom: 30px;">Per√≠odo: ${new Date().toLocaleDateString(
            'es-ES'
          )}</p>
          
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <th style="padding: 12px; border: 1px solid #ddd;">Empleado</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Cargo</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Salario Base</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Salario Neto</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Costo Empresa</th>
              </tr>
            </thead>
            <tbody>
        `;

        // Agrupar por cargo
        const empleadosPorCargo = {};
        empleados.forEach((empleado) => {
          const cargo = empleado.cargo || 'Sin cargo';
          if (!empleadosPorCargo[cargo]) {
            empleadosPorCargo[cargo] = [];
          }
          empleadosPorCargo[cargo].push(empleado);
        });

        Object.keys(empleadosPorCargo).forEach((cargo) => {
          const empleadosCargo = empleadosPorCargo[cargo];

          // Agregar fila de encabezado del cargo
          contenido += `
            <tr style="background: #f8f9fa;">
              <td colspan="5" style="padding: 12px; border: 1px solid #ddd; font-weight: bold; color: #667eea;">
                ${cargo} (${empleadosCargo.length} empleado${empleadosCargo.length > 1 ? 's' : ''})
              </td>
            </tr>
          `;

          empleadosCargo.forEach((empleado) => {
            const nomina = nominas.find((n) => n.empleado_id === empleado.id);
            if (nomina) {
              contenido += `
                <tr>
                  <td style="padding: 12px; border: 1px solid #ddd;">${empleado.nombre}</td>
                  <td style="padding: 12px; border: 1px solid #ddd;">${cargo}</td>
                  <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                    empleado.salario
                  )}</td>
                  <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                    nomina.salario_neto
                  )}</td>
                  <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                    nomina.costo_total_empresa
                  )}</td>
                </tr>
              `;
            }
          });
        });

        contenido += `
            </tbody>
          </table>
        `;

        return contenido;
      }

      // Generar reporte de tendencias salariales
      function generarReporteTendenciasSalariales() {
        let contenido = `
          <h2 style="color: #667eea; text-align: center; margin-bottom: 30px;">TENDENCIAS SALARIALES</h2>
          <p style="text-align: center; color: #666; margin-bottom: 30px;">Per√≠odo: ${new Date().toLocaleDateString(
            'es-ES'
          )}</p>
          
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
            <h3 style="color: #333; margin-top: 0;">Estad√≠sticas Generales</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
              <div>
                <p style="margin: 5px 0;"><strong>Salario promedio:</strong> ${formatearMoneda(
                  empleados.length > 0 ? empleados.reduce((sum, e) => sum + (e.salario || 0), 0) / empleados.length : 0
                )}</p>
                <p style="margin: 5px 0;"><strong>Salario m√≠nimo:</strong> ${formatearMoneda(
                  Math.min(...empleados.map((e) => e.salario || 0))
                )}</p>
                <p style="margin: 5px 0;"><strong>Salario m√°ximo:</strong> ${formatearMoneda(
                  Math.max(...empleados.map((e) => e.salario || 0))
                )}</p>
              </div>
              <div>
                <p style="margin: 5px 0;"><strong>Total empleados:</strong> ${empleados.length}</p>
                <p style="margin: 5px 0;"><strong>Empleados con salario > $2M:</strong> ${
                  empleados.filter((e) => (e.salario || 0) > 2000000).length
                }</p>
                <p style="margin: 5px 0;"><strong>Empleados con salario < $1M:</strong> ${
                  empleados.filter((e) => (e.salario || 0) < 1000000).length
                }</p>
              </div>
            </div>
          </div>
          
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <th style="padding: 12px; border: 1px solid #ddd;">Rango Salarial</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Cantidad Empleados</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Porcentaje</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Total Salarios</th>
              </tr>
            </thead>
            <tbody>
        `;

        const rangos = [
          { min: 0, max: 1000000, label: 'Menos de $1M' },
          { min: 1000000, max: 2000000, label: '$1M - $2M' },
          { min: 2000000, max: 3000000, label: '$2M - $3M' },
          { min: 3000000, max: 5000000, label: '$3M - $5M' },
          { min: 5000000, max: Infinity, label: 'M√°s de $5M' },
        ];

        rangos.forEach((rango) => {
          const empleadosEnRango = empleados.filter((e) => {
            const salario = e.salario || 0;
            return salario >= rango.min && salario < rango.max;
          });

          const totalSalarios = empleadosEnRango.reduce((sum, e) => sum + (e.salario || 0), 0);
          const porcentaje = empleados.length > 0 ? ((empleadosEnRango.length / empleados.length) * 100).toFixed(1) : 0;

          contenido += `
            <tr>
              <td style="padding: 12px; border: 1px solid #ddd;">${rango.label}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${empleadosEnRango.length}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${porcentaje}%</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                totalSalarios
              )}</td>
            </tr>
          `;
        });

        contenido += `
            </tbody>
          </table>
        `;

        return contenido;
      }

      // Generar reporte resumen mensual
      function generarReporteResumenMensual() {
        const mesActual = new Date().getMonth() + 1;
        const anioActual = new Date().getFullYear();
        const nominasMes = nominas.filter((n) => n.mes === mesActual && n.anio === anioActual);

        let contenido = `
          <h2 style="color: #667eea; text-align: center; margin-bottom: 30px;">RESUMEN MENSUAL DE N√ìMINA</h2>
          <p style="text-align: center; color: #666; margin-bottom: 30px;">Per√≠odo: ${obtenerNombreMes(
            mesActual
          )} ${anioActual}</p>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; border-left: 4px solid #4caf50;">
              <h3 style="color: #2e7d32; margin-top: 0;">Total N√≥minas</h3>
              <p style="font-size: 24px; font-weight: bold; color: #2e7d32; margin: 10px 0;">
                ${nominasMes.length}
              </p>
            </div>
            
            <div style="background: #fff3e0; padding: 20px; border-radius: 8px; border-left: 4px solid #ff9800;">
              <h3 style="color: #e65100; margin-top: 0;">Total Horas</h3>
              <p style="font-size: 24px; font-weight: bold; color: #e65100; margin: 10px 0;">
                ${nominasMes.reduce((sum, n) => sum + (n.horas_trabajadas || 0), 0).toFixed(2)} hrs
              </p>
            </div>
            
            <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; border-left: 4px solid #2196f3;">
              <h3 style="color: #1565c0; margin-top: 0;">Total Salarios</h3>
              <p style="font-size: 24px; font-weight: bold; color: #1565c0; margin: 10px 0;">
                ${formatearMoneda(nominasMes.reduce((sum, n) => sum + (n.salario_neto || 0), 0))}
              </p>
            </div>
            
            <div style="background: #fce4ec; padding: 20px; border-radius: 8px; border-left: 4px solid #e91e63;">
              <h3 style="color: #ad1457; margin-top: 0;">Costo Empresa</h3>
              <p style="font-size: 24px; font-weight: bold; color: #ad1457; margin: 10px 0;">
                ${formatearMoneda(nominasMes.reduce((sum, n) => sum + (n.costo_total_empresa || 0), 0))}
              </p>
            </div>
          </div>
          
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <th style="padding: 12px; border: 1px solid #ddd;">Empleado</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Horas</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Salario Neto</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Costo Empresa</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Estado</th>
              </tr>
            </thead>
            <tbody>
        `;

        nominasMes.forEach((nomina) => {
          const empleado = empleados.find((e) => e.id === nomina.empleado_id);
          if (!empleado) return;

          contenido += `
            <tr>
              <td style="padding: 12px; border: 1px solid #ddd;">${empleado.nombre}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${
                nomina.horas_trabajadas || 0
              }</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                nomina.salario_neto
              )}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${formatearMoneda(
                nomina.costo_total_empresa
              )}</td>
              <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">
                <span class="estado-badge estado-${nomina.estado?.toLowerCase() || 'generada'}">
                  ${nomina.estado || 'Generada'}
                </span>
              </td>
            </tr>
          `;
        });

        contenido += `
            </tbody>
          </table>
        `;

        return contenido;
      }

      // Mostrar reporte
      function mostrarReporte(titulo, contenido) {
        const ventanaReporte = window.open('', '_blank');
        ventanaReporte.document.write(`
          <!DOCTYPE html>
          <html>
            <head>
              <title>${titulo} - AXYRA</title>
              <style>
                body { 
                  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                  margin: 0; 
                  padding: 20px; 
                  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                  min-height: 100vh;
                }
                .reporte-container { 
                  max-width: 1200px; 
                  margin: 0 auto; 
                  background: white; 
                  padding: 30px; 
                  border-radius: 16px; 
                  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
                  position: relative;
                  overflow: hidden;
                }
                .reporte-container::before {
                  content: '';
                  position: absolute;
                  top: 0;
                  left: 0;
                  right: 0;
                  height: 4px;
                  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                }
                .no-print { 
                  text-align: center; 
                  margin-bottom: 30px; 
                  padding: 25px; 
                  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                  border-radius: 12px;
                  border: 1px solid #e2e8f0;
                }
                .no-print h2 {
                  color: #1e3a8a;
                  margin: 0 0 15px 0;
                  font-size: 1.8rem;
                  font-weight: 600;
                }
                .no-print p {
                  color: #64748b;
                  margin: 0 0 20px 0;
                  font-size: 1rem;
                }
                .btn { 
                  padding: 12px 24px; 
                  margin: 8px; 
                  border: none; 
                  border-radius: 8px; 
                  cursor: pointer; 
                  font-size: 14px; 
                  font-weight: 600;
                  transition: all 0.3s ease;
                  text-transform: uppercase;
                  letter-spacing: 0.5px;
                }
                .btn:hover {
                  transform: translateY(-2px);
                  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                }
                .btn-primary { 
                  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                  color: white; 
                }
                .btn-secondary { 
                  background: linear-gradient(135deg, #6c757d 0%, #495057 100%); 
                  color: white; 
                }
                .btn-success {
                  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                  color: white;
                }
                .reporte-content {
                  background: white;
                  border-radius: 8px;
                  overflow: hidden;
                }
                .reporte-content h2 {
                  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                  color: white;
                  padding: 20px;
                  margin: 0;
                  text-align: center;
                  font-size: 1.5rem;
                  font-weight: 600;
                }
                .reporte-content table {
                  width: 100%;
                  border-collapse: collapse;
                  margin: 20px 0;
                }
                .reporte-content th {
                  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                  color: #1e3a8a;
                  padding: 15px;
                  text-align: left;
                  font-weight: 600;
                  border-bottom: 2px solid #cbd5e1;
                }
                .reporte-content td {
                  padding: 12px 15px;
                  border-bottom: 1px solid #e2e8f0;
                }
                .reporte-content tr:nth-child(even) {
                  background: #f8fafc;
                }
                .reporte-content tr:hover {
                  background: #f1f5f9;
                }
                @media print {
                  body { 
                    background: white; 
                    padding: 0;
                  }
                  .no-print { display: none; }
                  .reporte-container { 
                    box-shadow: none; 
                    padding: 0; 
                    border-radius: 0;
                  }
                  .reporte-container::before {
                    display: none;
                  }
                }
                @media (max-width: 768px) {
                  body { padding: 10px; }
                  .reporte-container { padding: 20px; }
                  .no-print { padding: 20px; }
                  .btn { 
                    width: 100%; 
                    margin: 5px 0; 
                  }
                }
              </style>
            </head>
            <body>
              <div class="reporte-container">
                <div class="no-print">
                  <h2>${titulo}</h2>
                  <p>üìä Reporte generado autom√°ticamente por el sistema AXYRA</p>
                  <p>üí° Presiona Ctrl+P para imprimir o guardar como PDF</p>
                  <button class="btn btn-primary" onclick="window.print()">
                    üñ®Ô∏è Imprimir / Guardar PDF
                  </button>
                  <button class="btn btn-success" onclick="exportarReporteExcel()">
                    üìä Exportar a Excel
                  </button>
                  <button class="btn btn-secondary" onclick="window.close()">
                    ‚ùå Cerrar
                  </button>
                </div>
                <div class="reporte-content">
                  ${contenido}
                </div>
              </div>
              <script>
                function exportarReporteExcel() {
                  try {
                    // Obtener datos de n√≥mina
                    const nominas = JSON.parse(localStorage.getItem('axyra_nominas') || '[]');
                    const empleados = JSON.parse(localStorage.getItem('axyra_empleados') || '[]');
                    
                    if (nominas.length === 0) {
                      alert('No hay datos de n√≥mina para exportar');
                      return;
                    }

                    // Preparar datos para Excel
                    const datosExcel = [
                      ['ID', 'Empleado', 'Departamento', 'Salario Base', 'Horas Trabajadas', 'Total Horas', 'Valor por Hora', 'Total a Pagar', 'Fecha', 'Estado']
                    ];

                    nominas.forEach(nomina => {
                      const empleado = empleados.find(emp => emp.id === nomina.empleado_id);
                      datosExcel.push([
                        nomina.id || 'N/A',
                        empleado ? empleado.nombre : 'Empleado no encontrado',
                        empleado ? empleado.cargo : 'N/A',
                        `$${nomina.salario_base?.toLocaleString() || '0'}`,
                        nomina.horas_trabajadas || '0',
                        (nomina.horas_trabajadas + nomina.horas_extras + nomina.horas_nocturnas + nomina.horas_dominicales) || '0',
                        `$${nomina.salario_por_hora?.toLocaleString() || '0'}`,
                        `$${nomina.salario_neto?.toLocaleString() || '0'}`,
                        nomina.fecha_generacion ? new Date(nomina.fecha_generacion).toLocaleDateString() : 'N/A',
                        nomina.estado || 'N/A'
                      ]);
                    });

                    // Crear libro de Excel
                    const workbook = XLSX.utils.book_new();
                    const worksheet = XLSX.utils.aoa_to_sheet(datosExcel);

                    // Aplicar estilos profesionales
                    worksheet['!cols'] = [
                      { width: 8 },   // ID
                      { width: 25 },  // Empleado
                      { width: 20 },  // Departamento
                      { width: 15 },  // Salario Base
                      { width: 18 },  // Horas Trabajadas
                      { width: 15 },  // Total Horas
                      { width: 18 },  // Valor por Hora
                      { width: 18 },  // Total a Pagar
                      { width: 15 },  // Fecha
                      { width: 12 }   // Estado
                    ];

                    // Agregar hoja al libro
                    XLSX.utils.book_append_sheet(workbook, worksheet, 'N√≥mina');

                    // Generar nombre de archivo con fecha
                    const fecha = new Date().toISOString().split('T')[0];
                    const nombreArchivo = `Reporte_Nomina_Villa_Venecia_${fecha}.xlsx`;

                    // Descargar archivo
                    XLSX.writeFile(workbook, nombreArchivo);
                    
                    console.log('‚úÖ Reporte de n√≥mina exportado correctamente:', nombreArchivo);
                  } catch (error) {
                    console.error('‚ùå Error exportando reporte de n√≥mina:', error);
                    alert('Error al exportar: ' + error.message);
                  }
                }
              </script>
            </body>
          </html>
        `);
        ventanaReporte.document.close();
      }

      // Funci√≥n para generar reportes de n√≥mina
      function generarReportesNomina() {
        try {
          const nominas = JSON.parse(localStorage.getItem('axyra_nominas') || '[]');
          const empleados = JSON.parse(localStorage.getItem('axyra_empleados') || '[]');
          
          if (nominas.length === 0) {
            mostrarNotificacion('No hay datos de n√≥mina para generar reportes', 'warning');
            return;
          }

          // Generar reporte resumido
          const contenido = generarContenidoReporte(nominas, empleados);
          mostrarReporte('Reporte de N√≥mina - Villa Venecia', contenido);
          
          mostrarNotificacion('‚úÖ Reporte de n√≥mina generado correctamente', 'success');
        } catch (error) {
          console.error('‚ùå Error generando reportes:', error);
          mostrarNotificacion('Error generando reportes: ' + error.message, 'error');
        }
      }

      // Funci√≥n para configuraci√≥n avanzada de n√≥mina
      function configuracionAvanzadaNomina() {
        try {
          // Mostrar modal de configuraci√≥n
          const modal = document.createElement('div');
          modal.className = 'modal-overlay active';
          modal.innerHTML = `
            <div class="modal-content">
              <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">√ó</button>
              <div class="modal-header">
                <h3>‚öôÔ∏è Configuraci√≥n Avanzada de N√≥mina</h3>
                <p>Configura los par√°metros del sistema de n√≥mina</p>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label for="salarioMinimo">Salario M√≠nimo Legal:</label>
                  <input type="number" id="salarioMinimo" placeholder="Salario m√≠nimo vigente">
                </div>
                <div class="form-group">
                  <label for="porcentajeCesantias">% Cesant√≠as:</label>
                  <input type="number" id="porcentajeCesantias" value="8.33" step="0.01">
                </div>
                <div class="form-group">
                  <label for="porcentajePrima">% Prima de Servicios:</label>
                  <input type="number" id="porcentajePrima" value="8.33" step="0.01">
                </div>
                <div class="form-group">
                  <label for="porcentajeInteresesCesantias">% Intereses Cesant√≠as:</label>
                  <input type="number" id="porcentajeInteresesCesantias" value="12" step="0.01">
                </div>
                <div class="form-group">
                  <label for="porcentajeSalud">% Salud:</label>
                  <input type="number" id="porcentajeSalud" value="4" step="0.01">
                </div>
                <div class="form-group">
                  <label for="porcentajePension">% Pensi√≥n:</label>
                  <input type="number" id="porcentajePension" value="4" step="0.01">
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarConfiguracionNomina()">Guardar</button>
              </div>
            </div>
          `;
          
          document.body.appendChild(modal);
          cargarConfiguracionGuardada();
        } catch (error) {
          console.error('‚ùå Error en configuraci√≥n avanzada:', error);
          mostrarNotificacion('Error en configuraci√≥n: ' + error.message, 'error');
        }
      }

      // Funci√≥n para guardar configuraci√≥n
      function guardarConfiguracionNomina() {
        try {
          const config = {
            salarioMinimo: parseFloat(document.getElementById('salarioMinimo').value) || 0,
            porcentajeCesantias: parseFloat(document.getElementById('porcentajeCesantias').value) || 8.33,
            porcentajePrima: parseFloat(document.getElementById('porcentajePrima').value) || 8.33,
            porcentajeInteresesCesantias: parseFloat(document.getElementById('porcentajeInteresesCesantias').value) || 12,
            porcentajeSalud: parseFloat(document.getElementById('porcentajeSalud').value) || 4,
            porcentajePension: parseFloat(document.getElementById('porcentajePension').value) || 4
          };

          localStorage.setItem('axyra_configuracion_nomina', JSON.stringify(config));
          mostrarNotificacion('‚úÖ Configuraci√≥n guardada correctamente', 'success');
          
          // Cerrar modal
          document.querySelector('.modal-overlay').remove();
        } catch (error) {
          console.error('‚ùå Error guardando configuraci√≥n:', error);
          mostrarNotificacion('Error guardando configuraci√≥n: ' + error.message, 'error');
        }
      }
    </script>

    <script>
      // Cargar configuraci√≥n guardada
      function cargarConfiguracionGuardada() {
        try {
          const configuracion = localStorage.getItem('axyra_configuracion_nomina');
          if (configuracion) {
            const config = JSON.parse(configuracion);

            // Llenar campos del formulario
            if (document.getElementById('salarioMinimo')) {
              document.getElementById('salarioMinimo').value = config.salarioMinimo || '';
            }
            if (document.getElementById('porcentajeCesantias')) {
              document.getElementById('porcentajeCesantias').value = config.porcentajeCesantias || '';
            }
            if (document.getElementById('porcentajePrima')) {
              document.getElementById('porcentajePrima').value = config.porcentajePrima || '';
            }
            if (document.getElementById('porcentajeInteresesCesantias')) {
              document.getElementById('porcentajeInteresesCesantias').value = config.porcentajeInteresesCesantias || '';
            }
            if (document.getElementById('porcentajeSalud')) {
              document.getElementById('porcentajeSalud').value = config.porcentajeSalud || '';
            }
            if (document.getElementById('porcentajePension')) {
              document.getElementById('porcentajePension').value = config.porcentajePension || '';
            }
          }
        } catch (error) {
          console.error('‚ùå Error cargando configuraci√≥n:', error);
        }
      }

      // Configurar listener para cambios en empleados
      
      // FUNCIONES AVANZADAS DE N√ìMINA - IMPLEMENTACI√ìN COMPLETA
      
      // Funci√≥n para calcular n√≥mina autom√°ticamente
      function calcularNominaAutomatica(empleadoId) {
        try {
          console.log('üîÑ Calculando n√≥mina autom√°tica para empleado:', empleadoId);
          
          const empleado = empleados.find(emp => emp.id == empleadoId || emp.id == parseInt(empleadoId));
          if (!empleado) {
            throw new Error('Empleado no encontrado');
          }
          
          // Obtener horas del empleado del mes actual
          const mesActual = new Date().getMonth();
          const a√±oActual = new Date().getFullYear();
          
          const horasEmpleado = JSON.parse(localStorage.getItem('axyra_horas') || '[]')
            .filter(h => {
              const fechaHora = new Date(h.fecha);
              return (h.empleadoId == empleadoId || h.cedula === empleado.cedula) &&
                     fechaHora.getMonth() === mesActual &&
                     fechaHora.getFullYear() === a√±oActual;
            });
          
          if (horasEmpleado.length === 0) {
            throw new Error('No hay horas registradas para este mes');
          }
          
          // Calcular totales de horas
          const totalHoras = horasEmpleado.reduce((total, h) => total + (h.total_horas || 0), 0);
          const horasExtras = horasEmpleado.reduce((total, h) => total + (h.horas_extras || 0), 0);
          const horasNocturnas = horasEmpleado.reduce((total, h) => total + (h.horas_nocturnas || 0), 0);
          const horasDominicales = horasEmpleado.reduce((total, h) => total + (h.horas_dominicales || 0), 0);
          
          // Calcular salario base por hora
          const salarioBase = parseFloat(empleado.salario || 0);
          const salarioPorHora = salarioBase / 240; // 240 horas mensuales est√°ndar
          
          // Calcular salario neto
          let salarioNeto = salarioBase;
          
          // Agregar horas extras (1.5x)
          if (horasExtras > 0) {
            salarioNeto += (horasExtras * salarioPorHora * 1.5);
          }
          
          // Agregar horas nocturnas (1.35x)
          if (horasNocturnas > 0) {
            salarioNeto += (horasNocturnas * salarioPorHora * 1.35);
          }
          
          // Agregar horas dominicales (1.75x)
          if (horasDominicales > 0) {
            salarioNeto += (horasDominicales * salarioPorHora * 1.75);
          }
          
          // Calcular prestaciones sociales
          const cesantias = salarioBase * 0.0833; // 8.33%
          const prima = salarioBase * 0.0833; // 8.33%
          const interesesCesantias = cesantias * 0.12; // 12%
          
          // Calcular deducciones
          const salud = salarioBase * 0.04; // 4%
          const pension = salarioBase * 0.04; // 4%
          
          // Crear objeto de n√≥mina
          const nomina = {
            id: Date.now(),
            empleado_id: empleado.id,
            empleado_nombre: empleado.nombre,
            empleado_cedula: empleado.cedula,
            empleado_cargo: empleado.cargo,
            empleado_departamento: empleado.departamento,
            fecha_generacion: new Date().toISOString(),
            periodo: `${mesActual + 1}/${a√±oActual}`,
            salario_base: salarioBase,
            salario_por_hora: salarioPorHora,
            horas_trabajadas: totalHoras,
            horas_extras: horasExtras,
            horas_nocturnas: horasNocturnas,
            horas_dominicales: horasDominicales,
            salario_neto: salarioNeto,
            cesantias: cesantias,
            prima: prima,
            intereses_cesantias: interesesCesantias,
            salud: salud,
            pension: pension,
            total_prestaciones: cesantias + prima + interesesCesantias,
            total_deducciones: salud + pension,
            salario_final: salarioNeto - (salud + pension),
            estado: 'PENDIENTE_APROBACION'
          };
          
          // Guardar n√≥mina
          const nominas = JSON.parse(localStorage.getItem('axyra_nominas') || '[]');
          nominas.push(nomina);
          localStorage.setItem('axyra_nominas', JSON.stringify(nominas));
          
          // Actualizar tabla
          cargarNominas();
          
          console.log('‚úÖ N√≥mina calculada autom√°ticamente:', nomina);
          mostrarMensaje('‚úÖ N√≥mina calculada autom√°ticamente para ' + empleado.nombre, 'success');
          
          return nomina;
        } catch (error) {
          console.error('‚ùå Error calculando n√≥mina autom√°tica:', error);
          mostrarMensaje('‚ùå Error: ' + error.message, 'error');
          return null;
        }
      }
      
      // Funci√≥n para generar PDF de n√≥mina
      function generarPDFNomina(nominaId) {
        try {
          console.log('üîÑ Generando PDF de n√≥mina:', nominaId);
          
          const nomina = nominas.find(n => n.id == nominaId || n.id == parseInt(nominaId));
          if (!nomina) {
            throw new Error('N√≥mina no encontrada');
          }
          
          const empleado = empleados.find(emp => emp.id == nomina.empleado_id);
          if (!empleado) {
            throw new Error('Empleado no encontrado');
          }
          
          // Verificar si jsPDF est√° disponible
          if (typeof jsPDF === 'undefined') {
            console.warn('‚ö†Ô∏è jsPDF no disponible, descargando como JSON');
            descargarNominaJSON(nomina);
            return;
          }
          
          const { jsPDF } = window.jsPDF;
          const doc = new jsPDF();
          
          // Configurar documento
          doc.setFontSize(20);
          doc.setTextColor(30, 58, 138);
          doc.text('COMPROBANTE DE N√ìMINA', 105, 20, { align: 'center' });
          
          // Informaci√≥n de la empresa
          doc.setFontSize(12);
          doc.setTextColor(51, 65, 85);
          doc.text('VILLA VENECIA', 20, 35);
          doc.text('Sistema AXYRA', 20, 42);
          doc.text('Fecha: ' + new Date(nomina.fecha_generacion).toLocaleDateString(), 20, 49);
          
          // Informaci√≥n del empleado
          doc.setFontSize(14);
          doc.setTextColor(30, 58, 138);
          doc.text('DATOS DEL EMPLEADO', 20, 65);
          
          doc.setFontSize(10);
          doc.setTextColor(51, 65, 85);
          doc.text('Nombre: ' + empleado.nombre, 20, 75);
          doc.text('C√©dula: ' + empleado.cedula, 20, 82);
          doc.text('Cargo: ' + empleado.cargo, 20, 89);
          doc.text('Departamento: ' + (empleado.departamento || 'N/A'), 20, 96);
          
          // Detalles de la n√≥mina
          doc.setFontSize(14);
          doc.setTextColor(30, 58, 138);
          doc.text('DETALLES DE LA N√ìMINA', 20, 110);
          
          doc.setFontSize(10);
          doc.setTextColor(51, 65, 85);
          doc.text('Per√≠odo: ' + nomina.periodo, 20, 120);
          doc.text('Salario Base: $' + nomina.salario_base?.toLocaleString(), 20, 127);
          doc.text('Horas Trabajadas: ' + nomina.horas_trabajadas, 20, 134);
          doc.text('Horas Extras: ' + nomina.horas_extras, 20, 141);
          doc.text('Horas Nocturnas: ' + nomina.horas_nocturnas, 20, 148);
          doc.text('Horas Dominicales: ' + nomina.horas_dominicales, 20, 155);
          
          // Totales
          doc.setFontSize(12);
          doc.setTextColor(30, 58, 138);
          doc.text('TOTALES', 20, 170);
          
          doc.setFontSize(10);
          doc.setTextColor(51, 65, 85);
          doc.text('Salario Neto: $' + nomina.salario_neto?.toLocaleString(), 20, 180);
          doc.text('Prestaciones: $' + nomina.total_prestaciones?.toLocaleString(), 20, 187);
          doc.text('Deducciones: $' + nomina.total_deducciones?.toLocaleString(), 20, 194);
          doc.text('Salario Final: $' + nomina.salario_final?.toLocaleString(), 20, 201);
          
          // Estado
          doc.setFontSize(12);
          doc.setTextColor(30, 58, 138);
          doc.text('Estado: ' + nomina.estado, 20, 215);
          
          // Generar nombre de archivo
          const nombreArchivo = `NOMINA_${empleado.nombre.replace(/\s+/g, '_')}_${nomina.periodo.replace('/', '_')}.pdf`;
          
          // Guardar PDF
          doc.save(nombreArchivo);
          
          console.log('‚úÖ PDF de n√≥mina generado:', nombreArchivo);
          mostrarMensaje('‚úÖ PDF de n√≥mina generado correctamente', 'success');
          
        } catch (error) {
          console.error('‚ùå Error generando PDF de n√≥mina:', error);
          mostrarMensaje('‚ùå Error: ' + error.message, 'error');
        }
      }
      
      // Funci√≥n para descargar n√≥mina como JSON (fallback)
      function descargarNominaJSON(nomina) {
        try {
          const dataStr = JSON.stringify(nomina, null, 2);
          const dataBlob = new Blob([dataStr], { type: 'application/json' });
          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `NOMINA_${nomina.empleado_nombre.replace(/\s+/g, '_')}_${nomina.periodo.replace('/', '_')}.json`;
          link.click();
          URL.revokeObjectURL(url);
          
          console.log('‚úÖ N√≥mina descargada como JSON');
          mostrarMensaje('‚úÖ N√≥mina descargada como JSON', 'info');
        } catch (error) {
          console.error('‚ùå Error descargando JSON:', error);
        }
      }
      
      // Funci√≥n para aprobar n√≥mina
      function aprobarNomina(nominaId) {
        try {
          console.log('üîÑ Aprobando n√≥mina:', nominaId);
          
          const nomina = nominas.find(n => n.id == nominaId || n.id == parseInt(nominaId));
          if (!nomina) {
            throw new Error('N√≥mina no encontrada');
          }
          
          nomina.estado = 'APROBADA';
          nomina.fecha_aprobacion = new Date().toISOString();
          nomina.aprobado_por = currentUser?.username || 'Sistema';
          
          // Guardar cambios
          localStorage.setItem('axyra_nominas', JSON.stringify(nominas));
          
          // Actualizar tabla
          cargarNominas();
          
          console.log('‚úÖ N√≥mina aprobada:', nomina);
          mostrarMensaje('‚úÖ N√≥mina aprobada correctamente', 'success');
          
          // Generar notificaci√≥n
          if (window.axyraNotificationSystem) {
            window.axyraNotificationSystem.generateSystemNotifications();
          }
          
        } catch (error) {
          console.error('‚ùå Error aprobando n√≥mina:', error);
          mostrarMensaje('‚ùå Error: ' + error.message, 'error');
        }
      }
      
      // Funci√≥n para rechazar n√≥mina
      function rechazarNomina(nominaId, motivo) {
        try {
          console.log('üîÑ Rechazando n√≥mina:', nominaId, 'Motivo:', motivo);
          
          const nomina = nominas.find(n => n.id == nominaId || n.id == parseInt(nominaId));
          if (!nomina) {
            throw new Error('N√≥mina no encontrada');
          }
          
          nomina.estado = 'RECHAZADA';
          nomina.fecha_rechazo = new Date().toISOString();
          nomina.rechazado_por = currentUser?.username || 'Sistema';
          nomina.motivo_rechazo = motivo;
          
          // Guardar cambios
          localStorage.setItem('axyra_nominas', JSON.stringify(nominas));
          
          // Actualizar tabla
          cargarNominas();
          
          console.log('‚úÖ N√≥mina rechazada:', nomina);
          mostrarMensaje('‚úÖ N√≥mina rechazada correctamente', 'success');
          
        } catch (error) {
          console.error('‚ùå Error rechazando n√≥mina:', error);
          mostrarMensaje('‚ùå Error: ' + error.message, 'error');
        }
      }
      function configurarListenerCambiosEmpleados() {
        try {
          console.log('üëÇ Configurando listener para cambios en empleados...');
          
          // Escuchar eventos personalizados
          window.addEventListener('axyraEmpleadosCambiados', async (event) => {
            console.log('üì¢ Evento de cambio en empleados recibido:', event.detail);
            
            // Verificar que el cambio sea para el usuario actual
            if (currentUser && event.detail.userId === (currentUser.id || currentUser.username || currentUser.email)) {
              console.log('üîÑ Refrescando n√≥mina por cambio en empleados...');
              await cargarDatos();
              llenarSelects();
              renderizarTablaNominas();
            }
          });
          
          // Tambi√©n escuchar cambios en localStorage para compatibilidad
          window.addEventListener('storage', (event) => {
            if (event.key === 'axyra_last_employee_change') {
              try {
                const changeData = JSON.parse(event.newValue);
                console.log('üì¢ Cambio en empleados detectado v√≠a localStorage:', changeData);
                
                // Verificar que el cambio sea para el usuario actual
                if (currentUser && changeData.userId === (currentUser.id || currentUser.username || currentUser.email)) {
                  console.log('üîÑ Refrescando n√≥mina por cambio en empleados (localStorage)...');
                  setTimeout(async () => {
                    await cargarDatos();
                    llenarSelects();
                    renderizarTablaNominas();
                  }, 100);
                }
              } catch (error) {
                console.error('‚ùå Error procesando cambio v√≠a localStorage:', error);
              }
            }
          });
          
          console.log('‚úÖ Listener configurado correctamente');
        } catch (error) {
          console.error('‚ùå Error configurando listener:', error);
        }
      }

      // Funci√≥n para generar PDF individual (funci√≥n global)
      window.generarComprobantePDFIndividual = function() {
        try {
          // Obtener la n√≥mina actual del modal
          const modal = document.getElementById('modalDetalleNomina');
          if (!modal) {
            mostrarNotificacion('Error: Modal no encontrado', 'error');
            return;
          }

          // Obtener datos de la n√≥mina
          const nominaId = modal.getAttribute('data-nomina-id');
          const nominas = JSON.parse(localStorage.getItem('axyra_nominas') || '[]');
          const nomina = nominas.find(n => n.id === nominaId);
          
          if (!nomina) {
            mostrarNotificacion('Error: N√≥mina no encontrada', 'error');
            return;
          }

          const empleados = JSON.parse(localStorage.getItem('axyra_empleados') || '[]');
          const empleado = empleados.find(emp => emp.id === nomina.empleado_id);
          
          if (!empleado) {
            mostrarNotificacion('Error: Empleado no encontrado', 'error');
            return;
          }

          // Generar contenido del PDF
          const contenido = generarContenidoComprobante(nomina, empleado);
          
          // Intentar usar jsPDF si est√° disponible
          if (typeof jsPDF !== 'undefined') {
            generarPDFConJsPDF(contenido, nomina, empleado);
          } else {
            // Fallback a impresi√≥n directa
            mostrarContenidoParaImprimirIndividual(contenido, nomina, empleado);
          }
        } catch (error) {
          console.error('‚ùå Error generando PDF individual:', error);
          mostrarNotificacion('Error al generar PDF: ' + error.message, 'error');
        }
      };

      // Funci√≥n para exportar n√≥mina a Excel
      window.exportarNomina = function() {
        try {
          const nominas = JSON.parse(localStorage.getItem('axyra_nominas') || '[]');
          const empleados = JSON.parse(localStorage.getItem('axyra_empleados') || '[]');
          
          if (nominas.length === 0) {
            mostrarNotificacion('No hay n√≥minas para exportar', 'warning');
            return;
          }

          // Preparar datos para Excel
          const datosExcel = [
            ['ID', 'Empleado', 'Departamento', 'Salario Base', 'Horas Trabajadas', 'Total Horas', 'Valor por Hora', 'Total a Pagar', 'Fecha', 'Estado']
          ];

          nominas.forEach(nomina => {
            const empleado = empleados.find(emp => emp.id === nomina.empleado_id);
            datosExcel.push([
              nomina.id || 'N/A',
              empleado ? empleado.nombre : 'Empleado no encontrado',
              empleado ? empleado.cargo : 'N/A',
              `$${nomina.salario_base?.toLocaleString() || '0'}`,
              nomina.horas_trabajadas || '0',
              (nomina.horas_trabajadas + nomina.horas_extras + nomina.horas_nocturnas + nomina.horas_dominicales) || '0',
              `$${nomina.salario_por_hora?.toLocaleString() || '0'}`,
              `$${nomina.salario_neto?.toLocaleString() || '0'}`,
              nomina.fecha_generacion ? new Date(nomina.fecha_generacion).toLocaleDateString() : 'N/A',
              nomina.estado || 'N/A'
            ]);
          });

          // Crear libro de Excel
          const workbook = XLSX.utils.book_new();
          const worksheet = XLSX.utils.aoa_to_sheet(datosExcel);

          // Aplicar estilos profesionales
          worksheet['!cols'] = [
            { width: 8 },   // ID
            { width: 25 },  // Empleado
            { width: 20 },  // Departamento
            { width: 15 },  // Salario Base
            { width: 18 },  // Horas Trabajadas
            { width: 15 },  // Total Horas
            { width: 18 },  // Valor por Hora
            { width: 18 },  // Total a Pagar
            { width: 15 },  // Fecha
            { width: 12 }   // Estado
          ];

          // Agregar hoja al libro
          XLSX.utils.book_append_sheet(workbook, worksheet, 'N√≥mina');

          // Generar nombre de archivo con fecha
          const fecha = new Date().toISOString().split('T')[0];
          const nombreArchivo = `N√≥mina_Villa_Venecia_${fecha}.xlsx`;

          // Descargar archivo
          XLSX.writeFile(workbook, nombreArchivo);
          
          console.log('‚úÖ N√≥mina exportada correctamente:', nombreArchivo);
          mostrarNotificacion('N√≥mina exportada correctamente', 'success');
        } catch (error) {
          console.error('‚ùå Error exportando n√≥mina:', error);
          mostrarNotificacion('Error al exportar: ' + error.message, 'error');
        }
      };

      // Funci√≥n para generar comprobante PDF
      window.generarComprobantePDF = function() {
        try {
          const nominas = JSON.parse(localStorage.getItem('axyra_nominas') || '[]');
          const empleados = JSON.parse(localStorage.getItem('axyra_empleados') || '[]');
          
          if (nominas.length === 0) {
            mostrarNotificacion('No hay n√≥minas para generar comprobantes', 'warning');
            return;
          }

          // Mostrar modal de selecci√≥n
          mostrarModal('modalGenerarComprobante');
          
          // Llenar select con empleados que tienen n√≥mina
          const selectEmpleado = document.getElementById('selectEmpleadoComprobante');
          if (selectEmpleado) {
            selectEmpleado.innerHTML = '<option value="">Seleccionar empleado</option>';
            
            const empleadosConNomina = empleados.filter(emp => 
              nominas.some(nom => nom.empleado_id === emp.id)
            );
            
            empleadosConNomina.forEach(emp => {
              const option = document.createElement('option');
              option.value = emp.id;
              option.textContent = emp.nombre;
              selectEmpleado.appendChild(option);
            });
          }
        } catch (error) {
          console.error('‚ùå Error preparando generaci√≥n de comprobante:', error);
          mostrarNotificacion('Error al preparar comprobante: ' + error.message, 'error');
        }
      };

      // Funci√≥n para generar reportes
      window.generarReportes = function() {
        try {
          mostrarModal('modalReportesAvanzados');
        } catch (error) {
          console.error('‚ùå Error mostrando reportes:', error);
          mostrarNotificacion('Error al mostrar reportes: ' + error.message, 'error');
        }
      };

      // Funci√≥n para configuraci√≥n de n√≥mina
      window.configuracionNomina = function() {
        try {
          mostrarModal('modalConfiguracionNomina');
          cargarConfiguracionGuardada();
        } catch (error) {
          console.error('‚ùå Error mostrando configuraci√≥n:', error);
          mostrarNotificacion('Error al mostrar configuraci√≥n: ' + error.message, 'error');
        }
      };

      // Funci√≥n para mostrar notificaciones
      function mostrarNotificacion(mensaje, tipo = 'info') {
        try {
          // Crear elemento de notificaci√≥n
          const notificacion = document.createElement('div');
          notificacion.className = `axyra-notificacion axyra-notificacion-${tipo}`;
          notificacion.innerHTML = `
            <div class="axyra-notificacion-icono">
              ${tipo === 'success' ? '‚úÖ' : tipo === 'error' ? '‚ùå' : tipo === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}
            </div>
            <div class="axyra-notificacion-contenido">
              <div class="axyra-notificacion-mensaje">${mensaje}</div>
            </div>
            <button class="axyra-notificacion-cerrar" onclick="this.closest('.axyra-notificacion').remove()">
              √ó
            </button>
          `;
          
          // Agregar al DOM
          document.body.appendChild(notificacion);
          
          // Auto-remover despu√©s de 5 segundos
          setTimeout(() => {
            if (notificacion.parentElement) {
              notificacion.remove();
            }
          }, 5000);
        } catch (error) {
          console.error('‚ùå Error mostrando notificaci√≥n:', error);
          // Fallback a alert
          alert(mensaje);
        }
      }

      // Funci√≥n para aprobar n√≥mina
      function aprobarNomina(nominaId) {
        try {
          const nominas = JSON.parse(localStorage.getItem('axyra_nominas') || '[]');
          const nomina = nominas.find(n => n.id == nominaId);
          
          if (!nomina) {
            mostrarNotificacion('N√≥mina no encontrada', 'error');
            return;
          }
          
          nomina.estado = 'APROBADA';
          nomina.fecha_aprobacion = new Date().toISOString();
          nomina.aprobado_por = 'axyra.app@gmail.com';
          
          localStorage.setItem('axyra_nominas', JSON.stringify(nominas));
          
          // Registrar en auditor√≠a
          if (window.axyraAuditSystemUnified) {
            window.axyraAuditSystemUnified.logSystemEvent('nomina_aprobada', {
              nomina_id: nominaId,
              empleado: nomina.empleado_nombre,
              monto: nomina.salario_final
            });
          }
          
          mostrarNotificacion('‚úÖ N√≥mina aprobada correctamente', 'success');
          cargarNominas(); // Recargar tabla
        } catch (error) {
          console.error('‚ùå Error aprobando n√≥mina:', error);
          mostrarNotificacion('Error aprobando n√≥mina: ' + error.message, 'error');
        }
      }

      // Funci√≥n para rechazar n√≥mina
      function rechazarNomina(nominaId, motivo) {
        try {
          const nominas = JSON.parse(localStorage.getItem('axyra_nominas') || '[]');
          const nomina = nominas.find(n => n.id == nominaId);
          
          if (!nomina) {
            mostrarNotificacion('N√≥mina no encontrada', 'error');
            return;
          }
          
          nomina.estado = 'RECHAZADA';
          nomina.fecha_rechazo = new Date().toISOString();
          nomina.rechazado_por = 'axyra.app@gmail.com';
          nomina.motivo_rechazo = motivo;
          
          localStorage.setItem('axyra_nominas', JSON.stringify(nominas));
          
          // Registrar en auditor√≠a
          if (window.axyraAuditSystemUnified) {
            window.axyraAuditSystemUnified.logSystemEvent('nomina_rechazada', {
              nomina_id: nominaId,
              empleado: nomina.empleado_nombre,
              motivo: motivo
            });
          }
          
          mostrarNotificacion('‚ö†Ô∏è N√≥mina rechazada', 'warning');
          cargarNominas(); // Recargar tabla
        } catch (error) {
          console.error('‚ùå Error rechazando n√≥mina:', error);
          mostrarNotificacion('Error rechazando n√≥mina: ' + error.message, 'error');
        }
      }

      // Funci√≥n para validar n√≥mina antes de generar
      function validarNomina(empleadoId) {
        try {
          const empleado = empleados.find(emp => emp.id == empleadoId);
          if (!empleado) {
            return { valido: false, error: 'Empleado no encontrado' };
          }
          
          // Verificar que tenga salario base
          if (!empleado.salario || empleado.salario <= 0) {
            return { valido: false, error: 'Empleado sin salario base configurado' };
          }
          
          // Verificar que tenga horas registradas
          const horas = JSON.parse(localStorage.getItem('axyra_horas') || '[]')
            .filter(h => h.empleadoId == empleadoId);
          
          if (horas.length === 0) {
            return { valido: false, error: 'No hay horas registradas para este empleado' };
          }
          
          return { valido: true };
        } catch (error) {
          return { valido: false, error: 'Error en validaci√≥n: ' + error.message };
        }
      }

      // Funci√≥n para generar n√≥mina con validaciones
      function generarNominaConValidacion(empleadoId) {
        try {
          const validacion = validarNomina(empleadoId);
          
          if (!validacion.valido) {
            mostrarNotificacion(validacion.error, 'error');
            return;
          }
          
          // Generar n√≥mina autom√°tica
          const nomina = calcularNominaAutomatica(empleadoId);
          
          if (nomina) {
            mostrarNotificacion('‚úÖ N√≥mina generada correctamente', 'success');
            cargarNominas(); // Recargar tabla
          }
        } catch (error) {
          console.error('‚ùå Error generando n√≥mina:', error);
          mostrarNotificacion('Error generando n√≥mina: ' + error.message, 'error');
        }
      }

      // Variables globales para gr√°ficos
      let costosMensualesChart, distribucionSalariosChart, horasEmpleadoChart;

      // Funci√≥n para inicializar gr√°ficos de analytics
      function inicializarGraficosAnalytics() {
        try {
          // Gr√°fico de Costos Mensuales
          const ctxCostos = document.getElementById('costosMensualesChart');
          if (ctxCostos) {
            costosMensualesChart = new Chart(ctxCostos, {
              type: 'line',
              data: {
                labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                datasets: [{
                  label: 'Costos Laborales',
                  data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                  borderColor: '#667eea',
                  backgroundColor: 'rgba(102, 126, 234, 0.1)',
                  tension: 0.4,
                  fill: true
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    position: 'top',
                  },
                  title: {
                    display: true,
                    text: 'Evoluci√≥n de Costos Laborales'
                  }
                },
                scales: {
                  y: {
                    beginAtZero: true,
                    ticks: {
                      callback: function(value) {
                        return '$' + value.toLocaleString();
                      }
                    }
                  }
                }
              }
            });
          }

          // Gr√°fico de Distribuci√≥n de Salarios
          const ctxDistribucion = document.getElementById('distribucionSalariosChart');
          if (ctxDistribucion) {
            distribucionSalariosChart = new Chart(ctxDistribucion, {
              type: 'doughnut',
              data: {
                labels: ['Bajo', 'Medio', 'Alto', 'Ejecutivo'],
                datasets: [{
                  data: [0, 0, 0, 0],
                  backgroundColor: [
                    '#10b981',
                    '#f59e0b',
                    '#ef4444',
                    '#8b5cf6'
                  ]
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    position: 'bottom',
                  },
                  title: {
                    display: true,
                    text: 'Distribuci√≥n Salarial'
                  }
                }
              }
            });
          }

          // Gr√°fico de Horas por Empleado
          const ctxHoras = document.getElementById('horasEmpleadoChart');
          if (ctxHoras) {
            horasEmpleadoChart = new Chart(ctxHoras, {
              type: 'bar',
              data: {
                labels: [],
                datasets: [{
                  label: 'Horas Trabajadas',
                  data: [],
                  backgroundColor: 'rgba(102, 126, 234, 0.8)',
                  borderColor: '#667eea',
                  borderWidth: 1
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    position: 'top',
                  },
                  title: {
                    display: true,
                    text: 'Horas por Empleado'
                  }
                },
                scales: {
                  y: {
                    beginAtZero: true,
                    title: {
                      display: true,
                      text: 'Horas'
                    }
                  }
                }
              }
            });
          }

          // Actualizar datos iniciales
          actualizarGraficos();
          actualizarKPIs();
        } catch (error) {
          console.error('‚ùå Error inicializando gr√°ficos:', error);
        }
      }

      // Funci√≥n para actualizar todos los gr√°ficos
      function actualizarGraficos() {
        try {
          const a√±o = document.getElementById('chartYear').value;
          actualizarGraficoCostosMensuales(a√±o);
          actualizarGraficoDistribucionSalarios();
          actualizarGraficoHorasEmpleado();
          actualizarKPIs();
        } catch (error) {
          console.error('‚ùå Error actualizando gr√°ficos:', error);
        }
      }

      // Actualizar gr√°fico de costos mensuales
      function actualizarGraficoCostosMensuales(a√±o) {
        try {
          const nominas = JSON.parse(localStorage.getItem('axyra_nominas') || '[]');
          const costosMensuales = new Array(12).fill(0);
          
          nominas.forEach(nomina => {
            const fecha = new Date(nomina.fecha_generacion);
            if (fecha.getFullYear() == a√±o) {
              const mes = fecha.getMonth();
              costosMensuales[mes] += nomina.salario_final || 0;
            }
          });

          if (costosMensualesChart) {
            costosMensualesChart.data.datasets[0].data = costosMensuales;
            costosMensualesChart.update();
          }
        } catch (error) {
          console.error('‚ùå Error actualizando costos mensuales:', error);
        }
      }

      // Actualizar gr√°fico de distribuci√≥n salarial
      function actualizarGraficoDistribucionSalarios() {
        try {
          const empleados = JSON.parse(localStorage.getItem('axyra_empleados') || '[]');
          const rangos = [0, 0, 0, 0]; // Bajo, Medio, Alto, Ejecutivo
          
          empleados.forEach(empleado => {
            const salario = parseFloat(empleado.salario || 0);
            if (salario <= 1000000) rangos[0]++;
            else if (salario <= 2000000) rangos[1]++;
            else if (salario <= 4000000) rangos[2]++;
            else rangos[3]++;
          });

          if (distribucionSalariosChart) {
            distribucionSalariosChart.data.datasets[0].data = rangos;
            distribucionSalariosChart.update();
          }
        } catch (error) {
          console.error('‚ùå Error actualizando distribuci√≥n salarial:', error);
        }
      }

      // Actualizar gr√°fico de horas por empleado
      function actualizarGraficoHorasEmpleado() {
        try {
          const horas = JSON.parse(localStorage.getItem('axyra_horas') || '[]');
          const empleados = JSON.parse(localStorage.getItem('axyra_empleados') || '[]');
          
          // Agrupar horas por empleado
          const horasPorEmpleado = {};
          horas.forEach(h => {
            const empleado = empleados.find(emp => emp.id == h.empleadoId);
            if (empleado) {
              const nombre = empleado.nombre;
              horasPorEmpleado[nombre] = (horasPorEmpleado[nombre] || 0) + (h.total_horas || 0);
            }
          });

          const nombres = Object.keys(horasPorEmpleado).slice(0, 10); // Top 10
          const valores = nombres.map(nombre => horasPorEmpleado[nombre]);

          if (horasEmpleadoChart) {
            horasEmpleadoChart.data.labels = nombres;
            horasEmpleadoChart.data.datasets[0].data = valores;
            horasEmpleadoChart.update();
          }
        } catch (error) {
          console.error('‚ùå Error actualizando horas por empleado:', error);
        }
      }

      // Actualizar KPIs de eficiencia
      function actualizarKPIs() {
        try {
          const nominas = JSON.parse(localStorage.getItem('axyra_nominas') || '[]');
          const empleados = JSON.parse(localStorage.getItem('axyra_empleados') || '[]');
          const horas = JSON.parse(localStorage.getItem('axyra_horas') || '[]');
          
          // Calcular costo por hora
          const totalSalarios = nominas.reduce((sum, n) => sum + (n.salario_final || 0), 0);
          const totalHoras = horas.reduce((sum, h) => sum + (h.total_horas || 0), 0);
          const costoPorHora = totalHoras > 0 ? totalSalarios / totalHoras : 0;
          
          // Calcular productividad (horas trabajadas vs horas est√°ndar)
          const horasEstandar = empleados.length * 240; // 240 horas mensuales est√°ndar
          const productividad = horasEstandar > 0 ? (totalHoras / horasEstandar) * 100 : 0;
          
          // Calcular rotaci√≥n (empleados inactivos)
          const empleadosActivos = empleados.filter(emp => emp.estado === 'Activo').length;
          const rotacion = empleados.length > 0 ? ((empleados.length - empleadosActivos) / empleados.length) * 100 : 0;
          
          // Actualizar UI
          document.getElementById('costoPorHora').textContent = '$' + costoPorHora.toLocaleString(undefined, {maximumFractionDigits: 2});
          document.getElementById('productividadPromedio').textContent = productividad.toFixed(1) + '%';
          document.getElementById('rotacionPersonal').textContent = rotacion.toFixed(1) + '%';
        } catch (error) {
          console.error('‚ùå Error actualizando KPIs:', error);
        }
      }

      // Hacer funciones globales para onclick
      window.mostrarModal = mostrarModal;
      window.cerrarModal = cerrarModal;
      window.exportarNomina = exportarNomina;
      window.generarComprobantePDF = generarComprobantePDF;
      window.generarReportesNomina = generarReportesNomina;
      window.configuracionAvanzadaNomina = configuracionAvanzadaNomina;
      window.mostrarNotificacion = mostrarNotificacion;
      window.aprobarNomina = aprobarNomina;
      window.rechazarNomina = rechazarNomina;
      window.generarNominaConValidacion = generarNominaConValidacion;
      window.actualizarGraficos = actualizarGraficos;

      // Funci√≥n para mostrar modal
      function mostrarModal(modalId) {
        try {
          const modal = document.getElementById(modalId);
          if (modal) {
            modal.style.display = 'block';
            modal.classList.add('show');
          }
        } catch (error) {
          console.error('‚ùå Error mostrando modal:', error);
        }
      }

      // Funci√≥n para cerrar modal
      function cerrarModal(modalId) {
        try {
          const modal = document.getElementById(modalId);
          if (modal) {
            modal.style.display = 'none';
            modal.classList.remove('show');
          }
        } catch (error) {
          console.error('‚ùå Error cerrando modal:', error);
        }
      }

      // Funci√≥n para exportar n√≥mina a Excel usando plantilla existente
      function exportarNomina() {
        try {
          const nominas = JSON.parse(localStorage.getItem('axyra_nominas') || '[]');
          const empleados = JSON.parse(localStorage.getItem('axyra_empleados') || '[]');
          
          if (nominas.length === 0) {
            mostrarNotificacion('No hay n√≥minas para exportar', 'warning');
            return;
          }

          // Crear libro de Excel usando la plantilla
          const workbook = XLSX.utils.book_new();
          
          // Crear hoja de trabajo con los datos siguiendo la estructura de nomina.xlsx
          const datosExcel = [
            ['VILLA VENECIA - N√ìMINA DE EMPLEADOS'],
            [`Fecha de Generaci√≥n: ${new Date().toLocaleDateString()}`],
            [''], // L√≠nea en blanco
            ['ID', 'Empleado', 'C√©dula', 'Cargo', 'Departamento', 'Tipo Contrato', 'Salario Base', 'Horas Ordinarias', 'Horas Extras', 'Horas Nocturnas', 'Horas Dominicales', 'Horas Festivas', 'Total Horas', 'Valor por Hora', 'Subtotal', 'Salud (4%)', 'Pensi√≥n (4%)', 'Total Descuentos', 'Neto a Pagar']
          ];

          let totalSalarios = 0;
          let totalDescuentos = 0;
          let totalNeto = 0;

          nominas.forEach(nomina => {
            const empleado = empleados.find(emp => emp.id === nomina.empleado_id);
            if (empleado) {
              const salarioBase = nomina.salario_base || 0;
              const horasOrdinarias = nomina.horas_trabajadas || 0;
              const horasExtras = nomina.horas_extras || 0;
              const horasNocturnas = nomina.horas_nocturnas || 0;
              const horasDominicales = nomina.horas_dominicales || 0;
              const horasFestivas = nomina.horas_festivas || 0;
              const totalHoras = horasOrdinarias + horasExtras + horasNocturnas + horasDominicales + horasFestivas;
              
              const valorHora = salarioBase / 240; // 240 horas mensuales
              const subtotal = totalHoras * valorHora;
              
              // Solo empleados fijos reciben salud y pensi√≥n
              const tipoContrato = empleado.tipoContrato || 'FIJO';
              const salud = tipoContrato === 'FIJO' ? subtotal * 0.04 : 0;
              const pension = tipoContrato === 'FIJO' ? subtotal * 0.04 : 0;
              const totalDescuentosEmpleado = salud + pension;
              const netoAPagar = subtotal - totalDescuentosEmpleado;

              totalSalarios += subtotal;
              totalDescuentos += totalDescuentosEmpleado;
              totalNeto += netoAPagar;

              datosExcel.push([
                nomina.id || 'N/A',
                empleado.nombre || 'N/A',
                empleado.cedula || 'N/A',
                empleado.cargo || 'N/A',
                empleado.departamento || 'N/A',
                tipoContrato,
                salarioBase,
                horasOrdinarias,
                horasExtras,
                horasNocturnas,
                horasDominicales,
                horasFestivas,
                totalHoras,
                valorHora,
                subtotal,
                salud,
                pension,
                totalDescuentosEmpleado,
                netoAPagar
              ]);
            }
          });

          // Agregar l√≠nea en blanco y totales
          datosExcel.push(['']);
          datosExcel.push(['TOTALES', '', '', '', '', '', '', '', '', '', '', '', '', '', totalSalarios, totalDescuentos * 0.5, totalDescuentos * 0.5, totalDescuentos, totalNeto]);

          const worksheet = XLSX.utils.aoa_to_sheet(datosExcel);

          // Aplicar estilos profesionales
          worksheet['!cols'] = [
            { width: 8 },   // ID
            { width: 25 },  // Empleado
            { width: 15 },  // C√©dula
            { width: 20 },  // Cargo
            { width: 20 },  // Departamento
            { width: 15 },  // Tipo Contrato
            { width: 15 },  // Salario Base
            { width: 18 },  // Horas Ordinarias
            { width: 18 },  // Horas Extras
            { width: 18 },  // Horas Nocturnas
            { width: 18 },  // Horas Dominicales
            { width: 18 },  // Horas Festivas
            { width: 15 },  // Total Horas
            { width: 18 },  // Valor por Hora
            { width: 18 },  // Subtotal
            { width: 18 },  // Salud
            { width: 18 },  // Pensi√≥n
            { width: 18 },  // Total Descuentos
            { width: 18 }   // Neto a Pagar
          ];

          // Aplicar estilos a las celdas
          const range = XLSX.utils.decode_range(worksheet['!ref']);
          
          for (let R = range.s.r; R <= range.e.r; R++) {
            for (let C = range.s.c; C <= range.e.c; C++) {
              const cellAddress = XLSX.utils.encode_cell({ r: R, c: C });
              if (!worksheet[cellAddress]) continue;

              // Estilo para t√≠tulo principal (primera fila)
              if (R === 0) {
                worksheet[cellAddress].s = {
                  fill: { fgColor: { rgb: "4F81BD" } }, // Azul profesional
                  font: { 
                    color: { rgb: "FFFFFF" }, 
                    bold: true, 
                    sz: 16 
                  },
                  alignment: { 
                    horizontal: "center", 
                    vertical: "center" 
                  }
                };
              }
              // Estilo para fecha (segunda fila)
              else if (R === 1) {
                worksheet[cellAddress].s = {
                  font: { 
                    color: { rgb: "000000" }, 
                    bold: true, 
                    sz: 12 
                  },
                  alignment: { 
                    horizontal: "center", 
                    vertical: "center" 
                  }
                };
              }
              // Estilo para encabezados de tabla (fila 3)
              else if (R === 3) {
                worksheet[cellAddress].s = {
                  fill: { fgColor: { rgb: "D9E1F2" } }, // Azul claro
                  font: { 
                    color: { rgb: "000000" }, 
                    bold: true, 
                    sz: 11 
                  },
                  alignment: { 
                    horizontal: "center", 
                    vertical: "center" 
                  },
                  border: {
                    top: { style: "thin", color: { rgb: "000000" } },
                    bottom: { style: "thin", color: { rgb: "000000" } },
                    left: { style: "thin", color: { rgb: "000000" } },
                    right: { style: "thin", color: { rgb: "000000" } }
                  }
                };
              }
              // Estilo para fila de totales (√∫ltima fila)
              else if (R === range.e.r) {
                worksheet[cellAddress].s = {
                  fill: { fgColor: { rgb: "C6EFCE" } }, // Verde claro
                  font: { 
                    color: { rgb: "000000" }, 
                    bold: true, 
                    sz: 12 
                  },
                  alignment: { 
                    horizontal: "center", 
                    vertical: "center" 
                  },
                  border: {
                    top: { style: "medium", color: { rgb: "000000" } },
                    bottom: { style: "medium", color: { rgb: "000000" } },
                    left: { style: "thin", color: { rgb: "000000" } },
                    right: { style: "thin", color: { rgb: "000000" } }
                  }
                };
              }
              // Estilo para datos (filas intermedias)
              else if (R > 3 && R < range.e.r) {
                worksheet[cellAddress].s = {
                  fill: { fgColor: { rgb: R % 2 === 0 ? "FFFFFF" : "F8F9FA" } }, // Filas alternadas
                  font: { 
                    color: { rgb: "000000" }, 
                    sz: 10 
                  },
                  alignment: { 
                    horizontal: "center", 
                    vertical: "center" 
                  },
                  border: {
                    top: { style: "thin", color: { rgb: "D0D0D0" } },
                    bottom: { style: "thin", color: { rgb: "D0D0D0" } },
                    left: { style: "thin", color: { rgb: "D0D0D0" } },
                    right: { style: "thin", color: { rgb: "D0D0D0" } }
                  }
                };

                // Formato especial para columnas monetarias
                if (C >= 6 && C <= 18) { // Columnas de salarios y descuentos
                  worksheet[cellAddress].s.numberFormat = '"$"#,##0.00';
                }
                // Formato para horas
                else if (C >= 7 && C <= 12) { // Columnas de horas
                  worksheet[cellAddress].s.numberFormat = '#,##0.00';
                }
              }
            }
          }

          // Agregar hoja al libro
          XLSX.utils.book_append_sheet(workbook, worksheet, 'N√≥mina');

          // Generar nombre de archivo con fecha
          const fecha = new Date().toISOString().split('T')[0];
          const nombreArchivo = `N√≥mina_Villa_Venecia_${fecha}.xlsx`;

          // Descargar archivo
          XLSX.writeFile(workbook, nombreArchivo);
          
          console.log('‚úÖ N√≥mina exportada correctamente:', nombreArchivo);
          mostrarNotificacion('‚úÖ N√≥mina exportada a Excel con formato profesional y f√≥rmulas', 'success');
        } catch (error) {
          console.error('‚ùå Error exportando n√≥mina:', error);
          mostrarNotificacion('Error al exportar: ' + error.message, 'error');
        }
      }

      // Funci√≥n para generar comprobante PDF
      function generarComprobantePDF() {
        try {
          mostrarNotificacion('Funci√≥n de generaci√≥n de PDF en desarrollo', 'info');
        } catch (error) {
          console.error('‚ùå Error generando PDF:', error);
          mostrarNotificacion('Error al generar PDF: ' + error.message, 'error');
        }
      }

      // Funci√≥n para generar reportes
      function generarReportes() {
        try {
          mostrarNotificacion('Funci√≥n de reportes en desarrollo', 'info');
        } catch (error) {
          console.error('‚ùå Error generando reportes:', error);
          mostrarNotificacion('Error al generar reportes: ' + error.message, 'error');
        }
      }

      // Funci√≥n para configuraci√≥n de n√≥mina
      function configuracionNomina() {
        try {
          mostrarNotificacion('Funci√≥n de configuraci√≥n en desarrollo', 'info');
        } catch (error) {
          console.error('‚ùå Error en configuraci√≥n:', error);
          mostrarNotificacion('Error en configuraci√≥n: ' + error.message, 'error');
        }
      }

      // Funci√≥n para mostrar notificaciones
      function mostrarNotificacion(mensaje, tipo = 'info') {
        try {
          // Crear elemento de notificaci√≥n
          const notificacion = document.createElement('div');
          notificacion.className = `axyra-notificacion axyra-notificacion-${tipo}`;
          notificacion.innerHTML = `
            <div class="axyra-notificacion-icono">
              ${tipo === 'success' ? '‚úÖ' : tipo === 'error' ? '‚ùå' : tipo === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}
            </div>
            <div class="axyra-notificacion-contenido">
              <div class="axyra-notificacion-mensaje">${mensaje}</div>
            </div>
            <button class="axyra-notificacion-cerrar" onclick="this.closest('.axyra-notificacion').remove()">
              √ó
            </button>
          `;
          
          // Agregar al DOM
          document.body.appendChild(notificacion);
          
          // Auto-remover despu√©s de 5 segundos
          setTimeout(() => {
            if (notificacion.parentElement) {
              notificacion.remove();
            }
          }, 5000);
        } catch (error) {
          console.error('‚ùå Error mostrando notificaci√≥n:', error);
          // Fallback a alert
          alert(mensaje);
        }
      }

      // Hacer funciones globales para onclick
      window.mostrarModal = mostrarModal;
      window.cerrarModal = cerrarModal;
      window.exportarNomina = exportarNomina;
      window.generarComprobantePDF = generarComprobantePDF;
      window.generarReportes = generarReportes;
      window.configuracionNomina = configuracionNomina;
      window.mostrarNotificacion = mostrarNotificacion;
    </script>
  </body>
</html>

