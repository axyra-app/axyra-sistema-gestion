<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AXYRA - Configuraci√≥n</title>
    <link rel="stylesheet" href="../../static/axyra-styles.css" />
    <link rel="stylesheet" href="../../static/advanced-features.css" />
    <link rel="stylesheet" href="../../static/2fa-styles.css" />
    <link rel="stylesheet" href="../../static/responsive-styles.css" />
    <link rel="stylesheet" href="../../static/modal-fixes.css" />
    <link rel="stylesheet" href="config-styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
      import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
      import {
        getFirestore,
        doc,
        getDoc,
        collection,
        query,
        where,
        getDocs,
      } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

      // Firebase config
      const firebaseConfig = {
        apiKey: 'AIzaSyBvQvqQvqQvqQvqQvqQvqQvqQvqQvqQvqQ',
        authDomain: 'villa-venecia-nomina.firebaseapp.com',
        projectId: 'villa-venecia-nomina',
        storageBucket: 'villa-venecia-nomina.appspot.com',
        messagingSenderId: '123456789',
        appId: '1:123456789:web:abcdef123456',
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // Global auth state
      window.axyraAuth = { auth, db };

      // Check auth state with unified system
      onAuthStateChanged(auth, (user) => {
        if (user) {
          console.log('Usuario autenticado:', user.email);
          // Initialize configuration
          if (window.axyraConfig) {
            window.axyraConfig.init();
          }
        } else {
          console.log('Usuario no autenticado');
          // Use unified auth system for redirect
          if (window.axyraUnifiedAuth) {
            window.axyraUnifiedAuth.logout();
          } else {
            window.location.href = '../../login.html';
          }
        }
      });
    </script>

    <!-- Header Compartido AXYRA -->
    <script src="../../static/include-header.js"></script>

    <!-- Verificaci√≥n del Header Compartido -->
    <script src="../../static/header-verification.js"></script>

    <!-- Sistema de Roles y Permisos AXYRA -->
    <script src="../../static/roles-config.js"></script>

    <!-- Sistema de Notificaciones Push AXYRA -->
    <script src="../../static/notifications-system.js"></script>

    <!-- Sistema de Backup AXYRA -->
    <script src="../../static/backup-system.js"></script>

    <!-- Sistema 2FA AXYRA -->
    <script src="../../static/2fa-system.js"></script>

    <!-- Sistema Unificado de Autenticaci√≥n AXYRA -->
    <script src="../../static/unified-auth-system.js"></script>

    <!-- Sistema Unificado de Reportes Avanzados AXYRA -->
    <script src="../../static/advanced-reports-unified.js"></script>

    <!-- Sistema Unificado de Backup AXYRA -->
    <script src="../../static/backup-system-unified.js"></script>

    <!-- Sistema Unificado de Auditor√≠a AXYRA -->
    <script src="../../static/audit-system-unified.js"></script>
  </head>
  <body>
    <!-- Header Compartido AXYRA - Se insertar√° autom√°ticamente -->

    <!-- Main Content -->
    <main class="axyra-main-content">
      <div class="axyra-config-container">
        <h1 class="axyra-config-title">Configuraci√≥n del Sistema</h1>
        <p class="axyra-config-subtitle">Gestiona la configuraci√≥n de tu empresa y la seguridad del sistema</p>

        <!-- Seguridad y Configuraci√≥n -->
        <div class="axyra-security-section">
          <h2 class="axyra-section-title">Seguridad y Configuraci√≥n</h2>
          <div class="axyra-security-grid">
            <!-- 2FA Status -->
            <div class="axyra-security-item">
              <div class="axyra-security-icon">
                <i class="fas fa-shield-alt"></i>
              </div>
              <div class="axyra-security-content">
                <h4>Autenticaci√≥n de Dos Factores (2FA)</h4>
                <p>Protege tu cuenta con una capa adicional de seguridad</p>
                <div class="axyra-2fa-status" id="2faStatus">
                  <span class="axyra-2fa-label">Estado:</span>
                  <span class="axyra-2fa-value" id="2faStatusValue">No configurado</span>
                </div>
                <div class="axyra-security-actions">
                  <button class="axyra-btn axyra-btn-primary" onclick="setup2FA()">
                    <i class="fas fa-cog"></i> Configurar 2FA
                  </button>
                  <button class="axyra-btn axyra-btn-secondary" onclick="test2FA()">
                    <i class="fas fa-test-tube"></i> Probar
                  </button>
                </div>
              </div>
            </div>

            <!-- Session Timeout -->
            <div class="axyra-security-item">
              <div class="axyra-security-icon">
                <i class="fas fa-clock"></i>
              </div>
              <div class="axyra-security-content">
                <h4>Timeout de Sesi√≥n</h4>
                <p>Configura el tiempo de inactividad antes del cierre autom√°tico</p>
                <div class="axyra-session-info" id="sessionInfo">
                  <span class="axyra-session-label">Tiempo restante:</span>
                  <span class="axyra-session-time" id="sessionTime">--:--</span>
                </div>
                <div class="axyra-security-actions">
                  <button class="axyra-btn axyra-btn-primary" onclick="resetSessionTimeout()">
                    <i class="fas fa-refresh"></i> Renovar Sesi√≥n
                  </button>
                  <button class="axyra-btn axyra-btn-secondary" onclick="configureSessionTimeout()">
                    <i class="fas fa-cog"></i> Configurar
                  </button>
                </div>
              </div>
            </div>

            <!-- Responsive Design -->
            <div class="axyra-security-item">
              <div class="axyra-security-icon">
                <i class="fas fa-mobile-alt"></i>
              </div>
              <div class="axyra-security-content">
                <h4>Dise√±o Responsivo</h4>
                <p>Estado del sistema de adaptaci√≥n a diferentes dispositivos</p>
                <div class="axyra-responsive-info" id="responsiveInfo">
                  <span class="axyra-responsive-label">Estado:</span>
                  <span class="axyra-responsive-status" id="responsiveStatus">Activo</span>
                </div>
                <div class="axyra-security-actions">
                  <button class="axyra-btn axyra-btn-primary" onclick="testResponsive()">
                    <i class="fas fa-eye"></i> Probar Responsive
                  </button>
                  <button class="axyra-btn axyra-btn-secondary" onclick="configureResponsive()">
                    <i class="fas fa-cog"></i> Configurar
                  </button>
                </div>
              </div>
            </div>

            <!-- Backup System -->
            <div class="axyra-security-item">
              <div class="axyra-security-icon">
                <i class="fas fa-database"></i>
              </div>
              <div class="axyra-security-content">
                <h4>Sistema de Respaldo</h4>
                <p>Gestiona respaldos autom√°ticos y manuales del sistema</p>
                <div class="axyra-backup-info" id="backupInfo">
                  <span class="axyra-backup-label">√öltimo respaldo:</span>
                  <span class="axyra-backup-date" id="lastBackupDate">Nunca</span>
                </div>
                <div class="axyra-security-actions">
                  <button class="axyra-btn axyra-btn-primary" onclick="performBackup()">
                    <i class="fas fa-download"></i> Realizar Respaldo
                  </button>
                  <button class="axyra-btn axyra-btn-secondary" onclick="configureBackup()">
                    <i class="fas fa-cog"></i> Configurar
                  </button>
                </div>
              </div>
            </div>

            <!-- Notifications -->
            <div class="axyra-security-item">
              <div class="axyra-security-icon">
                <i class="fas fa-bell"></i>
              </div>
              <div class="axyra-security-content">
                <h4>Sistema de Notificaciones</h4>
                <p>Configura las notificaciones del sistema y su frecuencia</p>
                <div class="axyra-notifications-info" id="notificationsInfo">
                  <span class="axyra-notifications-label">Frecuencia:</span>
                  <span class="axyra-notifications-frequency" id="notificationsFrequency">Cada 10 min</span>
                </div>
                <div class="axyra-security-actions">
                  <button class="axyra-btn axyra-btn-primary" onclick="testNotifications()">
                    <i class="fas fa-bell"></i> Probar Notificaci√≥n
                  </button>
                  <button class="axyra-btn axyra-btn-secondary" onclick="configureNotifications()">
                    <i class="fas fa-cog"></i> Configurar
                  </button>
                </div>
              </div>
            </div>

            <!-- System Updates -->
            <div class="axyra-security-item">
              <div class="axyra-security-icon">
                <i class="fas fa-sync-alt"></i>
              </div>
              <div class="axyra-security-content">
                <h4>Actualizaciones del Sistema</h4>
                <p>Verifica y gestiona las actualizaciones disponibles</p>
                <div class="axyra-updates-info" id="updatesInfo">
                  <span class="axyra-updates-label">Versi√≥n actual:</span>
                  <span class="axyra-updates-version" id="currentVersion">1.0.0</span>
                </div>
                <div class="axyra-security-actions">
                  <button class="axyra-btn axyra-btn-primary" onclick="checkUpdates()">
                    <i class="fas fa-search"></i> Verificar Actualizaciones
                  </button>
                  <button class="axyra-btn axyra-btn-secondary" onclick="configureUpdates()">
                    <i class="fas fa-cog"></i> Configurar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Configuraci√≥n de Empresa -->
        <div class="axyra-company-section">
          <h2 class="axyra-section-title">Configuraci√≥n de Empresa</h2>
          <div class="axyra-company-form">
            <div class="axyra-form-group">
              <label for="companyName">Nombre de la Empresa</label>
              <input
                type="text"
                id="companyName"
                class="axyra-form-input"
                placeholder="Ingresa el nombre de tu empresa"
              />
            </div>
            <div class="axyra-form-group">
              <label for="companyNIT">NIT</label>
              <input type="text" id="companyNIT" class="axyra-form-input" placeholder="Ingresa el NIT de la empresa" />
            </div>
            <div class="axyra-form-group">
              <label for="companyAddress">Direcci√≥n</label>
              <input
                type="text"
                id="companyAddress"
                class="axyra-form-input"
                placeholder="Ingresa la direcci√≥n de la empresa"
              />
            </div>
            <div class="axyra-form-group">
              <label for="companyPhone">Tel√©fono</label>
              <input
                type="tel"
                id="companyPhone"
                class="axyra-form-input"
                placeholder="Ingresa el tel√©fono de la empresa"
              />
            </div>
            <div class="axyra-form-group">
              <label for="companyEmail">Email</label>
              <input
                type="email"
                id="companyEmail"
                class="axyra-form-input"
                placeholder="Ingresa el email de la empresa"
              />
            </div>
            <div class="axyra-form-actions">
              <button class="axyra-btn axyra-btn-primary" onclick="saveCompanyConfig()">
                <i class="fas fa-save"></i> Guardar Configuraci√≥n
              </button>
              <button class="axyra-btn axyra-btn-secondary" onclick="resetCompanyConfig()">
                <i class="fas fa-undo"></i> Restaurar Valores
              </button>
            </div>
          </div>
        </div>

        <!-- Configuraci√≥n del Sistema -->
        <div class="axyra-system-section">
          <h2 class="axyra-section-title">Configuraci√≥n del Sistema</h2>
          <div class="axyra-system-options">
            <div class="axyra-option-group">
              <h4>Preferencias Generales</h4>
              <div class="axyra-option-item">
                <label class="axyra-switch">
                  <input type="checkbox" id="autoSave" checked />
                  <span class="axyra-slider"></span>
                </label>
                <span class="axyra-option-label">Guardado autom√°tico</span>
              </div>
              <div class="axyra-option-item">
                <label class="axyra-switch">
                  <input type="checkbox" id="darkMode" />
                  <span class="axyra-slider"></span>
                </label>
                <span class="axyra-option-label">Modo oscuro</span>
              </div>
              <div class="axyra-option-item">
                <label class="axyra-switch">
                  <input type="checkbox" id="notifications" checked />
                  <span class="axyra-slider"></span>
                </label>
                <span class="axyra-option-label">Notificaciones push</span>
              </div>
            </div>

            <div class="axyra-option-group">
              <h4>Configuraci√≥n de Sesi√≥n</h4>
              <div class="axyra-option-item">
                <label for="sessionTimeout">Timeout de sesi√≥n (minutos)</label>
                <select id="sessionTimeout" class="axyra-form-select">
                  <option value="15">15 minutos</option>
                  <option value="30" selected>30 minutos</option>
                  <option value="60">1 hora</option>
                  <option value="120">2 horas</option>
                </select>
              </div>
              <div class="axyra-option-item">
                <label for="maxLoginAttempts">Intentos m√°ximos de login</label>
                <select id="maxLoginAttempts" class="axyra-form-select">
                  <option value="3">3 intentos</option>
                  <option value="5" selected>5 intentos</option>
                  <option value="10">10 intentos</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Scripts -->
    <script src="../../static/roles-config.js"></script>
    <script src="../../static/notifications-system.js"></script>
    <script src="../../static/session-timeout.js"></script>
    <script src="../../static/2fa-system.js"></script>
    <script src="../../static/backup-system.js"></script>

    <script src="config.js"></script>

    <!-- FUNCIONES AVANZADAS DE CONFIGURACI√ìN - IMPLEMENTACI√ìN COMPLETA -->
    <script>
      // Funci√≥n para configurar empresa completa
      function configurarEmpresaCompleta() {
        try {
          console.log('üîÑ Configurando empresa completa...');

          const configuracion = {
            empresa: {
              nombre: document.getElementById('companyName')?.value || 'VILLA VENECIA',
              nit: document.getElementById('companyNIT')?.value || '900123456-7',
              direccion: document.getElementById('companyAddress')?.value || 'Calle Principal #123',
              telefono: document.getElementById('companyPhone')?.value || '+57 300 123 4567',
              email: document.getElementById('companyEmail')?.value || 'contacto@villavenecia.com',
              logo: 'logo.png',
              industria: 'Restaurante y Eventos',
              regimen: 'Responsable de IVA',
              tipoEmpresa: 'Sociedad por Acciones Simplificada',
            },
            n√≥mina: {
              salarioMinimo: 1300000,
              porcentajeCesantias: 8.33,
              porcentajePrima: 8.33,
              porcentajeInteresesCesantias: 12,
              porcentajeSalud: 4,
              porcentajePension: 4,
              porcentajeARL: 0.522,
              porcentajeCajaCompensacion: 4,
              porcentajeICBF: 3,
              porcentajeSENA: 2,
            },
            sistema: {
              autoSave: document.getElementById('autoSave')?.checked || true,
              darkMode: document.getElementById('darkMode')?.checked || false,
              notifications: document.getElementById('notifications')?.checked || true,
              sessionTimeout: parseInt(document.getElementById('sessionTimeout')?.value || '30'),
              maxLoginAttempts: parseInt(document.getElementById('maxLoginAttempts')?.value || '5'),
              backupAutomatico: true,
              backupFrecuencia: 'DIARIO',
              backupRetencion: 30,
            },
            seguridad: {
              passwordMinLength: 8,
              requireSpecialChars: true,
              requireNumbers: true,
              requireUppercase: true,
              sessionEncryption: true,
              auditLog: true,
              ipWhitelist: [],
              allowedDomains: [],
            },
            notificaciones: {
              email: true,
              push: true,
              sms: false,
              whatsapp: false,
              frecuencia: 'INMEDIATA',
              horarioInicio: '08:00',
              horarioFin: '18:00',
            },
          };

          // Guardar configuraci√≥n
          localStorage.setItem('axyra_configuracion_completa', JSON.stringify(configuracion));

          // Aplicar configuraci√≥n al sistema
          aplicarConfiguracionSistema(configuracion);

          console.log('‚úÖ Configuraci√≥n de empresa completada:', configuracion);
          mostrarNotificacion('‚úÖ Configuraci√≥n de empresa guardada correctamente', 'success');
        } catch (error) {
          console.error('‚ùå Error configurando empresa:', error);
          mostrarNotificacion('‚ùå Error: ' + error.message, 'error');
        }
      }

      // Funci√≥n para aplicar configuraci√≥n al sistema
      function aplicarConfiguracionSistema(configuracion) {
        try {
          console.log('üîÑ Aplicando configuraci√≥n al sistema...');

          // Aplicar configuraci√≥n de sesi√≥n
          if (window.axyraSessionTimeout) {
            window.axyraSessionTimeout.setTimeout(configuracion.sistema.sessionTimeout * 60 * 1000);
          }

          // Aplicar configuraci√≥n de notificaciones
          if (window.axyraNotificationSystem) {
            window.axyraNotificationSystem.updateConfig(configuracion.notificaciones);
          }

          // Aplicar configuraci√≥n de seguridad
          if (window.axyraRolesConfig) {
            window.axyraRolesConfig.updateSecurityConfig(configuracion.seguridad);
          }

          // Aplicar modo oscuro
          if (configuracion.sistema.darkMode) {
            document.body.classList.add('axyra-dark-mode');
          } else {
            document.body.classList.remove('axyra-dark-mode');
          }

          // Aplicar configuraci√≥n de backup
          if (window.axyraBackupSystem) {
            window.axyraBackupSystem.updateConfig(configuracion.sistema);
          }

          console.log('‚úÖ Configuraci√≥n aplicada al sistema correctamente');
        } catch (error) {
          console.error('‚ùå Error aplicando configuraci√≥n:', error);
        }
      }

      // Funci√≥n para gesti√≥n completa de usuarios y roles
      function gestionarUsuariosCompleta() {
        try {
          console.log('üîÑ Abriendo gesti√≥n completa de usuarios...');

          // Obtener usuarios del sistema
          const usuarios = JSON.parse(localStorage.getItem('axyra_usuarios') || '[]');
          const roles = JSON.parse(localStorage.getItem('axyra_roles') || '[]');

          // Mostrar modal de gesti√≥n
          mostrarModalGestionUsuarios(usuarios, roles);
        } catch (error) {
          console.error('‚ùå Error abriendo gesti√≥n de usuarios:', error);
          mostrarNotificacion('‚ùå Error: ' + error.message, 'error');
        }
      }

      // Funci√≥n para mostrar modal de gesti√≥n de usuarios
      function mostrarModalGestionUsuarios(usuarios, roles) {
        const modalHTML = `
          <div class="axyra-modal-overlay" id="modalGestionUsuarios">
            <div class="axyra-modal axyra-modal-large">
              <div class="axyra-modal-header">
                <h3>Gesti√≥n Completa de Usuarios y Roles</h3>
                <button onclick="cerrarModalGestionUsuarios()" class="axyra-modal-close">&times;</button>
              </div>
              <div class="axyra-modal-content">
                <div class="axyra-tabs">
                  <button class="axyra-tab-button active" onclick="cambiarTab('usuarios')">Usuarios</button>
                  <button class="axyra-tab-button" onclick="cambiarTab('roles')">Roles</button>
                  <button class="axyra-tab-button" onclick="cambiarTab('permisos')">Permisos</button>
                </div>
                
                <div id="tabUsuarios" class="axyra-tab-content active">
                  <div class="axyra-users-list">
                    ${usuarios
                      .map(
                        (usuario) => `
                      <div class="axyra-user-item">
                        <div class="axyra-user-info">
                          <h4>${usuario.nombre || usuario.email}</h4>
                          <span class="axyra-user-role">${usuario.rol || 'Sin rol'}</span>
                          <span class="axyra-user-status ${usuario.activo ? 'activo' : 'inactivo'}">
                            ${usuario.activo ? 'Activo' : 'Inactivo'}
                          </span>
                        </div>
                        <div class="axyra-user-actions">
                          <button onclick="editarUsuario('${
                            usuario.id
                          }')" class="axyra-btn axyra-btn-sm axyra-btn-primary">
                            <i class="fas fa-edit"></i>
                          </button>
                          <button onclick="cambiarEstadoUsuario('${
                            usuario.id
                          }')" class="axyra-btn axyra-btn-sm axyra-btn-${usuario.activo ? 'warning' : 'success'}">
                            <i class="fas fa-${usuario.activo ? 'pause' : 'play'}"></i>
                          </button>
                        </div>
                      </div>
                    `
                      )
                      .join('')}
                  </div>
                  <button onclick="agregarNuevoUsuario()" class="axyra-btn axyra-btn-success">
                    <i class="fas fa-plus"></i> Agregar Usuario
                  </button>
                </div>
                
                <div id="tabRoles" class="axyra-tab-content">
                  <div class="axyra-roles-list">
                    ${roles
                      .map(
                        (rol) => `
                      <div class="axyra-role-item">
                        <div class="axyra-role-info">
                          <h4>${rol.nombre}</h4>
                          <p>${rol.descripcion || 'Sin descripci√≥n'}</p>
                          <span class="axyra-role-users">${rol.usuarios || 0} usuarios</span>
                        </div>
                        <div class="axyra-role-actions">
                          <button onclick="editarRol('${rol.id}')" class="axyra-btn axyra-btn-sm axyra-btn-primary">
                            <i class="fas fa-edit"></i>
                          </button>
                          <button onclick="eliminarRol('${rol.id}')" class="axyra-btn axyra-btn-sm axyra-btn-danger">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </div>
                    `
                      )
                      .join('')}
                  </div>
                  <button onclick="agregarNuevoRol()" class="axyra-btn axyra-btn-success">
                    <i class="fas fa-plus"></i> Agregar Rol
                  </button>
                </div>
                
                <div id="tabPermisos" class="axyra-tab-content">
                  <div class="axyra-permissions-grid">
                    <div class="axyra-permission-section">
                      <h4>M√≥dulos del Sistema</h4>
                      <div class="axyra-permission-item">
                        <span>Dashboard</span>
                        <label class="axyra-switch">
                          <input type="checkbox" checked disabled />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                      <div class="axyra-permission-item">
                        <span>Empleados</span>
                        <label class="axyra-switch">
                          <input type="checkbox" checked />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                      <div class="axyra-permission-item">
                        <span>Horas</span>
                        <label class="axyra-switch">
                          <input type="checkbox" checked />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                      <div class="axyra-permission-item">
                        <span>N√≥mina</span>
                        <label class="axyra-switch">
                          <input type="checkbox" />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                      <div class="axyra-permission-item">
                        <span>Cuadre de Caja</span>
                        <label class="axyra-switch">
                          <input type="checkbox" />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                      <div class="axyra-permission-item">
                        <span>Inventario</span>
                        <label class="axyra-switch">
                          <input type="checkbox" />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                      <div class="axyra-permission-item">
                        <span>Configuraci√≥n</span>
                        <label class="axyra-switch">
                          <input type="checkbox" />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="axyra-modal-footer">
                <button onclick="guardarCambiosUsuarios()" class="axyra-btn axyra-btn-primary">
                  <i class="fas fa-save"></i> Guardar Cambios
                </button>
                <button onclick="cerrarModalGestionUsuarios()" class="axyra-btn axyra-btn-secondary">
                  Cerrar
                </button>
              </div>
            </div>
          </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHTML);
      }

      // Funci√≥n para cambiar tabs
      function cambiarTab(tabName) {
        // Ocultar todos los tabs
        document.querySelectorAll('.axyra-tab-content').forEach((tab) => {
          tab.classList.remove('active');
        });
        document.querySelectorAll('.axyra-tab-button').forEach((button) => {
          button.classList.remove('active');
        });

        // Mostrar tab seleccionado
        document.getElementById('tab' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.add('active');
        event.target.classList.add('active');
      }

      // Funci√≥n para cerrar modal de gesti√≥n de usuarios
      function cerrarModalGestionUsuarios() {
        const modal = document.getElementById('modalGestionUsuarios');
        if (modal) {
          modal.remove();
        }
      }

      // Funci√≥n para sistema de backup completo
      function sistemaBackupCompleto() {
        try {
          console.log('üîÑ Iniciando sistema de backup completo...');

          if (window.axyraBackupSystem) {
            window.axyraBackupSystem.createBackup();
          } else {
            // Backup manual si no est√° disponible el sistema
            crearBackupManual();
          }
        } catch (error) {
          console.error('‚ùå Error en sistema de backup:', error);
          mostrarNotificacion('‚ùå Error: ' + error.message, 'error');
        }
      }

      // Funci√≥n para crear backup manual
      function crearBackupManual() {
        try {
          console.log('üîÑ Creando backup manual...');

          const backup = {
            fecha: new Date().toISOString(),
            version: '1.0.0',
            datos: {
              empleados: JSON.parse(localStorage.getItem('axyra_empleados') || '[]'),
              horas: JSON.parse(localStorage.getItem('axyra_horas') || '[]'),
              nominas: JSON.parse(localStorage.getItem('axyra_nominas') || '[]'),
              facturas: JSON.parse(localStorage.getItem('axyra_facturas') || '[]'),
              inventario: JSON.parse(localStorage.getItem('axyra_inventario') || '[]'),
              configuracion: JSON.parse(localStorage.getItem('axyra_configuracion_completa') || '{}'),
            },
            metadata: {
              totalRegistros: 0,
              tama√±oAproximado: 0,
            },
          };

          // Calcular metadata
          Object.values(backup.datos).forEach((datos) => {
            if (Array.isArray(datos)) {
              backup.metadata.totalRegistros += datos.length;
            }
          });

          backup.metadata.tama√±oAproximado = JSON.stringify(backup).length;

          // Guardar backup
          const backups = JSON.parse(localStorage.getItem('axyra_backups') || '[]');
          backups.push(backup);
          localStorage.setItem('axyra_backups', JSON.stringify(backups));

          // Descargar backup
          const dataStr = JSON.stringify(backup, null, 2);
          const dataBlob = new Blob([dataStr], { type: 'application/json' });
          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `AXYRA_Backup_${new Date().toISOString().split('T')[0]}.json`;
          link.click();
          URL.revokeObjectURL(url);

          console.log('‚úÖ Backup manual creado:', backup);
          mostrarNotificacion('‚úÖ Backup manual creado correctamente', 'success');
        } catch (error) {
          console.error('‚ùå Error creando backup manual:', error);
          mostrarNotificacion('‚ùå Error: ' + error.message, 'error');
        }
      }

      // Funci√≥n para restaurar backup
      function restaurarBackup() {
        try {
          console.log('üîÑ Restaurando backup...');

          const input = document.createElement('input');
          input.type = 'file';
          input.accept = '.json';

          input.onchange = function (e) {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = function (e) {
                try {
                  const backup = JSON.parse(e.target.result);

                  // Validar backup
                  if (!backup.datos || !backup.fecha) {
                    throw new Error('Archivo de backup inv√°lido');
                  }

                  // Restaurar datos
                  Object.entries(backup.datos).forEach(([key, value]) => {
                    localStorage.setItem('axyra_' + key, JSON.stringify(value));
                  });

                  console.log('‚úÖ Backup restaurado correctamente:', backup);
                  mostrarNotificacion('‚úÖ Backup restaurado correctamente', 'success');

                  // Recargar p√°gina para aplicar cambios
                  setTimeout(() => {
                    window.location.reload();
                  }, 2000);
                } catch (error) {
                  console.error('‚ùå Error restaurando backup:', error);
                  mostrarNotificacion('‚ùå Error: ' + error.message, 'error');
                }
              };
              reader.readAsText(file);
            }
          };

          input.click();
        } catch (error) {
          console.error('‚ùå Error restaurando backup:', error);
          mostrarNotificacion('‚ùå Error: ' + error.message, 'error');
        }
      }

      // Funci√≥n para configuraci√≥n de √°reas de trabajo
      function configurarAreasTrabajo() {
        try {
          console.log('üîÑ Configurando √°reas de trabajo...');

          if (window.axyraWorkAreasConfig) {
            window.axyraWorkAreasConfig.openConfiguration();
          } else {
            // Configuraci√≥n manual si no est√° disponible
            mostrarModalAreasTrabajo();
          }
        } catch (error) {
          console.error('‚ùå Error configurando √°reas de trabajo:', error);
          mostrarNotificacion('‚ùå Error: ' + error.message, 'error');
        }
      }

      // Funci√≥n para mostrar modal de √°reas de trabajo
      function mostrarModalAreasTrabajo() {
        const modalHTML = `
          <div class="axyra-modal-overlay" id="modalAreasTrabajo">
            <div class="axyra-modal">
              <div class="axyra-modal-header">
                <h3>Configuraci√≥n de √Åreas de Trabajo</h3>
                <button onclick="cerrarModalAreasTrabajo()" class="axyra-modal-close">&times;</button>
              </div>
              <div class="axyra-modal-content">
                <div class="axyra-areas-list">
                  <div class="axyra-area-item">
                    <h4>Cocina</h4>
                    <p>√Årea principal de preparaci√≥n de alimentos</p>
                    <div class="axyra-area-config">
                      <label>Capacidad m√°xima:</label>
                      <input type="number" value="15" min="1" max="50" />
                      <label>Horario:</label>
                      <select>
                        <option>6:00 AM - 10:00 PM</option>
                        <option>24/7</option>
                        <option>Personalizado</option>
                      </select>
                    </div>
                  </div>
                  
                  <div class="axyra-area-item">
                    <h4>Sal√≥n Principal</h4>
                    <p>√Årea de eventos y restaurante</p>
                    <div class="axyra-area-config">
                      <label>Capacidad m√°xima:</label>
                      <input type="number" value="200" min="1" max="1000" />
                      <label>Horario:</label>
                      <select>
                        <option>11:00 AM - 11:00 PM</option>
                        <option>24/7</option>
                        <option>Personalizado</option>
                      </select>
                    </div>
                  </div>
                  
                  <div class="axyra-area-item">
                    <h4>Bar</h4>
                    <p>√Årea de bebidas y cocteler√≠a</p>
                    <div class="axyra-area-config">
                      <label>Capacidad m√°xima:</label>
                      <input type="number" value="50" min="1" max="200" />
                      <label>Horario:</label>
                      <select>
                        <option>5:00 PM - 2:00 AM</option>
                        <option>24/7</option>
                        <option>Personalizado</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              <div class="axyra-modal-footer">
                <button onclick="guardarAreasTrabajo()" class="axyra-btn axyra-btn-primary">
                  <i class="fas fa-save"></i> Guardar Configuraci√≥n
                </button>
                <button onclick="cerrarModalAreasTrabajo()" class="axyra-btn axyra-btn-secondary">
                  Cerrar
                </button>
              </div>
            </div>
          </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHTML);
      }

      // Funci√≥n para cerrar modal de √°reas de trabajo
      function cerrarModalAreasTrabajo() {
        const modal = document.getElementById('modalAreasTrabajo');
        if (modal) {
          modal.remove();
        }
      }

      // Funci√≥n para guardar √°reas de trabajo
      function guardarAreasTrabajo() {
        try {
          // Implementar guardado de √°reas de trabajo
          mostrarNotificacion('‚úÖ Configuraci√≥n de √°reas de trabajo guardada', 'success');
          cerrarModalAreasTrabajo();
        } catch (error) {
          console.error('‚ùå Error guardando √°reas de trabajo:', error);
        }
      }

      // Agregar funciones al scope global
      window.configurarEmpresaCompleta = configurarEmpresaCompleta;
      window.gestionarUsuariosCompleta = gestionarUsuariosCompleta;
      window.sistemaBackupCompleto = sistemaBackupCompleto;
      window.restaurarBackup = restaurarBackup;
      window.configurarAreasTrabajo = configurarAreasTrabajo;
      window.cambiarTab = cambiarTab;
      window.cerrarModalGestionUsuarios = cerrarModalGestionUsuarios;
      window.cerrarModalAreasTrabajo = cerrarModalAreasTrabajo;
      window.guardarAreasTrabajo = guardarAreasTrabajo;
    </script>
  </body>
</html>
