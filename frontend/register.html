<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AXYRA - Crear Cuenta</title>
    <link rel="icon" href="nomina.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Firebase Config -->
    <script src="static/firebase-config.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .register-container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        padding: 40px;
        width: 100%;
        max-width: 500px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .register-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      }

      .logo {
        margin-bottom: 30px;
      }

      .logo img {
        width: 60px;
        height: 60px;
        margin-bottom: 15px;
      }

      .logo h1 {
        color: #2d3748;
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .logo p {
        color: #718096;
        font-size: 14px;
      }

      .form-group {
        margin-bottom: 20px;
        text-align: left;
      }

      .form-label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: #4a5568;
        margin-bottom: 8px;
      }

      .form-input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
        box-sizing: border-box;
      }

      .form-input:focus {
        outline: none;
        border-color: #667eea;
      }

      .form-input.error {
        border-color: #e53e3e;
      }

      .form-input.success {
        border-color: #38a169;
      }

      .password-container {
        position: relative;
        display: flex;
        align-items: center;
      }

      .password-toggle {
        position: absolute;
        right: 12px;
        background: none;
        border: none;
        cursor: pointer;
        color: #718096;
        font-size: 16px;
        padding: 5px;
        transition: color 0.3s ease;
      }

      .password-toggle:hover {
        color: #667eea;
      }

      .form-hint {
        font-size: 12px;
        color: #718096;
        margin-top: 5px;
      }

      .form-hint.error {
        color: #e53e3e;
      }

      .form-hint.success {
        color: #38a169;
      }

      .checkbox-group {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        margin-bottom: 20px;
        text-align: left;
      }

      .checkbox-group input[type='checkbox'] {
        width: 18px;
        height: 18px;
        accent-color: #667eea;
        margin-top: 2px;
      }

      .checkbox-group label {
        font-size: 14px;
        color: #4a5568;
        cursor: pointer;
        line-height: 1.4;
      }

      .checkbox-group a {
        color: #667eea;
        text-decoration: none;
      }

      .checkbox-group a:hover {
        text-decoration: underline;
      }

      .btn {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.3s ease;
        margin-bottom: 20px;
      }

      .btn:hover {
        transform: translateY(-2px);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .btn-google {
        background: #4285f4;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .divider {
        display: flex;
        align-items: center;
        margin: 20px 0;
        color: #718096;
        font-size: 14px;
      }

      .divider::before,
      .divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background: #e2e8f0;
      }

      .divider span {
        padding: 0 15px;
      }

      .links {
        text-align: center;
        margin-top: 20px;
      }

      .links a {
        color: #667eea;
        text-decoration: none;
        font-size: 14px;
        margin: 0 10px;
      }

      .links a:hover {
        text-decoration: underline;
      }

      .error-message {
        background: #fed7d7;
        color: #c53030;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
      }

      .success-message {
        background: #c6f6d5;
        color: #2f855a;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
      }

      .password-strength {
        margin-top: 5px;
        font-size: 12px;
      }

      .strength-bar {
        height: 4px;
        background: #e2e8f0;
        border-radius: 2px;
        margin-top: 5px;
        overflow: hidden;
      }

      .strength-fill {
        height: 100%;
        transition: width 0.3s ease;
        border-radius: 2px;
      }

      .strength-weak {
        background: #e53e3e;
        width: 25%;
      }
      .strength-fair {
        background: #dd6b20;
        width: 50%;
      }
      .strength-good {
        background: #d69e2e;
        width: 75%;
      }
      .strength-strong {
        background: #38a169;
        width: 100%;
      }

      @media (max-width: 480px) {
        .register-container {
          padding: 30px 20px;
          margin: 10px;
        }
      }
    </style>
  </head>

  <body>
    <div class="register-container">
      <div class="logo">
        <img src="logo.png" alt="AXYRA" />
        <h1>AXYRA</h1>
        <p>Únete al sistema de gestión empresarial más profesional y confiable del mercado</p>
      </div>

      <div class="error-message" id="errorMessage"></div>
      <div class="success-message" id="successMessage"></div>

      <form id="registerForm">
        <div class="form-group">
          <label for="fullName" class="form-label">Nombre Completo</label>
          <input
            type="text"
            id="fullName"
            name="fullName"
            class="form-input"
            placeholder="Ingresa tu nombre completo"
            required
          />
          <div class="form-hint">Mínimo 3 caracteres, solo letras y espacios</div>
        </div>

        <div class="form-group">
          <label for="username" class="form-label">Nombre de Usuario</label>
          <input
            type="text"
            id="username"
            name="username"
            class="form-input"
            placeholder="Elige un nombre de usuario"
            required
          />
          <div class="form-hint">Mínimo 3 caracteres, solo letras y números</div>
        </div>

        <div class="form-group">
          <label for="email" class="form-label">Correo Electrónico</label>
          <input type="email" id="email" name="email" class="form-input" placeholder="tu@email.com" required />
          <div class="form-hint">Se enviará un código de verificación a este correo</div>
        </div>

        <div class="form-group">
          <label for="password" class="form-label">Contraseña</label>
          <div class="password-container">
            <input type="password" id="password" name="password" class="form-input" placeholder="Contraseña" required />
            <button type="button" class="password-toggle" onclick="togglePassword()">
              <i class="fas fa-eye" id="passwordToggleIcon"></i>
            </button>
          </div>
          <div class="password-strength">
            <div class="strength-bar">
              <div class="strength-fill" id="strengthBar"></div>
            </div>
            <span id="strengthText">Ingresa una contraseña</span>
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword" class="form-label">Confirmar Contraseña</label>
          <div class="password-container">
            <input
              type="password"
              id="confirmPassword"
              name="confirmPassword"
              class="form-input"
              placeholder="Confirma tu contraseña"
              required
            />
            <button type="button" class="password-toggle" onclick="toggleConfirmPassword()">
              <i class="fas fa-eye" id="confirmPasswordToggleIcon"></i>
            </button>
          </div>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="terms" name="terms" required />
          <label for="terms">
            Acepto los <a href="#" onclick="showTerms()">términos y condiciones</a> y la
            <a href="#" onclick="showPrivacy()">política de privacidad</a>
          </label>
        </div>

        <button type="submit" class="btn" id="registerBtn">
          <i class="fas fa-user-plus"></i>
          Crear Cuenta
        </button>

        <div class="divider">
          <span>o</span>
        </div>

        <button type="button" class="btn btn-google" onclick="registerWithGoogle()">
          <i class="fab fa-google"></i>
          Continuar con Google
        </button>
      </form>

      <div class="links">
        <a href="login.html">¿Ya tienes cuenta? Inicia sesión</a>
      </div>
    </div>

    <script>
      // Variables globales
      let isPasswordVisible = false;
      let isConfirmPasswordVisible = false;

      // Función para alternar visibilidad de contraseña
      function togglePassword() {
        const passwordInput = document.getElementById('password');
        const toggleIcon = document.getElementById('passwordToggleIcon');

        if (isPasswordVisible) {
          passwordInput.type = 'password';
          toggleIcon.className = 'fas fa-eye';
          isPasswordVisible = false;
        } else {
          passwordInput.type = 'text';
          toggleIcon.className = 'fas fa-eye-slash';
          isPasswordVisible = true;
        }
      }

      // Función para alternar visibilidad de confirmar contraseña
      function toggleConfirmPassword() {
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const toggleIcon = document.getElementById('confirmPasswordToggleIcon');

        if (isConfirmPasswordVisible) {
          confirmPasswordInput.type = 'password';
          toggleIcon.className = 'fas fa-eye';
          isConfirmPasswordVisible = false;
        } else {
          confirmPasswordInput.type = 'text';
          toggleIcon.className = 'fas fa-eye-slash';
          isConfirmPasswordVisible = true;
        }
      }

      // Función para mostrar mensajes
      function showMessage(message, type = 'error') {
        const errorDiv = document.getElementById('errorMessage');
        const successDiv = document.getElementById('successMessage');

        if (type === 'error') {
          errorDiv.textContent = message;
          errorDiv.style.display = 'block';
          successDiv.style.display = 'none';
        } else {
          successDiv.textContent = message;
          successDiv.style.display = 'block';
          errorDiv.style.display = 'none';
        }

        setTimeout(() => {
          errorDiv.style.display = 'none';
          successDiv.style.display = 'none';
        }, 5000);
      }

      // Función para validar contraseña
      function validatePassword(password) {
        const minLength = password.length >= 8;
        const hasUpperCase = /[A-Z]/.test(password);
        const hasLowerCase = /[a-z]/.test(password);
        const hasNumbers = /\d/.test(password);
        const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);

        let strength = 0;
        if (minLength) strength++;
        if (hasUpperCase) strength++;
        if (hasLowerCase) strength++;
        if (hasNumbers) strength++;
        if (hasSpecialChar) strength++;

        return { strength, minLength, hasUpperCase, hasLowerCase, hasNumbers, hasSpecialChar };
      }

      // Función para actualizar indicador de fortaleza de contraseña
      function updatePasswordStrength() {
        const password = document.getElementById('password').value;
        const strengthBar = document.getElementById('strengthBar');
        const strengthText = document.getElementById('strengthText');

        if (password.length === 0) {
          strengthBar.className = 'strength-fill';
          strengthText.textContent = 'Ingresa una contraseña';
          return;
        }

        const validation = validatePassword(password);
        const strength = validation.strength;

        strengthBar.className = 'strength-fill';
        if (strength <= 1) {
          strengthBar.classList.add('strength-weak');
          strengthText.textContent = 'Muy débil';
        } else if (strength <= 2) {
          strengthBar.classList.add('strength-fair');
          strengthText.textContent = 'Débil';
        } else if (strength <= 3) {
          strengthBar.classList.add('strength-good');
          strengthText.textContent = 'Buena';
        } else {
          strengthBar.classList.add('strength-strong');
          strengthText.textContent = 'Muy fuerte';
        }
      }

      // Función para validar formulario
      function validateForm() {
        const fullName = document.getElementById('fullName').value.trim();
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const terms = document.getElementById('terms').checked;

        // Validar nombre completo
        if (fullName.length < 3 || !/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/.test(fullName)) {
          showMessage('El nombre debe tener al menos 3 caracteres y solo contener letras y espacios', 'error');
          return false;
        }

        // Validar nombre de usuario
        if (username.length < 3 || !/^[a-zA-Z0-9]+$/.test(username)) {
          showMessage(
            'El nombre de usuario debe tener al menos 3 caracteres y solo contener letras y números',
            'error'
          );
          return false;
        }

        // Validar email
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          showMessage('Por favor ingresa un correo electrónico válido', 'error');
          return false;
        }

        // Validar contraseña
        const passwordValidation = validatePassword(password);
        if (passwordValidation.strength < 3) {
          showMessage(
            'La contraseña debe ser más fuerte. Incluye mayúsculas, minúsculas, números y caracteres especiales',
            'error'
          );
          return false;
        }

        // Validar confirmación de contraseña
        if (password !== confirmPassword) {
          showMessage('Las contraseñas no coinciden', 'error');
          return false;
        }

        // Validar términos y condiciones
        if (!terms) {
          showMessage('Debes aceptar los términos y condiciones', 'error');
          return false;
        }

        return true;
      }

      // Función para registro con Google
      async function registerWithGoogle() {
        try {
          if (typeof firebase === 'undefined') {
            showMessage('Firebase no está disponible. Recarga la página.', 'error');
            return;
          }

          const provider = new firebase.auth.GoogleAuthProvider();
          const result = await firebase.auth().signInWithPopup(provider);

          showMessage('¡Registro exitoso!', 'success');
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 1500);
        } catch (error) {
          console.error('Error en registro con Google:', error);
          showMessage('Error al registrarse con Google: ' + error.message, 'error');
        }
      }

      // Función para mostrar términos y condiciones
      function showTerms() {
        alert('Términos y Condiciones\n\nAl usar AXYRA, aceptas nuestros términos de servicio...');
      }

      // Función para mostrar política de privacidad
      function showPrivacy() {
        alert('Política de Privacidad\n\nRespetamos tu privacidad y protegemos tus datos...');
      }

      // Función principal de registro
      async function handleRegister(event) {
        event.preventDefault();

        if (!validateForm()) {
          return;
        }

        const fullName = document.getElementById('fullName').value.trim();
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const registerBtn = document.getElementById('registerBtn');

        registerBtn.disabled = true;
        registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creando cuenta...';

        try {
          if (typeof firebase === 'undefined') {
            showMessage('Firebase no está disponible. Recarga la página.', 'error');
            return;
          }

          // Crear usuario
          const result = await firebase.auth().createUserWithEmailAndPassword(email, password);

          // Actualizar perfil
          await result.user.updateProfile({
            displayName: fullName,
          });

          // Guardar información adicional en Firestore
          if (window.axyraFirebase && window.axyraFirebase.firestore) {
            await window.axyraFirebase.firestore.collection('users').doc(result.user.uid).set({
              uid: result.user.uid,
              email: email,
              displayName: fullName,
              username: username,
              role: 'user',
              isActive: true,
              createdAt: firebase.firestore.FieldValue.serverTimestamp(),
              lastLogin: null,
            });
          }

          showMessage('¡Cuenta creada exitosamente!', 'success');

          // Redirigir después de un breve delay
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 1500);
        } catch (error) {
          console.error('Error en registro:', error);

          let errorMessage = 'Error al crear la cuenta';

          switch (error.code) {
            case 'auth/email-already-in-use':
              errorMessage = 'Ya existe una cuenta con este correo electrónico';
              break;
            case 'auth/invalid-email':
              errorMessage = 'Correo electrónico inválido';
              break;
            case 'auth/weak-password':
              errorMessage = 'La contraseña es muy débil';
              break;
            case 'auth/operation-not-allowed':
              errorMessage = 'El registro con email y contraseña no está habilitado';
              break;
            default:
              errorMessage = error.message;
          }

          showMessage(errorMessage, 'error');
        } finally {
          registerBtn.disabled = false;
          registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> Crear Cuenta';
        }
      }

      // Event listeners
      document.getElementById('registerForm').addEventListener('submit', handleRegister);
      document.getElementById('password').addEventListener('input', updatePasswordStrength);

      // Verificar si ya está autenticado
      document.addEventListener('DOMContentLoaded', function () {
        if (typeof firebase !== 'undefined' && firebase.auth) {
          firebase.auth().onAuthStateChanged((user) => {
            if (user) {
              // Usuario ya autenticado, redirigir
              window.location.href = 'index.html';
            }
          });
        }
      });
    </script>
  </body>
</html>
