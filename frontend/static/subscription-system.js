class AxyraSubscriptionSystem{constructor(){this.plans ={basico:{nombre:'B√°sico',precio:59900,limiteEmpleados:5,caracteristicas:[ 'Hasta 5 empleados','Gesti√≥n b√°sica de n√≥mina','Inventario simple','Reportes b√°sicos','Soporte por email','5GB de almacenamiento' ],funciones:{empleados:{max:5,features:['view','create','edit']},nomina:{max:5,features:['view','create']},inventario:{features:['view','create']},reportes:{features:['view','basic']},cuadreCaja:false,chatIA:false,multiplesSucursales:false,apiPersonalizada:false,reportesPersonalizados:false}},profesional:{nombre:'Profesional',precio:99900,limiteEmpleados:25,caracteristicas:[ 'Hasta 25 empleados','Gesti√≥n completa de n√≥mina','Inventario avanzado','Cuadre de caja','Reportes avanzados','Chat de IA incluido','Soporte prioritario','50GB de almacenamiento','Integraci√≥n con bancos' ],funciones:{empleados:{max:25,features:['view','create','edit','delete']},nomina:{max:25,features:['view','create','edit','delete','advanced']},inventario:{features:['view','create','edit','delete','advanced']},reportes:{features:['view','create','advanced','export']},cuadreCaja:true,chatIA:true,multiplesSucursales:false,apiPersonalizada:false,reportesPersonalizados:false}},empresarial:{nombre:'Empresarial',precio:159900,limiteEmpleados:-1,caracteristicas:[ 'Empleados ilimitados','Todas las funciones','M√∫ltiples sucursales','API personalizada','Reportes personalizados','Soporte 24/7','Almacenamiento ilimitado','Integraciones avanzadas','Capacitaci√≥n incluida' ],funciones:{empleados:{max:-1,features:['view','create','edit','delete','advanced']},nomina:{max:-1,features:['view','create','edit','delete','advanced','custom']},inventario:{features:['view','create','edit','delete','advanced','custom']},reportes:{features:['view','create','advanced','export','custom','scheduled']},cuadreCaja:true,chatIA:true,multiplesSucursales:true,apiPersonalizada:true,reportesPersonalizados:true}}};this.currentUser = null;this.currentSubscription = null;this.trialDays = 7;this.init();}init(){console.log('üí≥ Inicializando Sistema de Suscripciones AXYRA...');this.loadUserSubscription();this.setupEventListeners();}setupEventListeners(){document.addEventListener('userAuthenticated',(e)=>{this.currentUser = e.detail.user;this.loadUserSubscription();});document.addEventListener('userLogout',()=>{this.currentUser = null;this.currentSubscription = null;});}loadUserSubscription(){try{const user = this.getCurrentUser();if(!user)return;const subscription = localStorage.getItem(`axyra_subscription_${user.uid}`);if(subscription){this.currentSubscription = JSON.parse(subscription);console.log('‚úÖ Suscripci√≥n cargada:',this.currentSubscription);}else{this.currentSubscription ={plan:'gratuito',estado:'activo',fechaInicio:new Date().toISOString(),fechaFin:null,trial:true,diasRestantes:this.trialDays};this.saveUserSubscription();}this.updateUI();}catch(error){console.error('‚ùå Error cargando suscripci√≥n:',error);}}saveUserSubscription(){try{const user = this.getCurrentUser();if(user && this.currentSubscription){localStorage.setItem(`axyra_subscription_${user.uid}`,JSON.stringify(this.currentSubscription));}}catch(error){console.error('‚ùå Error guardando suscripci√≥n:',error);}}getCurrentUser(){try{const user = localStorage.getItem('axyra_user');return user ? JSON.parse(user):null;}catch(error){return null;}}canAccessFeature(feature,action = 'view'){if(!this.currentSubscription)return false;const plan = this.plans[this.currentSubscription.plan];if(!plan)return false;if(!this.isSubscriptionActive()){this.showUpgradeModal('Tu suscripci√≥n ha expirado');return false;}if(plan.funciones[feature]){const featureConfig = plan.funciones[feature];if(typeof featureConfig === 'boolean'){return featureConfig;}if(featureConfig.features){return featureConfig.features.includes(action);}}return false;}canAddEmployee(){if(!this.currentSubscription)return false;const plan = this.plans[this.currentSubscription.plan];if(!plan)return false;if(plan.limiteEmpleados === -1)return true;const empleados = JSON.parse(localStorage.getItem('axyra_empleados')|| '[]');return empleados.length < plan.limiteEmpleados;}isSubscriptionActive(){if(!this.currentSubscription)return false;if(this.currentSubscription.trial){const diasTranscurridos = this.getDaysSinceStart();return diasTranscurridos <= this.trialDays;}if(this.currentSubscription.fechaFin){return new Date()<= new Date(this.currentSubscription.fechaFin);}return this.currentSubscription.estado === 'activo';}getDaysSinceStart(){if(!this.currentSubscription || !this.currentSubscription.fechaInicio)return 0;const inicio = new Date(this.currentSubscription.fechaInicio);const ahora = new Date();const diffTime = Math.abs(ahora - inicio);return Math.ceil(diffTime /(1000 * 60 * 60 * 24));}showUpgradeModal(message = 'Esta funci√≥n requiere una suscripci√≥n'){const modal = document.createElement('div');modal.className = 'axyra-modal-overlay';modal.innerHTML = ` <div class="axyra-modal axyra-modal-md"> <div class="axyra-modal-header"> <h3>üîí Funci√≥n Premium</h3> <button class="axyra-modal-close" onclick="this.closest('.axyra-modal-overlay').remove()"> <i class="fas fa-times"></i> </button> </div> <div class="axyra-modal-body"> <div class="axyra-upgrade-content"> <div class="axyra-upgrade-icon"> <i class="fas fa-crown"></i> </div> <h4>${message}</h4> <p>Para acceder a esta funci√≥n,necesitas una suscripci√≥n activa.</p> <div class="axyra-plans-preview"> <div class="axyra-plan-preview"> <h5>B√°sico - $59.900/mes</h5> <ul> <li>Hasta 5 empleados</li> <li>Funciones b√°sicas</li> </ul> </div> <div class="axyra-plan-preview"> <h5>Profesional - $99.900/mes</h5> <ul> <li>Hasta 25 empleados</li> <li>Todas las funciones</li> </ul> </div> <div class="axyra-plan-preview"> <h5>Empresarial - $159.900/mes</h5> <ul> <li>Empleados ilimitados</li> <li>Funciones avanzadas</li> </ul> </div> </div> </div> </div> <div class="axyra-modal-footer"> <button class="axyra-btn axyra-btn-primary" onclick="window.location.href='../membresias/membresias.html'"> <i class="fas fa-crown"></i> Ver Planes </button> <button class="axyra-btn axyra-btn-secondary" onclick="this.closest('.axyra-modal-overlay').remove()"> Cancelar </button> </div> </div> `;document.body.appendChild(modal);}activateSubscription(userId,plan,metodoPago = 'manual'){const subscription ={plan:plan,estado:'activo',fechaInicio:new Date().toISOString(),fechaFin:this.calculateEndDate(plan),trial:false,metodoPago:metodoPago,activadoPor:'admin'};localStorage.setItem(`axyra_subscription_${userId}`,JSON.stringify(subscription));if(this.currentUser && this.currentUser.uid === userId){this.currentSubscription = subscription;this.updateUI();}console.log('‚úÖ Suscripci√≥n activada:',subscription);return subscription;}calculateEndDate(plan){const fechaFin = new Date();fechaFin.setMonth(fechaFin.getMonth()+ 1);return fechaFin.toISOString();}updateUI(){this.updateSubscriptionIndicator();this.updateFeatureVisibility();}updateSubscriptionIndicator(){const indicator = document.getElementById('subscription-indicator');if(!indicator)return;if(this.currentSubscription){const plan = this.plans[this.currentSubscription.plan];if(plan){indicator.innerHTML = ` <span class="subscription-plan">${plan.nombre}</span> ${this.currentSubscription.trial ? `<span class="subscription-trial">Prueba(${this.trialDays - this.getDaysSinceStart()}d√≠as)</span>`:'<span class="subscription-active">Activo</span>'}`;}}}updateFeatureVisibility(){const premiumButtons = document.querySelectorAll('[data-requires-subscription]');premiumButtons.forEach(button =>{const feature = button.dataset.requiresSubscription;const action = button.dataset.action || 'view';if(this.canAccessFeature(feature,action)){button.style.display = 'block';button.disabled = false;}else{button.style.display = 'none';button.disabled = true;}});}getSubscriptionInfo(){return{plan:this.currentSubscription?.plan || 'gratuito',planInfo:this.plans[this.currentSubscription?.plan] || null,isActive:this.isSubscriptionActive(),isTrial:this.currentSubscription?.trial || false,daysRemaining:this.currentSubscription?.trial ? this.trialDays - this.getDaysSinceStart():null};}}window.axyraSubscription = new AxyraSubscriptionSystem();window.AxyraSubscriptionSystem = AxyraSubscriptionSystem;