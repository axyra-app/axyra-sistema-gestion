class AxyraAIChatProfessional{constructor(){this.isOpen = false;this.isInitialized = false;this.chatHistory = [];this.knowledgeBase = this.initializeKnowledgeBase();this.currentUser = this.getCurrentUser();this.config ={maxHistory:50,typingDelay:30,responseDelay:1000,maxMessageLength:1000};this.init();}init(){if(this.isInitialized)return;console.log('ü§ñ Inicializando Chat de IA AXYRA Profesional...');if(document.readyState === 'loading'){document.addEventListener('DOMContentLoaded',()=> this.initializeChat());}else{this.initializeChat();}}initializeChat(){try{this.createChatInterface();this.setupEventListeners();this.loadChatHistory();this.isInitialized = true;console.log('‚úÖ Chat de IA AXYRA Profesional inicializado correctamente');}catch(error){console.error('‚ùå Error inicializando chat de IA:',error);}}createChatInterface(){const chatContainer = document.createElement('div');chatContainer.id = 'axyra-ai-chat-container';chatContainer.innerHTML = ` <!-- Bot√≥n flotante --> <button class="axyra-ai-toggle" id="axyraAIToggle" title="Axyra-IA"> <img src="../../logo.png" alt="Axyra-IA" class="axyra-ai-logo"> <span class="axyra-ai-badge" id="axyraAIBadge" style="display:none;">1</span> </button> <!-- Ventana del chat --> <div class="axyra-ai-window" id="axyraAIWindow"> <!-- Header --> <div class="axyra-ai-header"> <div class="axyra-ai-title"> <div class="axyra-ai-avatar"> <img src="../../logo.png" alt="Axyra-IA" class="axyra-ai-avatar-logo"> </div> <div class="axyra-ai-info"> <h3>Axyra-IA</h3> <span class="axyra-ai-status">En l√≠nea</span> </div> </div> <div class="axyra-ai-actions"> <button class="axyra-ai-action" id="axyraAIMinimize" title="Minimizar"> <i class="fas fa-minus"></i> </button> <button class="axyra-ai-action" id="axyraAIClose" title="Cerrar"> <i class="fas fa-times"></i> </button> </div> </div> <!-- Mensajes --> <div class="axyra-ai-messages" id="axyraAIMessages"> <div class="axyra-ai-welcome"> <div class="axyra-ai-welcome-avatar"> <img src="../../logo.png" alt="Axyra-IA" class="axyra-ai-welcome-logo"> </div> <div class="axyra-ai-welcome-content"> <h4>¬°Hola! Soy Axyra-IA</h4> <p>Tu asistente inteligente de AXYRA. Puedo ayudarte con:</p> <ul> <li>Gesti√≥n de personal y n√≥mina</li> <li>Control de inventario</li> <li>Cuadre de caja</li> <li>Configuraci√≥n del sistema</li> <li>Reportes y an√°lisis</li> </ul> <p>¬øEn qu√© puedo ayudarte hoy?</p> </div> </div> </div> <!-- Input --> <div class="axyra-ai-input-container"> <div class="axyra-ai-input-wrapper"> <input type="text" id="axyraAIMessageInput" placeholder="Escribe tu pregunta aqu√≠..." maxlength="${this.config.maxMessageLength}" > <button class="axyra-ai-send" id="axyraAISend"> <i class="fas fa-paper-plane"></i> </button> </div> <div class="axyra-ai-suggestions" id="axyraAISuggestions"> <button class="axyra-ai-suggestion" data-query="¬øC√≥mo agregar un empleado?"> <i class="fas fa-user-plus"></i> Agregar empleado </button> <button class="axyra-ai-suggestion" data-query="¬øC√≥mo hacer un cuadre de caja?"> <i class="fas fa-calculator"></i> Cuadre de caja </button> <button class="axyra-ai-suggestion" data-query="¬øC√≥mo gestionar inventario?"> <i class="fas fa-boxes"></i> Inventario </button> </div> </div> </div> `;this.addStyles();document.body.appendChild(chatContainer);}addStyles(){if(document.getElementById('axyra-ai-chat-styles'))return;const styles = document.createElement('style');styles.id = 'axyra-ai-chat-styles';styles.textContent = ` #axyra-ai-chat-container{position:fixed;bottom:20px;right:20px;z-index:10000;font-family:var(--axyra-font-family,'Inter',sans-serif);}.axyra-ai-toggle{width:60px;height:60px;background:linear-gradient(135deg,#1e40af 0%,#1e3a8a 100%);border:none;border-radius:50%;color:white;font-size:24px;cursor:pointer;box-shadow:0 4px 20px rgba(30,64,175,0.4);transition:all 0.3s ease;position:relative;display:flex;align-items:center;justify-content:center;overflow:hidden;}.axyra-ai-logo{width:40px;height:40px;object-fit:contain;filter:brightness(0)invert(1);}.axyra-ai-toggle:hover{transform:scale(1.1);box-shadow:0 6px 25px rgba(30,64,175,0.6);}.axyra-ai-badge{position:absolute;top:-5px;right:-5px;background:#ef4444;color:white;border-radius:50%;width:20px;height:20px;font-size:12px;font-weight:bold;display:flex;align-items:center;justify-content:center;animation:axyra-pulse 2s infinite;}.axyra-ai-window{position:absolute;bottom:80px;right:0;width:380px;height:500px;background:white;border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,0.15);display:none;flex-direction:column;overflow:hidden;border:1px solid #e2e8f0;}.axyra-ai-window.open{display:flex;animation:axyra-slide-up 0.3s ease-out;}.axyra-ai-header{background:linear-gradient(135deg,#1e40af 0%,#1e3a8a 100%);color:white;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;}.axyra-ai-title{display:flex;align-items:center;gap:12px;}.axyra-ai-avatar{width:40px;height:40px;background:rgba(255,255,255,0.2);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;overflow:hidden;}.axyra-ai-avatar-logo{width:30px;height:30px;object-fit:contain;filter:brightness(0)invert(1);}.axyra-ai-info h3{margin:0;font-size:16px;font-weight:600;}.axyra-ai-status{font-size:12px;opacity:0.8;}.axyra-ai-actions{display:flex;gap:8px;}.axyra-ai-action{width:32px;height:32px;background:rgba(255,255,255,0.2);border:none;border-radius:6px;color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;}.axyra-ai-action:hover{background:rgba(255,255,255,0.3);}.axyra-ai-messages{flex:1;padding:20px;overflow-y:auto;background:#f8fafc;}.axyra-ai-message{margin-bottom:16px;display:flex;gap:12px;}.axyra-ai-message.user{flex-direction:row-reverse;}.axyra-ai-message-avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;}.axyra-ai-message.user .axyra-ai-message-avatar{background:#1e40af;color:white;}.axyra-ai-message.assistant .axyra-ai-message-avatar{background:#10b981;color:white;}.axyra-ai-message-logo{width:20px;height:20px;object-fit:contain;filter:brightness(0)invert(1);}.axyra-ai-message-content{background:white;color:#1a202c;padding:12px 16px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);max-width:80%;word-wrap:break-word;font-weight:500;line-height:1.5;}.axyra-ai-message.user .axyra-ai-message-content{background:#1e40af;color:white;}.axyra-ai-message-time{font-size:11px;color:#64748b;margin-top:4px;}.axyra-ai-message.user .axyra-ai-message-time{color:rgba(255,255,255,0.7);}.axyra-ai-welcome{text-align:center;padding:20px 0;}.axyra-ai-welcome-avatar{width:60px;height:60px;background:linear-gradient(135deg,#10b981 0%,#059669 100%);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;color:white;margin:0 auto 16px;overflow:hidden;}.axyra-ai-welcome-logo{width:40px;height:40px;object-fit:contain;filter:brightness(0)invert(1);}.axyra-ai-welcome-content h4{margin:0 0 12px;color:#1e40af;font-size:18px;}.axyra-ai-welcome-content p{margin:0 0 8px;color:#64748b;font-size:14px;}.axyra-ai-welcome-content ul{text-align:left;margin:12px 0;padding-left:20px;}.axyra-ai-welcome-content li{color:#64748b;font-size:13px;margin-bottom:4px;}.axyra-ai-input-container{background:white;border-top:1px solid #e2e8f0;padding:16px 20px;}.axyra-ai-input-wrapper{display:flex;gap:8px;align-items:center;}.axyra-ai-input-wrapper input{flex:1;padding:12px 16px;border:1px solid #d1d5db;border-radius:24px;font-size:14px;outline:none;transition:all 0.2s ease;}.axyra-ai-input-wrapper input:focus{border-color:#1e40af;box-shadow:0 0 0 3px rgba(30,64,175,0.1);}.axyra-ai-send{width:40px;height:40px;background:#1e40af;border:none;border-radius:50%;color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;}.axyra-ai-send:hover{background:#1e3a8a;transform:scale(1.05);}.axyra-ai-send:disabled{background:#9ca3af;cursor:not-allowed;transform:none;}.axyra-ai-suggestions{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;}.axyra-ai-suggestion{background:#f1f5f9;border:1px solid #e2e8f0;border-radius:16px;padding:6px 12px;font-size:12px;color:#64748b;cursor:pointer;transition:all 0.2s ease;display:flex;align-items:center;gap:6px;}.axyra-ai-suggestion:hover{background:#e2e8f0;color:#1e40af;}.axyra-ai-typing{display:flex;align-items:center;gap:8px;color:#64748b;font-size:14px;font-style:italic;}.axyra-ai-typing-dots{display:flex;gap:2px;}.axyra-ai-typing-dot{width:6px;height:6px;background:#64748b;border-radius:50%;animation:axyra-typing 1.4s infinite ease-in-out;}.axyra-ai-typing-dot:nth-child(1){animation-delay:-0.32s;}.axyra-ai-typing-dot:nth-child(2){animation-delay:-0.16s;}@keyframes axyra-slide-up{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}@keyframes axyra-typing{0%,80%,100%{transform:scale(0.8);opacity:0.5;}40%{transform:scale(1);opacity:1;}}@keyframes axyra-pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.1);}}@media(max-width:480px){.axyra-ai-window{width:calc(100vw - 40px);height:calc(100vh - 100px);right:20px;left:20px;}}`;document.head.appendChild(styles);}setupEventListeners(){document.getElementById('axyraAIToggle').addEventListener('click',()=>{this.toggleChat();});document.getElementById('axyraAIClose').addEventListener('click',()=>{this.closeChat();});document.getElementById('axyraAIMinimize').addEventListener('click',()=>{this.closeChat();});const sendButton = document.getElementById('axyraAISend');const messageInput = document.getElementById('axyraAIMessageInput');sendButton.addEventListener('click',()=>{this.sendMessage();});messageInput.addEventListener('keypress',(e)=>{if(e.key === 'Enter' && !e.shiftKey){e.preventDefault();this.sendMessage();}});document.querySelectorAll('.axyra-ai-suggestion').forEach(button =>{button.addEventListener('click',(e)=>{const query = e.currentTarget.dataset.query;messageInput.value = query;this.sendMessage();});});messageInput.addEventListener('input',()=>{this.updateSendButton();});}toggleChat(){const window = document.getElementById('axyraAIWindow');if(this.isOpen){this.closeChat();}else{this.openChat();}}openChat(){const window = document.getElementById('axyraAIWindow');const toggle = document.getElementById('axyraAIToggle');window.classList.add('open');this.isOpen = true;toggle.style.transform = 'scale(0.9)';setTimeout(()=>{document.getElementById('axyraAIMessageInput').focus();},300);}closeChat(){const window = document.getElementById('axyraAIWindow');const toggle = document.getElementById('axyraAIToggle');window.classList.remove('open');this.isOpen = false;toggle.style.transform = 'scale(1)';}async sendMessage(){const input = document.getElementById('axyraAIMessageInput');const message = input.value.trim();if(!message)return;input.value = '';this.updateSendButton();this.addMessage(message,'user');this.showTypingIndicator();try{const response = await this.processMessage(message);this.hideTypingIndicator();this.addMessage(response,'assistant');}catch(error){this.hideTypingIndicator();this.addMessage('Lo siento,ocurri√≥ un error al procesar tu mensaje. Por favor,intenta de nuevo.','assistant');console.error('Error procesando mensaje:',error);}}addMessage(content,sender){const messagesContainer = document.getElementById('axyraAIMessages');const messageElement = document.createElement('div');messageElement.className = `axyra-ai-message ${sender}`;const time = new Date().toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit'});messageElement.innerHTML = ` <div class="axyra-ai-message-avatar"> ${sender === 'user' ? '<i class="fas fa-user"></i>':'<img src="../../logo.png" alt="Axyra-IA" class="axyra-ai-message-logo">'}</div> <div class="axyra-ai-message-content"> ${this.formatMessage(content)}<div class="axyra-ai-message-time">${time}</div> </div> `;messagesContainer.appendChild(messageElement);messagesContainer.scrollTop = messagesContainer.scrollHeight;this.chatHistory.push({content,sender,time:new Date()});this.saveChatHistory();}formatMessage(content){content = content.replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank" rel="noopener">$1</a>');content = content.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>');content = content.replace(/\*(.*?)\*/g,'<em>$1</em>');content = content.replace(/\n/g,'<br>');return content;}showTypingIndicator(){const messagesContainer = document.getElementById('axyraAIMessages');const typingElement = document.createElement('div');typingElement.className = 'axyra-ai-message assistant';typingElement.id = 'axyraAITyping';typingElement.innerHTML = ` <div class="axyra-ai-message-avatar"> <img src="../../logo.png" alt="Axyra-IA" class="axyra-ai-message-logo"> </div> <div class="axyra-ai-message-content"> <div class="axyra-ai-typing"> <span>Escribiendo</span> <div class="axyra-ai-typing-dots"> <div class="axyra-ai-typing-dot"></div> <div class="axyra-ai-typing-dot"></div> <div class="axyra-ai-typing-dot"></div> </div> </div> </div> `;messagesContainer.appendChild(typingElement);messagesContainer.scrollTop = messagesContainer.scrollHeight;}hideTypingIndicator(){const typingElement = document.getElementById('axyraAITyping');if(typingElement){typingElement.remove();}}async processMessage(message){await new Promise(resolve => setTimeout(resolve,this.config.responseDelay));const response = this.searchKnowledgeBase(message);if(response){return response;}return this.getDefaultResponse(message);}searchKnowledgeBase(message){const lowerMessage = message.toLowerCase();for(const [category,topics] of Object.entries(this.knowledgeBase)){for(const [question,answer] of Object.entries(topics)){if(lowerMessage.includes(question.toLowerCase())|| this.calculateSimilarity(lowerMessage,question.toLowerCase())> 0.6){return answer;}}}return null;}calculateSimilarity(str1,str2){const longer = str1.length > str2.length ? str1:str2;const shorter = str1.length > str2.length ? str2:str1;if(longer.length === 0)return 1.0;const distance = this.levenshteinDistance(longer,shorter);return(longer.length - distance)/ longer.length;}levenshteinDistance(str1,str2){const matrix = [];for(let i = 0;i <= str2.length;i++){matrix[i] = [i];}for(let j = 0;j <= str1.length;j++){matrix[0][j] = j;}for(let i = 1;i <= str2.length;i++){for(let j = 1;j <= str1.length;j++){if(str2.charAt(i - 1)=== str1.charAt(j - 1)){matrix[i][j] = matrix[i - 1][j - 1];}else{matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1,matrix[i][j - 1] + 1,matrix[i - 1][j] + 1);}}}return matrix[str2.length][str1.length];}getDefaultResponse(message){const responses = [ "Entiendo tu consulta. AXYRA es un sistema integral de gesti√≥n empresarial que incluye m√≥dulos para n√≥mina,inventario,caja y personal. ¬øPodr√≠as ser m√°s espec√≠fico sobre qu√© necesitas?","Puedo ayudarte con la gesti√≥n de personal,inventario,cuadre de caja y configuraci√≥n del sistema. ¬øEn qu√© m√≥dulo espec√≠fico necesitas ayuda?","Para brindarte una mejor asistencia,¬øpodr√≠as especificar si tu consulta es sobre empleados,inventario,caja o configuraci√≥n?","AXYRA cuenta con m√∫ltiples funcionalidades. Te recomiendo explorar los m√≥dulos disponibles en el men√∫ principal para encontrar lo que necesitas." ];return responses[Math.floor(Math.random()* responses.length)];}initializeKnowledgeBase(){return{general:{'¬øQu√© es AXYRA?':'AXYRA es un sistema integral de gesti√≥n empresarial que incluye m√≥dulos para n√≥mina,inventario,caja,personal y m√°s. Est√° dise√±ado para automatizar y optimizar los procesos empresariales.','¬øC√≥mo funciona el sistema?':'El sistema est√° organizado en m√≥dulos especializados:Dashboard(resumen general),Gesti√≥n Personal(empleados y n√≥mina),Cuadre de Caja(control financiero),Inventario(gesti√≥n de productos)y Configuraci√≥n(ajustes del sistema).','¬øNecesito capacitaci√≥n?':'No,el sistema est√° dise√±ado para ser intuitivo. Puedes usar este chat para obtener ayuda espec√≠fica en cualquier momento,y cada m√≥dulo tiene gu√≠as integradas.','¬øEs seguro el sistema?':'S√≠,AXYRA utiliza las mejores pr√°cticas de seguridad,incluyendo autenticaci√≥n robusta,encriptaci√≥n de datos y respaldos autom√°ticos.'},dashboard:{'¬øC√≥mo personalizar el dashboard?':'Puedes personalizar el dashboard haciendo clic en el bot√≥n "Personalizar" en la esquina superior derecha. Desde ah√≠ puedes agregar,quitar o reorganizar los widgets seg√∫n tus necesidades.','¬øQu√© informaci√≥n muestra el dashboard?':'El dashboard muestra m√©tricas clave como empleados activos,horas trabajadas,n√≥minas generadas,total de salarios,cuadres de caja e items en inventario.','¬øC√≥mo actualizar los datos?':'Los datos se actualizan autom√°ticamente en tiempo real. Tambi√©n puedes forzar una actualizaci√≥n refrescando la p√°gina o usando el bot√≥n de actualizaci√≥n.'},personal:{'¬øC√≥mo agregar un empleado?':'Ve al m√≥dulo "Gesti√≥n Personal" y haz clic en "Nuevo Empleado". Completa el formulario con la informaci√≥n requerida y guarda los datos.','¬øC√≥mo calcular n√≥mina?':'En el m√≥dulo de Gesti√≥n Personal,puedes calcular n√≥mina autom√°ticamente bas√°ndose en las horas trabajadas y el salario configurado para cada empleado.','¬øC√≥mo gestionar departamentos?':'Puedes crear y gestionar departamentos desde la secci√≥n de configuraci√≥n en el m√≥dulo de Gesti√≥n Personal.'},inventario:{'¬øC√≥mo agregar un producto?':'Ve al m√≥dulo "Inventario" y haz clic en "Nuevo Producto". Completa la informaci√≥n del producto incluyendo nombre,categor√≠a,precio y stock inicial.','¬øC√≥mo hacer entrada de stock?':'En el m√≥dulo de Inventario,usa la opci√≥n "Entrada de Stock" para registrar productos que ingresan al almac√©n.','¬øC√≥mo hacer salida de stock?':'Usa la opci√≥n "Salida de Stock" para registrar productos que salen del almac√©n,ya sea por venta o uso interno.'},caja:{'¬øC√≥mo hacer un cuadre de caja?':'Ve al m√≥dulo "Caja" y haz clic en "Nuevo Cuadre". Registra las facturas del d√≠a y el sistema calcular√° autom√°ticamente los totales.','¬øC√≥mo registrar una factura?':'En el m√≥dulo de Caja,puedes registrar facturas individuales o importar m√∫ltiples facturas desde un archivo Excel.','¬øC√≥mo exportar reportes?':'Desde el m√≥dulo de Caja,puedes exportar reportes en formato Excel haciendo clic en el bot√≥n "Exportar Excel".'}};}getCurrentUser(){try{const user = localStorage.getItem('axyra_user');return user ? JSON.parse(user):null;}catch(error){return null;}}updateSendButton(){const input = document.getElementById('axyraAIMessageInput');const sendButton = document.getElementById('axyraAISend');const hasText = input.value.trim().length > 0;sendButton.disabled = !hasText;sendButton.style.opacity = hasText ? '1':'0.5';}loadChatHistory(){try{const history = localStorage.getItem('axyra_ai_chat_history');if(history){this.chatHistory = JSON.parse(history);this.displayChatHistory();}}catch(error){console.error('Error cargando historial del chat:',error);}}displayChatHistory(){const messagesContainer = document.getElementById('axyraAIMessages');const welcome = messagesContainer.querySelector('.axyra-ai-welcome');if(welcome){welcome.remove();}this.chatHistory.forEach(entry =>{this.addMessage(entry.content,entry.sender,false);});}saveChatHistory(){try{if(this.chatHistory.length > this.config.maxHistory){this.chatHistory = this.chatHistory.slice(-this.config.maxHistory);}localStorage.setItem('axyra_ai_chat_history',JSON.stringify(this.chatHistory));}catch(error){console.error('Error guardando historial del chat:',error);}}addMessage(content,sender,saveToHistory = true){const messagesContainer = document.getElementById('axyraAIMessages');const messageElement = document.createElement('div');messageElement.className = `axyra-ai-message ${sender}`;const time = new Date().toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit'});messageElement.innerHTML = ` <div class="axyra-ai-message-avatar"> ${sender === 'user' ? '<i class="fas fa-user"></i>':'<img src="../../logo.png" alt="Axyra-IA" class="axyra-ai-message-logo">'}</div> <div class="axyra-ai-message-content"> ${this.formatMessage(content)}<div class="axyra-ai-message-time">${time}</div> </div> `;messagesContainer.appendChild(messageElement);messagesContainer.scrollTop = messagesContainer.scrollHeight;if(saveToHistory){this.chatHistory.push({content,sender,time:new Date()});this.saveChatHistory();}}}document.addEventListener('DOMContentLoaded',()=>{window.axyraAIChat = new AxyraAIChatProfessional();});if(document.readyState !== 'loading'){window.axyraAIChat = new AxyraAIChatProfessional();}