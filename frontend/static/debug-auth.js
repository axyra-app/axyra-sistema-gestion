class AxyraDebug{constructor(){this.isEnabled = true;this.logLevel = 'info';this.errorHandlingSetup = false;this.init();}init(){if(!this.isEnabled)return;console.log('üîç Inicializando sistema de debugging AXYRA...');this.setupGlobalErrorHandling();this.setupPerformanceMonitoring();this.logSystemInfo();}setupGlobalErrorHandling(){try{if(this.errorHandlingSetup){console.log('[DEBUG] Error handling ya configurado,saltando...');return;}this.errorHandlingSetup = true;window.addEventListener('error',(event)=>{if(this.debugLevel >= 3){this.logError('Error no manejado',{message:event.message,filename:event.filename,lineno:event.lineno,colno:event.colno,error:event.error,});}});window.addEventListener('unhandledrejection',(event)=>{if(this.debugLevel >= 3){this.logError('Promesa rechazada no manejada',{reason:event.reason,promise:event.promise,});}});const originalConsoleError = console.error;console.error =(...args)=>{if(args[0] && typeof args[0] === 'string' && args[0].includes('Maximum call stack size exceeded')){originalConsoleError.apply(console,args);return;}if(this.debugLevel >= 3){this.logError('Console Error',{args});}originalConsoleError.apply(console,args);};console.log('[DEBUG] Error handling configurado correctamente');}catch(error){console.error('[DEBUG] Error configurando error handling:',error);}}setupPerformanceMonitoring(){window.addEventListener('load',()=>{const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;this.logInfo('Tiempo de carga de p√°gina',`${loadTime}ms`);});if(performance.memory){setInterval(()=>{const memory = performance.memory;this.logDebug('Uso de memoria',{used:`${Math.round(memory.usedJSHeapSize / 1048576)}MB`,total:`${Math.round(memory.totalJSHeapSize / 1048576)}MB`,limit:`${Math.round(memory.jsHeapSizeLimit / 1048576)}MB`,});},30000);}}logSystemInfo(){this.logInfo('Informaci√≥n del sistema',{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,screenResolution:`${screen.width}x${screen.height}`,viewportSize:`${window.innerWidth}x${window.innerHeight}`,url:window.location.href,timestamp:new Date().toISOString(),});}logDebug(message,data = null){if(this.shouldLog('debug')){console.log(`üîç [DEBUG] ${message}`,data);}}logInfo(message,data = null){if(this.shouldLog('info')){console.log(`‚ÑπÔ∏è [INFO] ${message}`,data);}}logWarn(message,data = null){if(this.shouldLog('warn')){console.warn(`‚ö†Ô∏è [WARN] ${message}`,data);}}logError(message,data = null){if(this.shouldLog('error')){console.error(`‚ùå [ERROR] ${message}`,data);this.sendToMonitoringService(message,data);}}shouldLog(level){const levels ={debug:0,info:1,warn:2,error:3};return levels[level] >= levels[this.logLevel];}sendToMonitoringService(message,data){try{if(window.axyraFirebase && window.axyraFirebase.firestore){const errorLog ={message,data:JSON.stringify(data),timestamp:new Date().toISOString(),url:window.location.href,userAgent:navigator.userAgent,userId:this.getCurrentUserId(),};window.axyraFirebase.firestore .collection('error_logs').add(errorLog).then(()=> this.logDebug('Error log guardado en Firestore')).catch((err)=> this.logWarn('No se pudo guardar error log en Firestore',err));}}catch(error){this.logWarn('Error enviando log a servicio de monitoreo',error);}}getCurrentUserId(){try{const userData = localStorage.getItem('axyra_isolated_user');if(userData){const user = JSON.parse(userData);return user.username || user.email || 'unknown';}return 'anonymous';}catch(error){return 'unknown';}}checkFirebaseStatus(){try{if(window.axyraFirebase){this.logInfo('Estado de Firebase',{auth:!!window.axyraFirebase.auth,firestore:!!window.axyraFirebase.firestore,isDomainAuthorized:window.axyraFirebase.isDomainAuthorized,});}else{this.logWarn('Firebase no est√° disponible');}}catch(error){this.logError('Error verificando estado de Firebase',error);}}checkLocalStorageStatus(){try{const keys = Object.keys(localStorage);const axyraKeys = keys.filter((key)=> key.startsWith('axyra_'));this.logInfo('Estado de localStorage',{totalKeys:keys.length,axyraKeys:axyraKeys.length,axyraKeysList:axyraKeys,});axyraKeys.forEach((key)=>{try{const value = localStorage.getItem(key);let parsed;let isJson = false;try{parsed = JSON.parse(value);isJson = true;}catch(parseError){parsed = value;isJson = false;}this.logDebug(`Contenido de ${key}`,{type:typeof parsed,isJson:isJson,hasData:!!parsed,size:value ? value.length:0,value:isJson ? '[JSON Object]':`"${parsed}"`,});}catch(error){this.logWarn(`Error procesando ${key}`,error);}});}catch(error){this.logError('Error verificando localStorage',error);}}checkAuthStatus(){try{const userData = localStorage.getItem('axyra_isolated_user');const firebaseUser = localStorage.getItem('axyra_firebase_user');this.logInfo('Estado de autenticaci√≥n',{hasLocalUser:!!userData,hasFirebaseUser:!!firebaseUser,currentUser:userData ? JSON.parse(userData):null,});}catch(error){this.logError('Error verificando estado de autenticaci√≥n',error);}}runDiagnostic(){this.logInfo('üîç Iniciando diagn√≥stico completo del sistema...');setTimeout(()=> this.checkFirebaseStatus(),100);setTimeout(()=> this.checkLocalStorageStatus(),200);setTimeout(()=> this.checkAuthStatus(),300);this.logInfo('‚úÖ Diagn√≥stico completo completado');}setEnabled(enabled){this.isEnabled = enabled;this.logInfo(`Debugging ${enabled ? 'habilitado':'deshabilitado'}`);}setLogLevel(level){if(['debug','info','warn','error'].includes(level)){this.logLevel = level;this.logInfo(`Nivel de log cambiado a:${level}`);}else{this.logWarn(`Nivel de log inv√°lido:${level}`);}}}document.addEventListener('DOMContentLoaded',()=>{window.axyraDebug = new AxyraDebug();setTimeout(()=>{if(window.axyraDebug){window.axyraDebug.runDiagnostic();}},1000);});window.axyraDebugCommands ={diagnostic:()=>{if(window.axyraDebug){window.axyraDebug.runDiagnostic();}},checkFirebase:()=>{if(window.axyraDebug){window.axyraDebug.checkFirebaseStatus();}},checkStorage:()=>{if(window.axyraDebug){window.axyraDebug.checkLocalStorageStatus();}},checkAuth:()=>{if(window.axyraDebug){window.axyraDebug.checkAuthStatus();}},setLogLevel:(level)=>{if(window.axyraDebug){window.axyraDebug.setLogLevel(level);}},setDebug:(enabled)=>{if(window.axyraDebug){window.axyraDebug.setEnabled(enabled);}},};console.log('üîç Comandos de debugging disponibles:');console.log('axyraDebugCommands.diagnostic()- Ejecutar diagn√≥stico completo');console.log('axyraDebugCommands.checkFirebase()- Verificar estado de Firebase');console.log('axyraDebugCommands.checkStorage()- Verificar localStorage');console.log('axyraDebugCommands.checkAuth()- Verificar autenticaci√≥n');console.log('axyraDebugCommands.setLogLevel("debug|info|warn|error")- Cambiar nivel de log');console.log('axyraDebugCommands.setDebug(true|false)- Habilitar/deshabilitar debugging');window.AxyraDebug = AxyraDebug;