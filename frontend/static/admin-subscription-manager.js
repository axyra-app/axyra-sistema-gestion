class AxyraAdminSubscriptionManager{constructor(){this.adminUsers = ['admin@axyra.com','axyra.app@gmail.com'];this.init();}init(){console.log('ðŸ‘‘ Inicializando Administrador de Suscripciones AXYRA...');this.setupEventListeners();this.createAdminPanel();}setupEventListeners(){document.addEventListener('userAuthenticated',(e)=>{if(this.isAdmin(e.detail.user)){this.showAdminPanel();}});document.addEventListener('userLogout',()=>{this.hideAdminPanel();});}isAdmin(user){return this.adminUsers.includes(user.email);}createAdminPanel(){const panel = document.createElement('div');panel.id = 'admin-subscription-panel';panel.className = 'admin-panel';panel.innerHTML = ` <div class="admin-panel-header"> <h3>ðŸ‘‘ Administrador de Suscripciones</h3> <button onclick="this.parentElement.parentElement.style.display='none'" class="admin-close"> <i class="fas fa-times"></i> </button> </div> <div class="admin-panel-content"> <div class="admin-section"> <h4>Activar SuscripciÃ³n Manual</h4> <div class="admin-form"> <div class="form-group"> <label>Email del Usuario:</label> <input type="email" id="admin-user-email" placeholder="usuario@empresa.com"> </div> <div class="form-group"> <label>Plan:</label> <select id="admin-plan-select"> <option value="basico">BÃ¡sico - $59.900/mes</option> <option value="profesional">Profesional - $99.900/mes</option> <option value="empresarial">Empresarial - $159.900/mes</option> </select> </div> <div class="form-group"> <label>MÃ©todo de Pago:</label> <select id="admin-payment-method"> <option value="wompi">Wompi</option> <option value="transferencia">Transferencia Bancaria</option> <option value="efectivo">Efectivo</option> <option value="manual">Manual</option> </select> </div> <div class="form-group"> <label>Notas:</label> <textarea id="admin-notes" placeholder="Notas adicionales..."></textarea> </div> <button onclick="window.axyraAdminSubscription.activateUserSubscription()" class="admin-btn admin-btn-primary"> <i class="fas fa-check"></i> Activar SuscripciÃ³n </button> </div> </div> <div class="admin-section"> <h4>Gestionar Suscripciones</h4> <div class="admin-actions"> <button onclick="window.axyraAdminSubscription.viewAllSubscriptions()" class="admin-btn admin-btn-secondary"> <i class="fas fa-list"></i> Ver Todas </button> <button onclick="window.axyraAdminSubscription.exportSubscriptions()" class="admin-btn admin-btn-secondary"> <i class="fas fa-download"></i> Exportar </button> </div> </div> <div class="admin-section"> <h4>EstadÃ­sticas</h4> <div class="admin-stats" id="admin-stats"> <div class="stat-item"> <span class="stat-label">Usuarios Activos:</span> <span class="stat-value" id="active-users">0</span> </div> <div class="stat-item"> <span class="stat-label">Suscripciones:</span> <span class="stat-value" id="total-subscriptions">0</span> </div> <div class="stat-item"> <span class="stat-label">Ingresos Mensuales:</span> <span class="stat-value" id="monthly-revenue">$0</span> </div> </div> </div> </div> `;const styles = document.createElement('style');styles.textContent = ` .admin-panel{position:fixed;top:20px;right:20px;width:400px;max-height:80vh;background:white;border-radius:12px;box-shadow:0 20px 40px rgba(0,0,0,0.15);z-index:10000;display:none;overflow-y:auto;}.admin-panel-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:15px 20px;border-radius:12px 12px 0 0;display:flex;justify-content:space-between;align-items:center;}.admin-panel-header h3{margin:0;font-size:1.1rem;}.admin-close{background:none;border:none;color:white;font-size:1.2rem;cursor:pointer;padding:5px;border-radius:4px;transition:background 0.3s ease;}.admin-close:hover{background:rgba(255,255,255,0.2);}.admin-panel-content{padding:20px;}.admin-section{margin-bottom:25px;padding-bottom:20px;border-bottom:1px solid #e5e7eb;}.admin-section:last-child{border-bottom:none;margin-bottom:0;}.admin-section h4{margin:0 0 15px 0;color:#374151;font-size:1rem;}.form-group{margin-bottom:15px;}.form-group label{display:block;margin-bottom:5px;color:#374151;font-weight:500;font-size:0.9rem;}.form-group input,.form-group select,.form-group textarea{width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;transition:border-color 0.3s ease;}.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,0.1);}.form-group textarea{resize:vertical;min-height:60px;}.admin-btn{padding:10px 16px;border:none;border-radius:6px;font-size:0.9rem;font-weight:500;cursor:pointer;transition:all 0.3s ease;display:inline-flex;align-items:center;gap:8px;margin-right:10px;margin-bottom:10px;}.admin-btn-primary{background:#667eea;color:white;}.admin-btn-primary:hover{background:#5a67d8;transform:translateY(-1px);}.admin-btn-secondary{background:#f3f4f6;color:#374151;}.admin-btn-secondary:hover{background:#e5e7eb;transform:translateY(-1px);}.admin-actions{display:flex;flex-wrap:wrap;gap:10px;}.admin-stats{display:flex;flex-direction:column;gap:10px;}.stat-item{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:#f8f9fa;border-radius:6px;}.stat-label{color:#6b7280;font-size:0.9rem;}.stat-value{color:#374151;font-weight:600;font-size:0.9rem;}.admin-notification{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#10b981;color:white;padding:12px 20px;border-radius:8px;box-shadow:0 4px 12px rgba(16,185,129,0.3);z-index:10001;animation:slideDown 0.3s ease;}@keyframes slideDown{from{opacity:0;transform:translateX(-50%)translateY(-20px);}to{opacity:1;transform:translateX(-50%)translateY(0);}}`;document.head.appendChild(styles);document.body.appendChild(panel);}showAdminPanel(){const panel = document.getElementById('admin-subscription-panel');if(panel){panel.style.display = 'block';this.updateStats();}}hideAdminPanel(){const panel = document.getElementById('admin-subscription-panel');if(panel){panel.style.display = 'none';}}activateUserSubscription(){const email = document.getElementById('admin-user-email').value;const plan = document.getElementById('admin-plan-select').value;const paymentMethod = document.getElementById('admin-payment-method').value;const notes = document.getElementById('admin-notes').value;if(!email){this.showNotification('Por favor ingresa el email del usuario','error');return;}const subscription ={plan:plan,estado:'activo',fechaInicio:new Date().toISOString(),fechaFin:this.calculateEndDate(),trial:false,metodoPago:paymentMethod,activadoPor:'admin',notas:notes,email:email};const subscriptions = JSON.parse(localStorage.getItem('axyra_all_subscriptions')|| '[]');subscriptions.push(subscription);localStorage.setItem('axyra_all_subscriptions',JSON.stringify(subscriptions));const currentUser = JSON.parse(localStorage.getItem('axyra_user')|| '{}');if(currentUser.email === email){localStorage.setItem(`axyra_subscription_${currentUser.uid}`,JSON.stringify(subscription));if(window.axyraSubscription){window.axyraSubscription.currentSubscription = subscription;window.axyraSubscription.updateUI();}}this.showNotification(`SuscripciÃ³n ${plan}activada para ${email}`,'success');this.clearForm();this.updateStats();}calculateEndDate(){const fechaFin = new Date();fechaFin.setMonth(fechaFin.getMonth()+ 1);return fechaFin.toISOString();}viewAllSubscriptions(){const subscriptions = JSON.parse(localStorage.getItem('axyra_all_subscriptions')|| '[]');if(subscriptions.length === 0){this.showNotification('No hay suscripciones registradas','info');return;}const modal = document.createElement('div');modal.className = 'axyra-modal-overlay';modal.innerHTML = ` <div class="axyra-modal axyra-modal-lg"> <div class="axyra-modal-header"> <h3>ðŸ“‹ Todas las Suscripciones</h3> <button class="axyra-modal-close" onclick="this.closest('.axyra-modal-overlay').remove()"> <i class="fas fa-times"></i> </button> </div> <div class="axyra-modal-body"> <div class="subscriptions-list"> ${subscriptions.map(sub => ` <div class="subscription-item"> <div class="subscription-info"> <h4>${sub.email}</h4> <p>Plan:${sub.plan}- ${sub.metodoPago}</p> <p>Estado:${sub.estado}- ${new Date(sub.fechaInicio).toLocaleDateString()}</p> ${sub.notas ? `<p>Notas:${sub.notas}</p>`:''}</div> <div class="subscription-actions"> <button onclick="window.axyraAdminSubscription.editSubscription('${sub.email}')" class="admin-btn admin-btn-secondary"> <i class="fas fa-edit"></i> </button> </div> </div> `).join('')}</div> </div> </div> `;document.body.appendChild(modal);}exportSubscriptions(){const subscriptions = JSON.parse(localStorage.getItem('axyra_all_subscriptions')|| '[]');if(subscriptions.length === 0){this.showNotification('No hay suscripciones para exportar','info');return;}const csvContent = [ ['Email','Plan','Estado','Fecha Inicio','Fecha Fin','MÃ©todo Pago','Notas'],...subscriptions.map(sub => [ sub.email,sub.plan,sub.estado,new Date(sub.fechaInicio).toLocaleDateString(),sub.fechaFin ? new Date(sub.fechaFin).toLocaleDateString():'N/A',sub.metodoPago,sub.notas || '' ])].map(row => row.join(',')).join('\n');const blob = new Blob([csvContent],{type:'text/csv'});const url = URL.createObjectURL(blob);const link = document.createElement('a');link.href = url;link.download = `suscripciones_axyra_${new Date().toISOString().split('T')[0]}.csv`;link.click();URL.revokeObjectURL(url);this.showNotification('Suscripciones exportadas correctamente','success');}updateStats(){const subscriptions = JSON.parse(localStorage.getItem('axyra_all_subscriptions')|| '[]');const activeSubscriptions = subscriptions.filter(sub => sub.estado === 'activo');const plans ={basico:59900,profesional:99900,empresarial:159900};const monthlyRevenue = activeSubscriptions.reduce((total,sub)=>{return total +(plans[sub.plan] || 0);},0);document.getElementById('active-users').textContent = activeSubscriptions.length;document.getElementById('total-subscriptions').textContent = subscriptions.length;document.getElementById('monthly-revenue').textContent = `$${monthlyRevenue.toLocaleString()}`;}clearForm(){document.getElementById('admin-user-email').value = '';document.getElementById('admin-plan-select').value = 'basico';document.getElementById('admin-payment-method').value = 'wompi';document.getElementById('admin-notes').value = '';}showNotification(message,type = 'success'){const notification = document.createElement('div');notification.className = `admin-notification ${type}`;notification.textContent = message;document.body.appendChild(notification);setTimeout(()=>{notification.remove();},3000);}}window.axyraAdminSubscription = new AxyraAdminSubscriptionManager();