class AxyraDashboardInitializer{constructor(){this.initialized = false;this.retryCount = 0;this.maxRetries = 5;this.init();}init(){console.log('üöÄ Inicializando Dashboard AXYRA...');if(document.readyState === 'loading'){document.addEventListener('DOMContentLoaded',()=> this.initializeDashboard());}else{this.initializeDashboard();}}async initializeDashboard(){try{console.log('üìã Iniciando proceso de inicializaci√≥n del dashboard...');await this.waitForFirebase();await this.checkAuthentication();await this.initializeComponents();await this.loadDashboardData();this.showDashboard();this.initialized = true;console.log('‚úÖ Dashboard AXYRA inicializado correctamente');}catch(error){console.error('‚ùå Error inicializando dashboard:',error);this.handleInitializationError(error);}}async waitForFirebase(){console.log('üî• Esperando Firebase...');let attempts = 0;const maxAttempts = 50;while(attempts < maxAttempts){if((window.axyraFirebase && window.axyraFirebase.auth)||(window.firebase && window.firebase.auth)){console.log('‚úÖ Firebase disponible');return true;}await this.sleep(100);attempts++;}console.log('‚ö†Ô∏è Firebase no encontrado,continuando sin verificaci√≥n...');return true;}async checkAuthentication(){console.log('üîê Verificando autenticaci√≥n...');let user = localStorage.getItem('axyra_isolated_user')|| localStorage.getItem('axyra_user')|| localStorage.getItem('axyra_firebase_user');if(!user){console.log('‚ö†Ô∏è No hay usuario autenticado,redirigiendo al login...');window.location.href = '/login.html';return;}try{const userData = JSON.parse(user);console.log('‚úÖ Usuario autenticado:',userData.email || userData.displayName);if(userData.email === 'axyra.app@gmail.com'){console.log('üëë Usuario es administrador,redirigiendo al panel de administraci√≥n...');window.location.href = '/admin-brutal.html';return;}}catch(error){console.error('‚ùå Error parseando datos de usuario:',error);window.location.href = '/login.html';}}async initializeComponents(){console.log('üß© Inicializando componentes...');if(window.AxyraAIChatProfessional && !window.axyraAIChat){try{window.axyraAIChat = new AxyraAIChatProfessional();console.log('‚úÖ Chat de IA inicializado');}catch(error){console.warn('‚ö†Ô∏è Error inicializando chat de IA:',error);}}if(window.AxyraModalSystem && !window.axyraModalSystem){try{window.axyraModalSystem = new AxyraModalSystem();console.log('‚úÖ Sistema de modales inicializado');}catch(error){console.warn('‚ö†Ô∏è Error inicializando sistema de modales:',error);}}if(window.axyraAdminAuth){try{window.axyraAdminAuth.checkAdminAccess();console.log('‚úÖ Sistema de administraci√≥n verificado');}catch(error){console.warn('‚ö†Ô∏è Error verificando sistema de administraci√≥n:',error);}}}async loadDashboardData(){console.log('üìä Cargando datos del dashboard...');await this.sleep(500);console.log('‚úÖ Datos del dashboard cargados');}showDashboard(){console.log('üéØ Mostrando dashboard...');const loader = document.getElementById('dashboard-loader');if(loader){loader.style.display = 'none';}const mainContent = document.getElementById('main-content');if(mainContent){mainContent.style.display = 'block';}const header = document.querySelector('.axyra-header');if(header){header.style.display = 'block';}console.log('‚úÖ Dashboard visible');}handleInitializationError(error){console.error('‚ùå Error cr√≠tico en inicializaci√≥n:',error);this.showErrorMessage('Error cargando el dashboard. Por favor,recarga la p√°gina.');if(this.retryCount < this.maxRetries){this.retryCount++;console.log(`üîÑ Reintentando inicializaci√≥n(${this.retryCount}/${this.maxRetries})...`);setTimeout(()=>{this.initializeDashboard();},2000);}else{console.error('‚ùå M√°ximo n√∫mero de reintentos alcanzado');this.showErrorMessage('Error persistente. Por favor,contacta al soporte t√©cnico.');}}showErrorMessage(message){const errorDiv = document.createElement('div');errorDiv.className = 'dashboard-error';errorDiv.innerHTML = ` <div style=" position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fef2f2;border:1px solid #fecaca;color:#dc2626;padding:20px;border-radius:10px;box-shadow:0 10px 25px rgba(0,0,0,0.1);z-index:10000;text-align:center;max-width:400px;"> <i class="fas fa-exclamation-triangle" style="font-size:2rem;margin-bottom:10px;"></i> <h3 style="margin:0 0 10px 0;">Error del Dashboard</h3> <p style="margin:0 0 15px 0;">${message}</p> <button onclick="location.reload()" style=" background:#dc2626;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;">Recargar P√°gina</button> </div> `;document.body.appendChild(errorDiv);}sleep(ms){return new Promise((resolve)=> setTimeout(resolve,ms));}}window.axyraDashboardInitializer = new AxyraDashboardInitializer();